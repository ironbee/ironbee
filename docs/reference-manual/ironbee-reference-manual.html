<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="The IronBee Web Application Firewall Framework reference manual.">
<title>IronBee Reference Manual</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>IronBee Reference Manual</h1>
<span id="author" class="author">Brian Rectanus</span><br>
<span id="revdate">2010-2014</span>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">Preface</a></li>
<li><a href="#_introduction">Introduction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_software_installation">Software Installation</a></li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_data_inspection">Data Inspection</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_input">Input</a></li>
<li><a href="#_rules">Rules</a></li>
<li><a href="#_events">Events</a></li>
<li><a href="#_request_and_response_body_handling">Request and Response Body Handling</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_server_configuration">Server Configuration</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_apache_trafficserver_plugin_configuration">Apache Trafficserver Plugin Configuration</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_trafficserver_library_loader_plugin">TrafficServer Library Loader Plugin</a></li>
<li><a href="#_trafficserver_ironbee_plugin">TrafficServer IronBee Plugin</a></li>
</ul>
</li>
<li><a href="#_apache_httpd_module_configuration">Apache Httpd Module Configuration</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_ironbeeconfigfile">IronbeeConfigFile</a></li>
<li><a href="#_ironbeerawheaders">IronbeeRawHeaders</a></li>
<li><a href="#_ironbeefilterinput">IronbeeFilterInput</a></li>
<li><a href="#_ironbeefilteroutput">IronbeeFilterOutput</a></li>
<li><a href="#_ironbeelog">IronbeeLog</a></li>
<li><a href="#_ironbeeloglevel">IronbeeLogLevel</a></li>
</ul>
</li>
<li><a href="#_nginx_configuration">Nginx Configuration</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_ironbee_config_file">ironbee_config_file</a></li>
<li><a href="#_ironbee_logger">ironbee_logger</a></li>
<li><a href="#_ironbee_loglevel">ironbee_loglevel</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ironbee_configuration">IronBee Configuration</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_action">Action</a></li>
<li><a href="#_auditengine">AuditEngine</a></li>
<li><a href="#_auditlogbasedir">AuditLogBaseDir</a></li>
<li><a href="#_auditlogdirmode">AuditLogDirMode</a></li>
<li><a href="#_auditlogfilemode">AuditLogFileMode</a></li>
<li><a href="#_auditlogindex">AuditLogIndex</a></li>
<li><a href="#_auditlogindexformat">AuditLogIndexFormat</a></li>
<li><a href="#_auditlogparts">AuditLogParts</a></li>
<li><a href="#_auditlogsubdirformat">AuditLogSubDirFormat</a></li>
<li><a href="#_defaultblockstatus">DefaultBlockStatus</a></li>
<li><a href="#_geoipdatabasefile">GeoIPDatabaseFile</a></li>
<li><a href="#_hostname">Hostname</a></li>
<li><a href="#_include">Include</a></li>
<li><a href="#_includeifexists">IncludeIfExists</a></li>
<li><a href="#_initcollection">InitCollection</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_core_functionality">Core Functionality</a></li>
<li><a href="#_persist_module">Persist Module</a></li>
</ul>
</li>
<li><a href="#_initvar">InitVar</a></li>
<li><a href="#_inspectionengineoptions">InspectionEngineOptions</a></li>
<li><a href="#_loadeudoxus">LoadEudoxus</a></li>
<li><a href="#_loadmodule">LoadModule</a></li>
<li><a href="#_location">Location</a></li>
<li><a href="#_log">Log</a></li>
<li><a href="#_loglevel">LogLevel</a></li>
<li><a href="#_lualoadmodule">LuaLoadModule</a></li>
<li><a href="#_luainclude">LuaInclude</a></li>
<li><a href="#_modulebasepath">ModuleBasePath</a></li>
<li><a href="#_pcrematchlimit">PcreMatchLimit</a></li>
<li><a href="#_pcrematchlimitrecursion">PcreMatchLimitRecursion</a></li>
<li><a href="#_protectionengineoptions">ProtectionEngineOptions</a></li>
<li><a href="#_requestbuffering">RequestBuffering</a></li>
<li><a href="#_requestbodybufferlimit">RequestBodyBufferLimit</a></li>
<li><a href="#_requestbodybufferlimitaction">RequestBodyBufferLimitAction</a></li>
<li><a href="#_responsebuffering">ResponseBuffering</a></li>
<li><a href="#_responsebodybufferlimit">ResponseBodyBufferLimit</a></li>
<li><a href="#_responsebodybufferlimitaction">ResponseBodyBufferLimitAction</a></li>
<li><a href="#_rule">Rule</a></li>
<li><a href="#_rulebasepath">RuleBasePath</a></li>
<li><a href="#_ruledisable">RuleDisable</a></li>
<li><a href="#_ruleenable">RuleEnable</a></li>
<li><a href="#_ruleenginelogdata">RuleEngineLogData</a></li>
<li><a href="#_ruleengineloglevel">RuleEngineLogLevel</a></li>
<li><a href="#_ruleext">RuleExt</a></li>
<li><a href="#_rulemarker">RuleMarker</a></li>
<li><a href="#_sensorid">SensorId</a></li>
<li><a href="#_service">Service</a></li>
<li><a href="#_site">Site</a></li>
<li><a href="#_siteid">SiteId</a></li>
<li><a href="#_streaminspect">StreamInspect</a></li>
<li><a href="#_trustedproxyusexffheader">TrustedProxyUseXFFHeader</a></li>
<li><a href="#_trustedproxyips">TrustedProxyIPs</a></li>
<li><a href="#_txdump">TxDump</a></li>
<li><a href="#_xrulegeo">XRuleGeo</a></li>
<li><a href="#_xruleipv4">XRuleIpv4</a></li>
<li><a href="#_xruleipv6">XRuleIpv6</a></li>
<li><a href="#_xrulepath">XRulePath</a></li>
<li><a href="#_xrulerequestcontenttype">XRuleRequestContentType</a></li>
<li><a href="#_xruleresponsecontenttype">XRuleResponseContentType</a></li>
<li><a href="#_xruletime">XRuleTime</a></li>
</ul>
</li>
<li><a href="#_ironbee_diagnostics_and_developer_tools">IronBee Diagnostics and Developer Tools</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_rule_engine_logging_and_diagnostics">Rule Engine Logging and Diagnostics</a></li>
<li><a href="#_command_line_tool_clipp">Command Line Tool (clipp)</a></li>
<li><a href="#_developer_module">Developer Module</a></li>
</ul>
</li>
<li><a href="#_inspection">Inspection</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_data">Data</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_defining_and_initializing_scalar_variables_with_code_initvar_code">Defining and Initializing Scalar Variables with <code>InitVar</code></a></li>
<li><a href="#_defining_and_initializing_collections_with_code_initcollection_code">Defining and Initializing Collections with <code>InitCollection</code></a></li>
<li><a href="#_persisting_data_with_code_initcollection_code">Persisting Data with <code>InitCollection</code></a></li>
</ul>
</li>
<li><a href="#_inspection_rules">Inspection Rules</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_ironbee_rule_language">IronBee Rule Language</a></li>
<li><a href="#_lua_signature_definitions">Lua Signature Definitions</a></li>
<li><a href="#_extended_rules_xrules">Extended Rules (XRules)</a></li>
<li><a href="#_external_lua_rule_scripts">External Lua Rule Scripts</a></li>
<li><a href="#_alternative_rule_execution_via_rule_injection_modules">Alternative Rule Execution via Rule Injection Modules</a></li>
</ul>
</li>
<li><a href="#_modules">Modules</a></li>
</ul>
</li>
<li><a href="#_rule_reference">Rule Reference</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_rule_metadata">Rule Metadata</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_logdata">logdata</a></li>
<li><a href="#_confidence">confidence</a></li>
<li><a href="#_id">id</a></li>
<li><a href="#_msg">msg</a></li>
<li><a href="#_phase">phase</a></li>
<li><a href="#_rev">rev</a></li>
<li><a href="#_severity">severity</a></li>
<li><a href="#_tag">tag</a></li>
</ul>
</li>
<li><a href="#_data_fields">Data Fields</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_args">ARGS</a></li>
<li><a href="#_auth_password">AUTH_PASSWORD</a></li>
<li><a href="#_auth_type">AUTH_TYPE</a></li>
<li><a href="#_auth_username">AUTH_USERNAME</a></li>
<li><a href="#_capture">CAPTURE</a></li>
<li><a href="#_field">FIELD</a></li>
<li><a href="#_field_name">FIELD_NAME</a></li>
<li><a href="#_field_name_full">FIELD_NAME_FULL</a></li>
<li><a href="#_geoip">GEOIP</a></li>
<li><a href="#_htp_request_flags">HTP_REQUEST_FLAGS</a></li>
<li><a href="#_htp_response_flags">HTP_RESPONSE_FLAGS</a></li>
<li><a href="#_remote_addr">REMOTE_ADDR</a></li>
<li><a href="#_remote_port">REMOTE_PORT</a></li>
<li><a href="#_request_body_params">REQUEST_BODY_PARAMS</a></li>
<li><a href="#_request_cookies">REQUEST_COOKIES</a></li>
<li><a href="#_request_headers">REQUEST_HEADERS</a></li>
<li><a href="#_request_host">REQUEST_HOST</a></li>
<li><a href="#_request_line">REQUEST_LINE</a></li>
<li><a href="#_request_method">REQUEST_METHOD</a></li>
<li><a href="#_request_protocol">REQUEST_PROTOCOL</a></li>
<li><a href="#_request_uri">REQUEST_URI</a></li>
<li><a href="#_request_uri_fragment">REQUEST_URI_FRAGMENT</a></li>
<li><a href="#_request_uri_host">REQUEST_URI_HOST</a></li>
<li><a href="#_request_uri_params">REQUEST_URI_PARAMS</a></li>
<li><a href="#_request_uri_password">REQUEST_URI_PASSWORD</a></li>
<li><a href="#_request_uri_path">REQUEST_URI_PATH</a></li>
<li><a href="#_request_uri_path_raw">REQUEST_URI_PATH_RAW</a></li>
<li><a href="#_request_uri_port">REQUEST_URI_PORT</a></li>
<li><a href="#_request_uri_raw">REQUEST_URI_RAW</a></li>
<li><a href="#_request_uri_scheme">REQUEST_URI_SCHEME</a></li>
<li><a href="#_request_uri_query">REQUEST_URI_QUERY</a></li>
<li><a href="#_request_uri_username">REQUEST_URI_USERNAME</a></li>
<li><a href="#_response_headers">RESPONSE_HEADERS</a></li>
<li><a href="#_response_line">RESPONSE_LINE</a></li>
<li><a href="#_response_message">RESPONSE_MESSAGE</a></li>
<li><a href="#_response_protocol">RESPONSE_PROTOCOL</a></li>
<li><a href="#_response_status">RESPONSE_STATUS</a></li>
<li><a href="#_server_addr">SERVER_ADDR</a></li>
<li><a href="#_server_port">SERVER_PORT</a></li>
<li><a href="#_tx">TX</a></li>
<li><a href="#_ua">UA</a></li>
</ul>
</li>
<li><a href="#_transformation_functions">Transformation Functions</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_ceil">ceil</a></li>
<li><a href="#_compresswhitespace">compressWhitespace</a></li>
<li><a href="#_count">count</a></li>
<li><a href="#_floor">floor</a></li>
<li><a href="#_htmlentitydecode">htmlEntityDecode</a></li>
<li><a href="#_iceil">iceil</a></li>
<li><a href="#_ifloor">ifloor</a></li>
<li><a href="#_iround">iround</a></li>
<li><a href="#_length">length</a></li>
<li><a href="#_lowercase">lowercase</a></li>
<li><a href="#_max">max</a></li>
<li><a href="#_min">min</a></li>
<li><a href="#_name">name</a></li>
<li><a href="#_names">names</a></li>
<li><a href="#_normalizepath">normalizePath</a></li>
<li><a href="#_normalizepathwin">normalizePathWin</a></li>
<li><a href="#_normalizesqli">normalizeSqli</a></li>
<li><a href="#_normalizesqlpg">normalizeSqlPg</a></li>
<li><a href="#_removewhitespace">removeWhitespace</a></li>
<li><a href="#_round">round</a></li>
<li><a href="#_trim">trim</a></li>
<li><a href="#_trimleft">trimLeft</a></li>
<li><a href="#_trimright">trimRight</a></li>
<li><a href="#_tofloat">toFloat</a></li>
<li><a href="#_tointeger">toInteger</a></li>
<li><a href="#_tostring">toString</a></li>
<li><a href="#_urldecode">urlDecode</a></li>
</ul>
</li>
<li><a href="#_operators">Operators</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_contains">contains</a></li>
<li><a href="#_dfa">dfa</a></li>
<li><a href="#_ee_match_any">ee_match_any</a></li>
<li><a href="#_eq">eq</a></li>
<li><a href="#_ge">ge</a></li>
<li><a href="#_gt">gt</a></li>
<li><a href="#_imatch">imatch</a></li>
<li><a href="#_ipmatch">ipmatch</a></li>
<li><a href="#_ipmatch6">ipmatch6</a></li>
<li><a href="#_is_sqli">is_sqli</a></li>
<li><a href="#_le">le</a></li>
<li><a href="#_lt">lt</a></li>
<li><a href="#_match">match</a></li>
<li><a href="#_ne">ne</a></li>
<li><a href="#_pm">pm</a></li>
<li><a href="#_pmf">pmf</a></li>
<li><a href="#_rx">rx</a></li>
<li><a href="#_streq">streq</a></li>
<li><a href="#_istreq">istreq</a></li>
</ul>
</li>
<li><a href="#_modifiers_and_actions">Modifiers and Actions</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_allow">allow</a></li>
<li><a href="#_event">event</a></li>
<li><a href="#_block">block</a></li>
<li><a href="#_capture_2">capture</a></li>
<li><a href="#_chain">chain</a></li>
<li><a href="#_delrequestheader">delRequestHeader</a></li>
<li><a href="#_delresponseheader">delResponseHeader</a></li>
<li><a href="#_setflag">setflag</a></li>
<li><a href="#_setrequestheader">setRequestHeader</a></li>
<li><a href="#_setresponseheader">setResponseHeader</a></li>
<li><a href="#_setvar">setvar</a></li>
<li><a href="#_status">status</a></li>
<li><a href="#_t">t</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_extending_ironbee">Extending IronBee</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_overview">Overview</a></li>
<li><a href="#_execution_flow">Execution Flow</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_definitions">Definitions</a></li>
<li><a href="#_flow">Flow</a></li>
</ul>
</li>
<li><a href="#_hooks">Hooks</a></li>
<li><a href="#_modules_2">Modules</a></li>
<li><a href="#_writing_modules_in_c">Writing Modules in C</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_anatomy_of_a_c_module">Anatomy of a C Module</a></li>
<li><a href="#_a_simple_c_module_example">A Simple C Module Example</a></li>
</ul>
</li>
<li><a href="#_writing_modules_in_lua">Writing Modules in Lua</a></li>
</ul>
</li>
<li><a href="#_installation_guide">Installation Guide</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_tested_operating_systems">Tested Operating Systems</a></li>
<li><a href="#_general_dependencies">General Dependencies</a></li>
<li><a href="#_building_testing_and_installing_ironbee">Building, Testing and Installing IronBee</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_initial_setup">Initial Setup</a></li>
<li><a href="#_build_and_install_ironbee_manually">Build and Install IronBee Manually</a></li>
<li><a href="#_build_and_install_ironbee_as_an_rpm">Build and Install IronBee as an RPM</a></li>
<li><a href="#_build_and_run_unit_tests_optional">Build and Run Unit Tests(Optional)</a></li>
<li><a href="#_build_doxygen_documents_optional">Build Doxygen Documents(Optional)</a></li>
<li><a href="#_build_docbook_manual_optional">Build Docbook Manual(Optional)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_configuration_examples">Configuration Examples</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_example_trafficserver_configuration">Example Trafficserver Configuration</a></li>
<li><a href="#_example_apache_configuration">Example Apache Configuration</a></li>
<li><a href="#_example_ironbee_configuration">Example IronBee Configuration</a></li>
</ul>
</li>
<li><a href="#_ideas_for_future_improvements">Ideas For Future Improvements</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_directive_loadmodule">Directive: LoadModule</a></li>
<li><a href="#_directive_requestparamsextra">Directive: RequestParamsExtra</a></li>
<li><a href="#_variable_args_extra">Variable: ARGS_EXTRA</a></li>
<li><a href="#_transformation_sqldecode">transformation: sqlDecode</a></li>
</ul>
</li>
<li><a href="#_comparison_with_modsecurity">Comparison with ModSecurity</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_design_and_implementation">Design and Implementation</a></li>
<li><a href="#_configuration_3">Configuration</a></li>
<li><a href="#_rules_2">Rules</a></li>
<li><a href="#_miscellaneous">Miscellaneous</a></li>
<li><a href="#_features_not_supported_yet">Features Not Supported (Yet)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IronBee is a universal web application security framework. Think of
IronBee as a framework for developing a system for securing web
applications - a framework for building a web application firewall (WAF)
if you will.</p>
</div>
<div class="paragraph">
<p>IronBee started in July 2010 through the generous support of Qualys, Inc
(<a href="https://www.qualys.com/">www.qualys.com</a>). The idea was to build a
highly portable web application security framework for the community
with a license that was compatible with business. IronBee was not
intended to be a complete WAF, but rather, be a framework for building a
WAF. But what does this mean? Essentially IronBee gives you some basic
WAF functionality, but leaves most of this open to be extended or
replaced by something more tailored to your environment.</p>
</div>
<div class="paragraph">
<p>As a framework, IronBee&#8217;s goals are as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Be minimalistic in what is contained in the core engine</dt>
<dd>
<p>The IronBee core engine does essentially nothing but expose an API and
an event subsystem. There is no rule language, there is no inspection
and there is only minimal processing of the HTTP transaction cycle.
Everything else is left to modules. Load only the modules that provide
functionality that is required.</p>
</dd>
<dt class="hdlist1">Provide an simple API for data acquisition</dt>
<dd>
<p>Data acquisition is not a part of the IronBee engine. Instead, the
engine exposes an API to allow data to be fed to IronBee in various
ways. Data acquisition is done through server plugins, which must load
the IronBee engine and pass it data. This leaves IronBee open to being
embedded in nearly anything that can pass HTTP data to IronBee.</p>
</dd>
<dt class="hdlist1">Provide an API to allow extension through external modules</dt>
<dd>
<p>To IronBee, modules are everything. Modules utilize the core engine to
implement additional functionality. Currently modules can be written in
C, C++ or Lua, but extending this to other languages is possible as
well.</p>
</dd>
<dt class="hdlist1">Allow for modular inspection</dt>
<dd>
<p>Do not tie inspection to a fixed rule/signature language, but rather,
allow this to be implemented by modules. Different types of inspection
require different means. Because of this, IronBee only exposes a
generic rule execution engine, but does not dictate the language in
which rules are written. Currently, inspection can be performed in a
variety of ways.</p>
</dd>
<dt class="hdlist1">Allow for interaction with external systems</dt>
<dd>
<p>Being a framework, IronBee is meant to be embedded and interact with
other systems. Because of this, IronBee does not dictate how it is
managed. There is no facility for managing configuration, rules or logs.
This is left up to the administrator and/or product that in which
ironbee is embedded. This does not mean that IronBee does not provide
some means for these, but rather it does not dictate them. While this
may seem limiting, it allows for great flexibility in how IronBee is
managed. It is certainly possible to replace the file based
configuration with one that interacts with a database, to manage rules
from an external system and/or write logs to something other than the
filesystem.</p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">About Qualys</div>
<div class="paragraph">
<p>Qualys Inc. (NASDAQ: QLYS), is a pioneer and leading provider of cloud
security and compliance solutions with over 6,000 customers in more than
100 countries, including a majority of each of the Forbes Global 100 and
Fortune 100. The QualysGuard Cloud Platform and integrated suite of
solutions helps organizations simplify security operations and lower the
cost of compliance by delivering critical security intelligence on
demand and automating the full spectrum of auditing, compliance and
protection for IT systems and web applications. Founded in 1999, Qualys
has established strategic partnerships with leading managed service
providers and consulting organizations, including Accuvant, BT, Dell
SecureWorks, Fujitsu, NTT, Symantec, Verizon, and Wipro. The company is
also a founding member of the Cloud Security Alliance (CSA).</p>
</div>
<div class="paragraph">
<p>For more information, please visit
<a href="https://www.qualys.com/">www.qualys.com</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IronBee is a framework and library for web application security
inspection - for building a Web Application Firewall (WAF). There
are several compnents that make up the IronBee framework:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">IronBee Engine</dt>
<dd>
<p>The primary component containing the inspection engine. By itself
the IronBee Library does not do much more than expose an extensive
API in the form of a shared library.</p>
</dd>
<dt class="hdlist1">IronBee Modules</dt>
<dd>
<p>Extensions to the IronBee Engine loaded through the IronBee
Engine configuration. Much of IronBee&#8217;s fuctionality is build
in modules to allow for customizing feature sets and reducing
bloat.</p>
</dd>
<dt class="hdlist1">Server Components</dt>
<dd>
<p>The server is the executable driving the inspection engine. This
can be a standard executable, such as the command line tool, or
in the form of a plugin such as the Apache trafficserver plugin
or the Apache httpd module. The server is responsible for driving
the IronBee Engine by feeding it data, notifying state changes,
and implementing features such as logging, blocking and content
modification.</p>
</dd>
<dt class="hdlist1">Configuration</dt>
<dd>
<p>There are two configurations. The IronBee library must be loaded
and bootstrapped via the native server configuration. After the
IronBee library is loaded, it must be configured via the main
IronBee configuration, which currently resembles an Apache
Webserver configuration.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_software_installation">Software Installation</h3>
<div class="paragraph">
<p>IronBee source is available from github.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/ironbee/ironbee">https://github.com/ironbee/ironbee</a></p>
</div>
<div class="paragraph">
<p>The source follows standard build conventions, typically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./configure --prefix=/usr/local/ironbee
make
make check
sudo make install</pre>
</div>
</div>
<div class="paragraph">
<p>Various options are available for customization through the configure
script. A full list of these options are available with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./configure --help</pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#_installation_guide">Installation Guide</a> for more detailed instructions on
building and installing IronBee.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>First, the server component must be configured to load the IronBee
library and point IronBee to its own onfiguration. This is done
through the server&#8217;s native configuration and differs for each server.
See the <a href="#_configuration_examples">Configuration Examples</a> for more specific details in
configuring the server component. Once the server component is loaded,
IronBee configuration consists of one or more configuration files which
IronBee will read. While the server configuration differs between
the various server types, the IronBee configuration is not server
specific and can be shared across different server types.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_inspection">Data Inspection</h3>
<div class="paragraph">
<p>The IronBee library is fed data by the server. This server could be a
command line tool (see clipp), a webserver or HTTP proxy. IronBee will
expose data via fields. A data field specifies a name, type
and value which can then be used for inspection via rules. Rules can be
simple signatures against fields, a chained set of operations, stream
based matchers, modules or lua scripts. Each rule can inspect
fields and perform actions.</p>
</div>
<div class="paragraph">
<p>For more details on using inspecting data, see the capter on
<a href="#_inspection">Inspection</a>.</p>
</div>
<div class="sect3">
<h4 id="_input">Input</h4>
<div class="paragraph">
<p>IronBee supports two primary types of input in the form of data fields:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Scalars</dt>
<dd>
<p>  Fields which can contain data of various types (strings, numbers
or streams)</p>
</dd>
<dt class="hdlist1">Collections</dt>
<dd>
<p>Fields which contain zero or more scalars</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As fields are built from external data (parsed HTTP traffic), field
names and values can contain any binary data. While the names of fields
are not restricted, by convention the names of built-in fields are
written using all uppercase letters. See the <a href="#_data_fields">Data Fields</a> section
in the <a href="#_rule_reference">Rule Reference</a> for a list of predefined data fields.</p>
</div>
<div class="sect4">
<h5 id="_addressing_fields">Addressing Fields</h5>
<div class="paragraph">
<p>How you use fields depends on the context. The rules, for example,
typically accept one or more data fields, which means that you can give
a rule a scalar field (e.g., <code>REQUEST_URI</code>) or a collection field (e.g.,
<code>ARGS</code>). When you give a rule a collection, it will extract all scalar
fields and utilize them as if they were each specified separately.</p>
</div>
<div class="paragraph">
<p>Collections can be used as a whole, or with a selector applied. A
selector is applied with the colon operator. For example, you may want
to extract all <code>username</code> arguments as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ARGS:username</pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note that selectors are filters and what is returned
is a list of values which may have zero or more fields. In addition to
using names as selectors, you also use regular expression patterns as
selectors by bracketing a regular expression with backslashes. IronBee
uses the Perl Compatible Regular Expression (PCRE) syntax. For example,
the following selects all fields whose names begin with "<code>user</code>".</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ARGS:/^user/</pre>
</div>
</div>
<div class="paragraph">
<p>If a field name contains unusual characters (e.g., colon, whitespace,
etc.), you can quote the entire name using double quotes and then use
most characters without fear of breaking anything. The first colon is
used as the delimiter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"ARGS:my strange:name"</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_field_transformations">Field Transformations</h5>
<div class="paragraph">
<p>Data often needs to be transformed or normalized before it can be used
effectively. This is accomplished via transformations. Transformations
can be applied to individual fields or to all fields within a rule. For
appying transformations to all fields in a rule, see the <a href="#_t">t</a> rule
modifier, which is essentially a shorthand notation for applying the
same transformation to each individual field. Individual fields can be
transformed independently via the dot syntax with parens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ARGS.lowercase()
ARGS:name.lowercase()</pre>
</div>
</div>
<div class="paragraph">
<p>In addition to manipulating the field value, a transformation may also
change the field type. For example, from a collection or string to a
number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Collection count: Collection to number
ARGS.count()

# Field data length: String to number
REQUEST_HEADERS:User-Agent.length()

# Explicit conversion
REQUEST_HEADERS:Content-Length.toInteger()</pre>
</div>
</div>
<div class="paragraph">
<p>Multiple transformations are also supported through multiple use
of the <code>t</code> rule modifier or by chaining via the dot notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ARGS.compressWhitespace().length()</pre>
</div>
</div>
<div class="paragraph">
<p>A list of transformations can be seen in the <a href="#_transformation_functions">Transformation Functions</a>
section.</p>
</div>
</div>
<div class="sect4">
<h5 id="_field_expansion">Field Expansion</h5>
<div class="paragraph">
<p>In addition to using fields as input to rules, there is often a need
to use a field in text strings, such as adding raw values for logging
via the <code>logdata</code> rule modifier. This can be achieved using field
expansion. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>logdata:%{NAME}
setvar:MY_COLLECTION:%{NAME}=1</pre>
</div>
</div>
<div class="paragraph">
<p>If the expression resolves to a scalar value, the entire <code>%{NAME}</code>
expression will be replaced with that value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
An expanded field is converted to a string representation no matter
the type of the expanded field. If you require another type, such as integer,
then you will need to use an intermediate variable (see the <a href="#_setvar">setvar</a>
action) and then perform an explicit conversion (see the <a href="#_tointeger">toInteger</a>
and similar type conversion transformations). Though, this should be a
rare use case.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rules">Rules</h4>
<div class="paragraph">
<p>TODO: Update with waggle/Predicate information.</p>
</div>
<div class="paragraph">
<p>IronBee currently defines three types of rules. There is a basic pattern
matching rule language, a more limited streaming version of the pattern
matching rule language, as well as the ability to specify more complex
rules which syntax is processed external to the configuration file.
Currently the only external rule type is via the Lua scripting language,
but more may be handled in the future. In addition to external rules,
the rule processing engine and configuration syntax are decoupled,
allowing modules to be developed to provide alternate custom rules which
interact with the same rule execution engine.</p>
</div>
<div class="paragraph">
<p>More information can be found in the <a href="#_inspection">Inspection</a> section.</p>
</div>
<div class="sect4">
<h5 id="_basic_matching_rules">Basic Matching Rules</h5>
<div class="paragraph">
<p>Basic matching rules are configured via the <code>Rule</code> directive. These
rules include a list of fields containing the data to be inspected, an
operator with parameter to perform the inspection, and modifiers which
specify metadata attributes as well as any actions to be taken.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule REQUEST_HEADERS ARGS @rx "Some.*Pattern" \
    id:1 rev:1 phase:REQUEST event block:phase</pre>
</div>
</div>
<div class="paragraph">
<p>Basic matching rules will iterate through the list of fields (and
sub-fields within collections), executing the specified operator and
performing any required actions. Currently, the order in which the rule
executes depends on both the specified phase as well as the order in
which the rule is specified in the configuration.</p>
</div>
<div class="paragraph">
<p>The phase information, assigned to the rule via the phase modifier,
determines when a rule will run within transaction lifecycle. Within a
phase, configuration determines how rules are ordered. When a rule is
read from the configuration files, it is appended to the list of rules
in the desired phase. At run-time, the engine will process all of the
rules one by one until interrupted.</p>
</div>
</div>
<div class="sect4">
<h5 id="_stream_matching_rules">Stream Matching Rules</h5>
<div class="paragraph">
<p>While the basic matching rules are quite flexible, they are limited to
executing only once in the given phase. With this limitation, you can
only inspect data that is available at the time of execution. To do this
effectively, the data must be buffered so that it can all be inspected
in a single pass. Streaming inspection allows you to avoid buffering
potentially large amounts of data by inspecting the data in smaller
chunks. With this, however, comes restrictions.</p>
</div>
<div class="paragraph">
<p>The StreamInspect directive allows inspecting a limited set of fields
(currently only the raw request and response bodies as of version 0.7)
in smaller chunks as the data arrives. Instead of the rule executing
only a single time, it may instead execute many times - once for each
chunk of data. Because of this, stream based rules do not have a phase
associated with them. In addition to this difference from the basic
matching rules, stream based rules cannot (currently) be transformed and
allow only a limited set of operators (currently <code>dfa</code>, <code>ee_match_any</code>
as of version 0.8).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>StreamInspect REQUEST_BODY_STREAM \
    @dfa "(?i)Content-Disposition(?:[^\r\n]*)attachment|form-data|filename" \
    id:1 rev:1 "msg:Possible file upload" event</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_external_rules">External Rules</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
External Lua rules are being considered for deprecation in favor of
Lua modules. Lua modules are far more powerful and efficient and are
no more difficult to write than Lua rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Due to the simple rule syntax and confines of the configuration
language, both basic and stream matching rules only allow for simple
matching logic. Some more advanced logic can be obtained through
features such as rule chaining, however when more control is required,
external rules are available. External rules refer to a rule defined
externally to the configuration and can thus be much more expressive.
Currently the Lua scripting language is available through external rules
via the <code>RuleExt</code> directive, which refers to an external lua script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>RuleExt lua:example.lua id:1 rev:1 phase:REQUEST_HEADER</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>-- example.lua
local ib = ...

-- This must be defined before assignment
-- so that the self-recursive call uses
-- the local variable instead of a global.
local printValues
local k
local v

-- Create a local function for printing values
printValues = function(name,value)
  if value then
    if type(value) == 'table' then
      -- Print the table.
      for k,v in pairs(value) do
        printValues(name.."."..k, v)
      end
    else
      ib:logInfo(name.."="..value)
    end
  end
end

-- Create a local function to fetch/print fields
local fieldPrint = function(name)
  printValues(name, ib:get(name))
end

-- Print out all the available fields
for k,v in pairs(ib:getFieldList()) do
  fieldPrint(v)
end

-- Return the result (0:FALSE 1:TRUE) to the rule engine
return 0</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_common_rule_components">Common Rule Components</h5>
<div class="paragraph">
<p>Most rules share a common set of metadata attributes and modifiers.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Metadata</dt>
<dd>
<p>Rule metadata is specified using the following modifiers.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p>Globally unique rule identifier. It is recommended that all
rule IDs within a set have at least a common prefix, such as
<code>vendorPrefix/vendorRuleId</code>. Additionally, you are encouraged to
further delimit by category or type. For example: <code>qualys/sqli/5</code>.</p>
</dd>
<dt class="hdlist1">rev</dt>
<dd>
<p>  Revision, which is used to differentiate between revisions
of the same rule; it defaults to 1 if not specified.</p>
</dd>
<dt class="hdlist1">msg</dt>
<dd>
<p>  Message that will be used when the rule triggers. Rules that
generate events must define a message.</p>
</dd>
<dt class="hdlist1">tag</dt>
<dd>
<p>  Assigns a tag to the rule; One or more tags are used to
classify rules and events (as events inherit all tags from the
rule that generates them).</p>
</dd>
<dt class="hdlist1">phase</dt>
<dd>
<p>  Determines when the rule will execute (Not available in
streaming rules as these are triggered on new data).</p>
</dd>
<dt class="hdlist1">severity</dt>
<dd>
<p>Determines the seriousness of the finding (0-100).</p>
</dd>
<dt class="hdlist1">confidence</dt>
<dd>
<p>Determines the confidence the rule has in its logic (0-100).</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_events">Events</h4>
<div class="paragraph">
<p>During a transaction, one or more events may be generated (see the
<a href="#_event">event</a> action). Each event has the following attributes - many of which
are modified by rule metadata.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Event ID</dt>
<dd>
<p>Uniquely generated (for the transaction) event identifier.</p>
</dd>
<dt class="hdlist1">Event Type</dt>
<dd>
<p>Type of event. Currently this is one of:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Observation</dt>
<dd>
<p>An event which may contribute to a further decision.</p>
</dd>
<dt class="hdlist1">Alert</dt>
<dd>
<p>An event which denotes the transaction should be logged.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">Rule ID</dt>
<dd>
<p>The rule which created the event, if it was generated by a rule.</p>
</dd>
<dt class="hdlist1">Field(s)</dt>
<dd>
<p>An optional list of inspected fields which contributed to the event.</p>
</dd>
<dt class="hdlist1">Tag(s)</dt>
<dd>
<p>An optional list of tags used to classify the event.</p>
</dd>
<dt class="hdlist1">Data</dt>
<dd>
<p>Arbitrary data associated with the event. This is to be treated as
opaque binary data.</p>
</dd>
<dt class="hdlist1">Message</dt>
<dd>
<p>A text message associated with the event.</p>
</dd>
<dt class="hdlist1">Confidence</dt>
<dd>
<p>A positive integer value ranging from 0-100 denoting the percent of
confidence that the event is accurate.</p>
</dd>
<dt class="hdlist1">Severity</dt>
<dd>
<p>A positive integer value ranging from 0-100 denoting the severity
(weight) that this event may pose if accurate.</p>
</dd>
<dt class="hdlist1">Recommended Action</dt>
<dd>
<p>The event creator is recommending an action to be taken. This is
currently one of:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Log</dt>
<dd>
<p>Log the transaction.</p>
</dd>
<dt class="hdlist1">Block</dt>
<dd>
<p>Block the transaction.</p>
</dd>
<dt class="hdlist1">Ignore</dt>
<dd>
<p>Allow the transaction without further inspection.</p>
</dd>
<dt class="hdlist1">Allow</dt>
<dd>
<p>Allow the transaction, but continue inspecting.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">Suppression</dt>
<dd>
<p>Denotes the event should be suppressed and for what reason. Currently
this is one of:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">None</dt>
<dd>
<p>The event is not to be suppressed.</p>
</dd>
<dt class="hdlist1">False Positive</dt>
<dd>
<p>The event was determined to be a false positive.</p>
</dd>
<dt class="hdlist1">Replaced</dt>
<dd>
<p>The event was replace with a later event.</p>
</dd>
<dt class="hdlist1">Incomplete</dt>
<dd>
<p>The event may contain incomplete information or be based off of
incomplete information.</p>
</dd>
<dt class="hdlist1">Other</dt>
<dd>
<p>The event was supressed for an unspecified reason.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_request_and_response_body_handling">Request and Response Body Handling</h4>
<div class="paragraph">
<p>Request and response headers are generally limited in size and thus easy
to handle. This is especially true in a proxy deployment, where
buffering is possible. Proxies will typically cache request and response
headers, making it easy to perform inspection and reliably block when
necessary.</p>
</div>
<div class="paragraph">
<p>The situation is different with request and response bodies, which can
be quite large. For example, request bodies may carry one or more files;
response bodies too often deliver files, and some HTML responses can get
quite large as well. Even when sites do not normally have large request
bodies, they are under the control of attackers, and they may
intentionally submit large amounts of data in an effort to bypass
inspection.</p>
</div>
<div class="paragraph">
<p>TODO: Go more into inspection and buffering options.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at what might be of interest here:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Inspection</dt>
<dd>
<p>Do we want to inspect a particular request or response body? Whereas
it would be rare not to want inspect a request body, it&#8217;s quite common
with response bodies, because many carry static files and images. We
can decide by looking at the <code>Content-Type</code> header.</p>
</dd>
<dt class="hdlist1">Processing</dt>
<dd>
<p>After we decide to inspect a body, we need to determine how to process
it, after which inspection can take place. It&#8217;s only in the simplest
case, when the body is treated as a continuous stream of bytes, is
that no processing is needed. Content types such as
<code>application/x-www-form-urlencoded</code> and <code>multipart/form-data</code> must be
parsed before fine-grained analysis can be undertaken. In many cases
we may need to process a body in more than one way to support all the
desired approaches to analysis.</p>
</dd>
<dt class="hdlist1">Buffering</dt>
<dd>
<p>Reliable blocking is possible only when all of the data is buffered:
accumulate the entire request (or response) until the inspection is
complete, and then you release it all once. Blocking without buffering
can be effective, but such approach is susceptible to evasion in edge
cases. The comfort of reliable blocking comes at a price. End user
performance may degrade, because rather than receiving data as it
becomes available, the proxy must wait to receive the last byte of the
data to let it through. In some cases (e.g., WebSockets) there is an
expectation that chunks of data travel across the wire without delay.
And, of course, buffering increases memory consumption required for
inspection.</p>
</dd>
<dt class="hdlist1">Logging</dt>
<dd>
<p>Finally, we wish to be able to log entire transaction for
post-processing or evidence. This is easy to do when all of data is
buffered, but it should also be possible even when buffering is not
enabled.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_request_body_processing">Request body processing</h5>
<div class="paragraph">
<p>IronBee comes with built-in logic that controls the default handling of
request body data. It will correctly handle
<code>application/x-www-form-urlencoded</code> and <code>multipart/form-data</code> requests.
Other formats will be added as needed.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_server_configuration">Server Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#8230;</p>
</div>
<div class="sect2">
<h3 id="_apache_trafficserver_plugin_configuration">Apache Trafficserver Plugin Configuration</h3>
<div class="paragraph">
<p>In order to load IronBee into Apache Trafficserver (ATS) you must edit
plugins.config to first load the IronBee library using the ATS loader
plugin, then load the IronBee plugin with an IronBee configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>### plugins.config
# Load the IronBee library
/usr/local/ironbee/lib/libloader.so /usr/local/ironbee/lib/libironbee.so

# Load the IronBee plugin
/usr/local/ironbee/lib/ts_ironbee.so /usr/local/ironbee/etc/ironbee-ts.conf</pre>
</div>
</div>
<div class="sect3">
<h4 id="_trafficserver_library_loader_plugin">TrafficServer Library Loader Plugin</h4>
<div class="paragraph">
<p><strong>Description:</strong> Load arbitrary shared libraries.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> `libloader.so `</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>none</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.5.0</p>
</div>
<div class="paragraph">
<p>If TxLogging is enabled, it may also be necessary to load <em>libyajl
version 2.x</em> with libloader.</p>
</div>
</div>
<div class="sect3">
<h4 id="_trafficserver_ironbee_plugin">TrafficServer IronBee Plugin</h4>
<div class="paragraph">
<p><strong>Description:</strong> Bootstrap the trafficserver ironbee plugin.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> `ts_ironbee.so `</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>none</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.8.0</p>
</div>
<div class="paragraph">
<p>The default log filename is "ts-ironbee.log" and log level 4. The
optional <em>-l name</em> sets a different name, while <em>-v n</em> sets a log level,
and <em>-L</em> disables logging Ironbee messages by Trafficserver altogether
(for users with an alternative logger configured).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_apache_httpd_module_configuration">Apache Httpd Module Configuration</h3>
<div class="paragraph">
<p>In order to load IronBee into Apache httpd you must edit the httpd.conf
to first load the IronBee module, then configure the module to bootstrap
the IronBee library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>### httpd.conf

# Load the IronBee module
LoadModule ironbee_module /usr/local/ironbee/lib/mod_ironbee.so

# Bootstrap the IronBee library
&lt;IfModule ironbee_module&gt;
    # Specify the IronBee configuration file.
    IronbeeConfigFile /usr/local/ironbee/etc/ironbee-httpd.conf

    # Send raw headers (from client) to Ironbee for inspection
    # instead of the (potentially modified) httpd headers.
    IronbeeRawHeaders On
&lt;/IfModule&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>From here, you can configure Apache httpd as either a webserver or a
proxy server.</p>
</div>
<div class="sect3">
<h4 id="_ironbeeconfigfile">IronbeeConfigFile</h4>
<div class="paragraph">
<p><strong>Description:</strong> Location of the main IronBee configuration file.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> `IronbeeConfigFile `</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>none</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.5.0</p>
</div>
</div>
<div class="sect3">
<h4 id="_ironbeerawheaders">IronbeeRawHeaders</h4>
<div class="paragraph">
<p><strong>Description:</strong> Use the raw (client) headers or the proxy headers in
ironbee.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>IronbeeRawHeaders On|Off</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>On</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.5.0</p>
</div>
<div class="paragraph">
<p>Setting this to <code>On</code> will cause IronBee to be sent the raw headers from
the client. Setting this to <code>Off</code> will cause IronBee to be sent the
proxied headers (those seen by the server).</p>
</div>
</div>
<div class="sect3">
<h4 id="_ironbeefilterinput">IronbeeFilterInput</h4>
<div class="paragraph">
<p><strong>Description:</strong> Filter HTTP request body data.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>IronbeeFilterInput On|Off</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>On</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.8.0</p>
</div>
<div class="paragraph">
<p>Determines whether HTTP request bodies (where present) are sent to
Ironbee for inspection.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ironbeefilteroutput">IronbeeFilterOutput</h4>
<div class="paragraph">
<p><strong>Description:</strong> Filter HTTP response body data.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>IronbeeFilterOutput On|Off</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>On</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.8.0</p>
</div>
<div class="paragraph">
<p>Determines whether HTTP response bodies (where present) are sent to
Ironbee for inspection.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ironbeelog">IronbeeLog</h4>
<div class="paragraph">
<p><strong>Description:</strong> Enable/Disable apache logging.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>IronbeeLog On|Off</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>On</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.8.0</p>
</div>
<div class="paragraph">
<p>Determines whether Ironbee messages are logged to the HTTPD error log.
If disabled, some other logger should be configured.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ironbeeloglevel">IronbeeLogLevel</h4>
<div class="paragraph">
<p><strong>Description:</strong> Set default Ironbee log level.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>IronbeeLogLevel 0-9</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>4</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.8.0</p>
</div>
<div class="paragraph">
<p>Sets the initial log level for Ironbee messages (ignored if IronbeeLog
is Off).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nginx_configuration">Nginx Configuration</h3>
<div class="paragraph">
<p>In configure IronBee in nginx you must edit the nginx.conf to bootstrap
the IronBee library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>### nginx.conf

...

http {
    # Bootstrap the IronBee library
    ironbee_config_file /usr/local/ironbee/etc/ironbee-httpd.conf;

    # Setup logging
    ironbee_logger On;
    ironbee_loglevel 4;

    ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>From here, you can configure nginx.</p>
</div>
<div class="sect3">
<h4 id="_ironbee_config_file">ironbee_config_file</h4>
<div class="paragraph">
<p><strong>Description:</strong> Location of the main IronBee configuration file.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>ironbee_config_file ;</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>none</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.7.0</p>
</div>
<div class="paragraph">
<p>This needs to go in the nginx "http" block.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ironbee_logger">ironbee_logger</h4>
<div class="paragraph">
<p><strong>Description:</strong> Enable the ironbee logger.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>ironbee_logger "On"|"Off";</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>none</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.7.0</p>
</div>
<div class="paragraph">
<p>This needs to go in the nginx "http" block.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ironbee_loglevel">ironbee_loglevel</h4>
<div class="paragraph">
<p><strong>Description:</strong> Set the (numeric) ironbee log level.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong> <code>ironbee_loglevel
                ;</code></p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>none</code></p>
</div>
<div class="paragraph">
<p><strong>Version:</strong> 0.7.0</p>
</div>
<div class="paragraph">
<p>This needs to go in the nginx "http" block.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ironbee_configuration">IronBee Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The IronBee configuration is loaded from the server container. The
syntax is similar to the Apache httpd server configuration. The
following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Escape sequences are as in JavaScript (section 7.8.4 in ECMA-262),
except within PCRE regular expression patterns, where PCRE escaping is
used</p>
</li>
<li>
<p>Lines that begin with <code>#</code> are comments</p>
</li>
<li>
<p>Lines are continued on the next line when <code>\</code> is the last character on
a line</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The IronBee configuration defines general configuration as well as site
and location mappings, which can each have their own configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Main Configuration
SensorId 13AABA8F-2575-4F93-83BF-C87C1E8EECCE
...

# Site1
&lt;Site site1&gt;
    SiteId 0B781B90-CE3B-470C-952C-5F2878EFFC05
    Hostname site1.example.com
    Service 10.0.1.100:80

    ...

    &lt;Location /directory1&gt;
        ...
    &lt;/Location&gt;
&lt;/Site&gt;

# Site2
&lt;Site site2&gt;
    SiteId 8B3BA3DE-2727-4737-9230-4A1D110E6C87
    Hostname site2.example.com
    Service 10.0.5.100:80

    ...
&lt;/Site&gt;

# Default Site
&lt;Site default&gt;
    SiteId F89E43B3-EB96-44F0-BE1C-B4673B96DF9C
    Hostname *
    Service *:*

    ...
&lt;/Site&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The following is a reference for all IronBee directives where the
context refers to the possible locations within the configuration file.</p>
</div>
<div class="sect2">
<h3 id="_action">Action</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads a rule that will always execute its actions and,in most contexts, enable the rule for execution in that context.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Action id:1234 rev:1 phase:THE_PHASE ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This is shorthand and functionally equivilant to a rule with no targets
and an operator that always returns true. Internally this is represented as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># These are equivilents
Rule NULL @nop "" ...
Action ...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Loading a rule will, in most contexts, also enable the rule to be
executed in that context. However, the main configuration context is
special. Loading a rule in the main configuration context will <em>NOT</em>
enable the rule, but just load it into memory so that it can be shared
by other contexts. You must explicitly use <code>RuleEnable</code> in another
context to enable the rule.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_auditengine">AuditEngine</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the audit log engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditEngine On|Off|RelevantOnly</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RelevantOnly</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Setting <code>AuditEngine</code> to <code>RelevantOnly</code>, the default, does not log any
transactions in itself. Instead, further activity (e.g., a rule match)
is required for a transaction to be recorded. Setting <code>AuditEngine</code> to
<code>On</code> activates audit logging for <strong>all transactions</strong>, which may cause a
large amount of data to be logged.</p>
</div>
</div>
<div class="sect2">
<h3 id="_auditlogbasedir">AuditLogBaseDir</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the directory where individual audit logentries will be stored. This also serves as the base directory for <code>AuditLogIndex</code> if it uses a relative path.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditLogBaseDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"/var/log/ironbee"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_auditlogdirmode">AuditLogDirMode</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the directory mode that will be used for newdirectories created during audit logging.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditLogDirMode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0700</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_auditlogfilemode">AuditLogFileMode</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the file mode that will be used when creatingindividual audit log files.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditLogFileMode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0600</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_auditlogindex">AuditLogIndex</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the location of the audit log index file.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditLogIndex None|&lt;location&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ironbee-index.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Relative filenames are based off the <code>AuditLogBaseDir</code> directory and
specifying <code>None</code> disables the index file entirely.</p>
</div>
</div>
<div class="sect2">
<h3 id="_auditlogindexformat">AuditLogIndexFormat</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the format of the entries logged in the auditlog index file.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditLogIndexFormat</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"%T %h %a %S %s %t %f"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="ulist">
<ul>
<li>
<p><strong>%%</strong> The percent sign</p>
</li>
<li>
<p><strong>%a</strong> Remote IP-address</p>
</li>
<li>
<p><strong>%A</strong> Local IP-address</p>
</li>
<li>
<p><strong>%h</strong> HTTP Hostname</p>
</li>
<li>
<p><strong>%s</strong> Site ID</p>
</li>
<li>
<p><strong>%S</strong> Sensor ID</p>
</li>
<li>
<p><strong>%t</strong> Transaction ID</p>
</li>
<li>
<p><strong>%T</strong> Transaction timestamp (YYYY-MM-DDTHH:MM:SS.ssss+/-ZZZZ)</p>
</li>
<li>
<p><strong>%f</strong> Audit log filename (relative to <code>AuditLogBaseDir</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_auditlogparts">AuditLogParts</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures which parts will be logged to the audit log.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditLogPart ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>An audit log consist of many parts; <code>AuditLogParts</code> determines which
parts are recorded by default. The parts are inherited into child
contexts (Site, Location, etc). Specifying a part with +/- operator will
add or remove the given part from the current set of parts. Specifying
the first option without +/- operators will cause all options to be
overridden and the list of options will be the only options set. Here is
what your configuration might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AuditLogParts minimal +request -requestBody +response -responseBody</pre>
</div>
</div>
<div class="paragraph">
<p>The above first resets the list of parts to <strong>minimal</strong>, adds all the
<strong>request</strong> parts except the <strong>requestBody</strong>, then adds all the <strong>response</strong>
parts except the <strong>responseBody</strong>.</p>
</div>
<div class="paragraph">
<p>Later, in a sub-context, you may wish to enable response body logging
and thus can just specify this part with the + operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Location /some/path&gt;
    AuditLogParts
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If you already had response body logging enabled, but didn&#8217;t want it any
more, you would write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Location /some/path&gt;
    AuditLogParts
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Audit Log Part Names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>header:</strong> Audit Log header (required)</p>
</li>
<li>
<p><strong>events:</strong> List of events that triggered</p>
</li>
<li>
<p><strong>requestMetadata:</strong> Information about the request</p>
</li>
<li>
<p><strong>requestHeaders:</strong> Raw request headers</p>
</li>
<li>
<p><strong>requestBody:</strong> Raw request body</p>
</li>
<li>
<p><strong>requestTrailers:</strong> Raw request trailers</p>
</li>
<li>
<p><strong>responseMetadata:</strong> Information about the response</p>
</li>
<li>
<p><strong>responseHeaders:</strong> Raw response headers</p>
</li>
<li>
<p><strong>responseBody:</strong> Raw response body</p>
</li>
<li>
<p><strong>responseTrailers:</strong> Raw response trailers</p>
</li>
<li>
<p><strong>debugFields:</strong> Currently not implemented</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Audit Log Part Group Names:</p>
</div>
<div class="paragraph">
<p>These are just aliases for multiple parts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none:</strong> Removes all parts</p>
</li>
<li>
<p><strong>minimal:</strong> Minimal parts (currently <strong>header</strong> and <strong>events</strong> parts)</p>
</li>
<li>
<p><strong>default:</strong> Default parts (currently <strong>minimal</strong> and request/response
parts without bodies)</p>
</li>
<li>
<p><strong>request:</strong> All request related parts</p>
</li>
<li>
<p><strong>response:</strong> All response related parts</p>
</li>
<li>
<p><strong>debug:</strong> All debug related parts</p>
</li>
<li>
<p><strong>all:</strong> All parts</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_auditlogsubdirformat">AuditLogSubDirFormat</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the directory structure created under the_AuditLogBaseDir_ directory. This is a <em>strftime(3)</em> format string allowing the directory structure to be created based on date/time.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditLogSubDirFormat</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>403</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_defaultblockstatus">DefaultBlockStatus</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the default HTTP status code used forblocking.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultBlockStatus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>403</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_geoipdatabasefile">GeoIPDatabaseFile</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the location of the geoip database file.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoIPDatabaseFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/usr/share/geoip/GeoLiteCity.dat</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">geoip</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_hostname">Hostname</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps hostnames to a Site.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hostname</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code> (any)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>Hostname</code> directive establishes a mapping between a Site and one or
more hostnames. To map IP/Port pairs to a Site, see the <code>Service</code>
directive.</p>
</div>
<div class="paragraph">
<p>In the simplest case, a site will occupy a single hostname:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hostname www.ironbee.com</pre>
</div>
</div>
<div class="paragraph">
<p>More often than not, however, several names will be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hostname www.ironbee.com
Hostname ironbee.com</pre>
</div>
</div>
<div class="paragraph">
<p>Wildcards are permitted when there are multiple names under a common
domain. Only one wildcard character per hostname is allowed and it must
currently be on the left-hand side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hostname ironbee.com
Hostname *.ironbee.com</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, to match any hostname (which you will need to do in default
sites), use a single asterisk, which is the default if no <code>Hostname</code>
directive is specified for a site:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hostname *</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_include">Include</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes external file into configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Include</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Allows inclusion of another file into the current configuration file.
The following line will include the contents of the file <code>sites.conf</code>
into configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Include conf/sites.conf</pre>
</div>
</div>
<div class="paragraph">
<p>The file must exist and be accessible or an error is generated (use
<code>IncludeIfExists</code> if this is not the case). If you specify a relative
path, the location of the configuration file containing this directive
will be used to resolve it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_includeifexists">IncludeIfExists</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes external file into configuration if it existsand is accessible.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IncludeIfExists</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>As <code>Include</code>, but allows for optional inclusion without causing a
configuration error if the file does not exist (as would the <code>Include</code>
directive).</p>
</div>
</div>
<div class="sect2">
<h3 id="_initcollection">InitCollection</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initializes a locally scoped collection data field forlater use and optional persistence.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitCollection</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core, persist</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Initializes a collection from the initializer. The initializer format
depends on the implementation. There are multiple URI formats supported,
which are described below.</p>
</div>
<div class="sect3">
<h4 id="_core_functionality">Core Functionality</h4>
<div class="paragraph">
<p><code>vars: key1=val1 key2=val2 ... keyN=valN</code></p>
</div>
<div class="paragraph">
<p>The <code>vars</code> URI allows initializing a collection of simple key/value
pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection MY_VARS vars: key1=value1 key2=value2</pre>
</div>
</div>
<div class="paragraph">
<p><code>json-file:///path/file.json [persist]</code></p>
</div>
<div class="paragraph">
<p>The json-file URI allows loading a more complex collection from a JSON
formatted file. If the optional persist parameter is specified, then
anything changed is persisted back to the file at the end of the
transaction. Next time the collection is initialized, it will be from
the persisted data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection MY_JSON_COLLECTION json-file:///tmp/ironbee/persist/test1.json
InitCollection MY_PERSISTED_JSON_COLLECTION json-file:///tmp/ironbee/persist/test2.json persist</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_persist_module">Persist Module</h4>
<div class="paragraph">
<p>The persist module allows for some more advanced persistence, such as
providing multiple instances of persisted collection as well as
expiration. To load this functionality you must load the persist module
separately.</p>
</div>
<div class="paragraph">
<p><code>persist-fs:///path/to/persisted/data key=VALUE
                [expire=SECONDS]</code></p>
</div>
<div class="paragraph">
<p>The <code>persist-fs</code> URI allows specifying a path to store persisted data.
The <code>key</code> parameter specifies a value to identify an instance of the
collection. The <code>key</code> value can be any text or a field expansion (e.g.,
<code>%{MY_VAR_NAME}</code>). The <code>expire</code> parameter allows setting the expiration
of the data stored in the collection in seconds. On initialization, the
collection is populated from the persisted data. If the data is expired
when the collection is initialized, it is discarded and an empty
collection will be created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LoadModule ibmod_persist.so

...

# Initialize a collection from the persistence store keyed off of REMOTE_ADDR.
# The IP collection is now associated with the REMOTE_ADDR and any updates
# will be persisted back to the persistence store with the REMOTE_ADDR key.
# Different instances of the IP collection are stored based on the key. The
# data stored in this collection will expire 300 seconds after persisted.
InitCollection IP persist-fs:///tmp/ironbee/persist key=%{REMOTE_ADDR} expire=300

# Check a value from the persisted collection to determine if a block should
# occur.
Rule IP:block @gt 0 id:persist/isblocked phase:REQUEST_HEADER event block:immediate

# Perform some checks, setting block flag.
Rule ... block

# Update the persistent IP collection. This will store a block=1 parameter
# for the IP collection associated with the REMOTE_ADDR key. If the IP collection
# is pulled from the store again (within the expiration), then the rule above
# will immediatly block the transaction.
Rule FLAGS:block.count() @gt 0 id:persist/setblock phase:REQUEST setvar:IP:block=1

# After the transaction completes, the modified values are persisted and the
# persisted IP:block=1 will be used to block all transactions from the same IP
# address for the next 300 seconds.</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_initvar">InitVar</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initializes a locally scoped variable data field forlater use.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitVar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_inspectionengineoptions">InspectionEngineOptions</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures options for the inspection engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InspectionEngineOptions ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The inspection engine allows setting options; <code>InspectionEngineOptions</code>
controls these options. The options are inherited into child contexts
(Site, Location, etc). Specifying an option with +/- operator will add
or remove the given option from the current set. Specifying the first
option without +/- operators will cause all options to be overridden and
the list of options will be the only options set. Here is what your
configuration might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InspectionEngineOptions all -response</pre>
</div>
</div>
<div class="paragraph">
<p>The above first resets the inspection to <strong>all</strong>, then removes the
<strong>response</strong> from being inspected.</p>
</div>
<div class="paragraph">
<p>Later, in a sub-context, you may wish to enable response response
inspection and thus can just specify this part with the + operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Location /some/path&gt;
    InspectionEngineOptions
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If you already had response enabled, but didn&#8217;t want it any more, you
would write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Location /some/other/path&gt;
    InspectionEngineOptions
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Inspection Engine Options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>requestHeader:</strong> Inspect the HTTP request header (default)</p>
</li>
<li>
<p><strong>requestBody:</strong> Inspect the HTTP request body</p>
</li>
<li>
<p><strong>responseHeader:</strong> Inspect the HTTP response header</p>
</li>
<li>
<p><strong>responseBody:</strong> Inspect the HTTP response body</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inspection Engine Option Group Names:</p>
</div>
<div class="paragraph">
<p>These are just aliases for multiple options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none:</strong> Removes all options</p>
</li>
<li>
<p><strong>default:</strong> Default options (currently request header only)</p>
</li>
<li>
<p><strong>request:</strong> All request related options</p>
</li>
<li>
<p><strong>response:</strong> All response related options</p>
</li>
<li>
<p><strong>all:</strong> All options</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_loadeudoxus">LoadEudoxus</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads an external Eudoxus Automata into IronBee.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LoadEudoxus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ee</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This directive will load an external eudoxus automata from <code>file</code> into
the engine with the given <code>name</code>. Once loaded, the automata can then be
used with the associated eudoxus rule operators such as the
<code>ee_match_any</code> operator.</p>
</div>
<div class="paragraph">
<p>The eudoxus automata is a precompiled and optimized automata generated
by the ac_generator and ec commands in the <code>automata/bin</code> directory.
Currently, as of IronBee 0.7, a modified Aho-Corasick algorithm is
implemented which can handle very large external dictionaries. Refer to
the
<a href="https://www.ironbee.com/docs/devexternal/ironautomata.html">IronAutomata
Documentation</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_loadmodule">LoadModule</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads an external module into configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LoadModule</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This directive will add an external module to the engine, potentially
making new directives available to the configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_location">Location</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a subcontext that can have a differentconfiguration.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;Location path&gt;...&lt;/Location&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>A sub-context created by this directive initially has identical
configuration to that of the site it belongs to. Further directives are
required to introduce changes. Locations are evaluated in the order in
which they appear in the configuration file. The first location that
matches request path will be used. This means that you should put the
most-specific location first, followed by the less specific ones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Include rules.conf

    &lt;Site site1&gt;
        Service *:80
        Service 10.0.1.2:443
        Hostname site1.example.com

        &lt;Location /prefix/app1&gt;
            RuleEnable all
        &lt;/Location&gt;

        &lt;Location /prefix&gt;
            RuleEnable tag:GenericRules
        &lt;/Location&gt;
    &lt;/Site&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_log">Log</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the location of the log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Log &lt;location&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_loglevel">LogLevel</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the detail level of the entries recorded tothe log.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LogLevel &lt;level&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>warning</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The following log levels are supported (either numeric or text):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>` 0 - emergency` - system unusable</p>
</li>
<li>
<p>` 1 - alert` - crisis happened</p>
</li>
<li>
<p>` 2 - critical` - crisis coming</p>
</li>
<li>
<p>` 3 - error` - error occurred</p>
</li>
<li>
<p>` 4 - warning` - error likely to occur</p>
</li>
<li>
<p>` 5 - notice` - something unusual happened</p>
</li>
<li>
<p>` 6 - info` - informational messages</p>
</li>
<li>
<p>` 7 - debug` - debugging: transaction state changes</p>
</li>
<li>
<p>` 8 - debug2` - debugging: log of activities carried out</p>
</li>
<li>
<p>` 9 - debug3` - debugging: activities, with more detail</p>
</li>
<li>
<p><code>10 - trace</code> - debugging: developer log messages</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_lualoadmodule">LuaLoadModule</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load a Lua module (similar to LoadModule).</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LuaLoadModule</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lua</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LuaLoadModule "threat_level.lua"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_luainclude">LuaInclude</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute a Lua script as a configuration file.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LuaInclude</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lua</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LuaInclude "rules.lua"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modulebasepath">ModuleBasePath</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the base path where IronBee modules areloaded.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModuleBasePath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>lib</code> directory under the IronBee install prefix.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_pcrematchlimit">PcreMatchLimit</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the PCRE library match limit.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PcreMatchLimit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pcre</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>From the <code>pcreapi</code> manual: &#8220;The match_limit field provides a means of
preventing PCRE from using up a vast amount of resources when running
patterns that are not going to match, but which have a very large number
of possibilities in their search trees. The classic example is a pattern
that uses nested unlimited repeats.&#8221;</p>
</div>
</div>
<div class="sect2">
<h3 id="_pcrematchlimitrecursion">PcreMatchLimitRecursion</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the PCRE library match limit recursion.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PcreMatchLimitRecursion</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pcre</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>From the <code>pcreapi</code> manual: &#8220;The match_limit_recursion field is similar
to match_limit, but instead of limiting the total number of times that
match() is called, it limits the depth of recursion. The recursion depth
is a smaller number than the total number of calls, because not all
calls to match() are recursive. This limit is of use only if it is set
smaller than match_limit.&#8221;</p>
</div>
</div>
<div class="sect2">
<h3 id="_protectionengineoptions">ProtectionEngineOptions</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures options for the protection engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ProtectionEngineOptions ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The protection engine allows setting options; <code>ProtectionEngineOptions</code>
controls these options. The options are inherited into child contexts
(Site, Location, etc). Specifying an option with +/- operator will add
or remove the given option from the current set. Specifying the first
option without +/- operators will cause all options to be overridden and
the list of options will be the only options set. Here is what your
configuration might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ProtectionEngineOptions none</pre>
</div>
</div>
<div class="paragraph">
<p>The above resets the inspection to <strong>none</strong>.</p>
</div>
<div class="paragraph">
<p>Later, in a sub-context, you may wish to enable blocking and thus can
just specify this with the + operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Location /some/path&gt;
    ProtectionEngineOptions
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If you already had blocking mode enabled, but didn&#8217;t want it any more,
you would write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Location /some/other/path&gt;
    ProtectionEngineOptions
&lt;/Location&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Protection Engine Options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>blockingMode:</strong> Control blocking actions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Protection Engine Option Group Names:</p>
</div>
<div class="paragraph">
<p>These are just aliases for multiple options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none:</strong> Removes all options</p>
</li>
<li>
<p><strong>default:</strong> Default options (currently none)</p>
</li>
<li>
<p><strong>all:</strong> All options</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_requestbuffering">RequestBuffering</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable/disable request buffering.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequestBuffering On|Off</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Off</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Control request buffering - holding the request during inspection.
Currently the HTTP header is always buffered, but this must be enabled
for the request body to be buffered.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This may be renamed to <code>RequestBodyBuffering</code> in a future release.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_requestbodybufferlimit">RequestBodyBufferLimit</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the size of the request body buffer.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequestBodyBufferLimit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9.0</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_requestbodybufferlimitaction">RequestBodyBufferLimitAction</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures what happens when the buffer is smaller thanthe request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequestBodyBufferLimitAction FlushAll|FlushPartial</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FlushPartial</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9.0</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>When <code>FlushAll</code> is configured, the transaction with a body larger than
the buffer will flush the existing buffer, sending it to the backend,
then continue to fill the buffer with the remaining data. With
<code>FlushPartial</code> selected, the buffer will be used to keep as much data as
possible, but any overflowing data will be flushed and sent to the
backend. Request headers will be sent before the first overflow batch.</p>
</div>
</div>
<div class="sect2">
<h3 id="_responsebuffering">ResponseBuffering</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable/disable response buffering.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResponseBuffering On|Off</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Off</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Control response buffering - holding the response during inspection.
Currently the HTTP header is always buffered, but this must be enabled
for the response body to be buffered.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This may be renamed to <code>ResponseBodyBuffering</code> in a future release.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_responsebodybufferlimit">ResponseBodyBufferLimit</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the size of the response body buffer.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResponseBodyBufferLimit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9.0</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_responsebodybufferlimitaction">ResponseBodyBufferLimitAction</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures what happens when the buffer is smaller thanthe response body.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResponseBodyBufferLimitAction FlushAll|FlushPartial</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FlushPartial</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9.0</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>When <code>FlushAll</code> is configured, the transaction with a body larger than
the buffer will flush the existing buffer, sending it to the client,
then continue to fill the buffer with the remaining data. With
<code>FlushPartial</code> selected, the buffer will be used to keep as much data as
possible, but any overflowing data will be flushed and sent to the
client. Request headers will be sent before the first overflow batch.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rule">Rule</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads a rule and, in most contexts, enable the rule forexecution in that context.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Rule TARGET @operator "param" id:1234 rev:1 phase:THE_PHASE ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Loading a rule will, in most contexts, also enable the rule to be
executed in that context. However, the main configuration context is
special. Loading a rule in the main configuration context will <em>NOT</em>
enable the rule, but just load it into memory so that it can be shared
by other contexts. You must explicitly use <code>RuleEnable</code> in another
context to enable the rule.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rulebasepath">RuleBasePath</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the base path where external IronBee rules areloaded.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleBasePath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>lib</code> directory under the IronBee install prefix.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_ruledisable">RuleDisable</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables a rule from executing in the currentconfiguration context.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleDisable "all" | "id:&lt;id&gt;" | "tag:&lt;tag&gt;" ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Rules can be disabled by id or tag. Any number of id or tag modifiers
can be specified per directive. All disables are processed after
enables. See the <code>RuleEnable</code> directive for an example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ruleenable">RuleEnable</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables a rule for execution in the current configurationcontext.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleEnable "all" | "id:&lt;id&gt;" | "tag:&lt;tag&gt;" ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Rules can be disabled by id or tag. Any number of id or tag modifiers
can be specified per directive. All enables are processed before
disables. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Include "rules/big_ruleset.conf"

&lt;Site foo&gt;
    Hostname foo.example.com
    RuleEnable id:1234
    RuleEnable id:3456 tag:SQLi
    RuleDisable id:5678 tag:experimental tag:heavyweight
&lt;/Site&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ruleenginelogdata">RuleEngineLogData</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the data logged by the rule engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleEngineLogData ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The following data type options are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>tx</strong> - Log the transaction:</p>
<div class="listingblock">
<div class="content">
<pre>TX_START clientip:port site-hostname
    ...
TX_END</pre>
</div>
</div>
</li>
<li>
<p><strong>requestLine</strong> - Log the HTTP request line:</p>
<div class="listingblock">
<div class="content">
<pre>REQ_LINE method uri version-if-given</pre>
</div>
</div>
</li>
<li>
<p><strong>requestHeader</strong> - Log the HTTP request header:</p>
<div class="listingblock">
<div class="content">
<pre>REQ_HEADER name: value</pre>
</div>
</div>
</li>
<li>
<p><strong>requestBody</strong> - Log the HTTP request body, possibly in multiple
chunks:</p>
<div class="listingblock">
<div class="content">
<pre>REQ_BODY size data</pre>
</div>
</div>
</li>
<li>
<p><strong>responseLine</strong> - Log the HTTP response line:</p>
<div class="listingblock">
<div class="content">
<pre>RES_LINE version status message</pre>
</div>
</div>
</li>
<li>
<p><strong>responseHeader</strong> - Log the HTTP response header:</p>
<div class="listingblock">
<div class="content">
<pre>RES_HEADER name: value</pre>
</div>
</div>
</li>
<li>
<p><strong>responseBody</strong> - Log the HTTP response body, possibly in multiple
chunks:</p>
<div class="listingblock">
<div class="content">
<pre>RES_BODY size data</pre>
</div>
</div>
</li>
<li>
<p><strong>phase</strong> - Log the phase about to execute:</p>
<div class="listingblock">
<div class="content">
<pre>PHASE name</pre>
</div>
</div>
</li>
<li>
<p><strong>rule</strong> - Log the rule executing:</p>
<div class="listingblock">
<div class="content">
<pre>RULE_START rule-type
    ...
RULE_END</pre>
</div>
</div>
</li>
<li>
<p><strong>target</strong> - Log the target being inspected:</p>
<div class="listingblock">
<div class="content">
<pre>TARGET full-target-name {NOT_FOUND|field-type field-name field-value}</pre>
</div>
</div>
</li>
<li>
<p><strong>transformation</strong> - Log the transformation being executed:</p>
<div class="listingblock">
<div class="content">
<pre>TFN tfn-name(param) {ERROR error}</pre>
</div>
</div>
</li>
<li>
<p><strong>operator</strong> - Log the operator being executed:</p>
<div class="listingblock">
<div class="content">
<pre>OP op-name(param) TRUE|FALSE {ERROR error}</pre>
</div>
</div>
</li>
<li>
<p><strong>action</strong> - Log the action being executed:</p>
<div class="listingblock">
<div class="content">
<pre>ACTION action-name(param) {ERROR error}</pre>
</div>
</div>
</li>
<li>
<p><strong>event</strong> - Log the event being logged:</p>
<div class="listingblock">
<div class="content">
<pre>EVENT rule-id type action [confidence/severity] [csv-tags] msg</pre>
</div>
</div>
</li>
<li>
<p><strong>audit</strong> - Log the audit log filename being written:</p>
<div class="listingblock">
<div class="content">
<pre>AUDIT audit-log-filename</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following alias options are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>request</strong> - Alias for: <strong>requestLine</strong>, <strong>requestHeader</strong>, <strong>requestBody</strong></p>
</li>
<li>
<p><strong>response</strong> - Alias for: <strong>responseLine</strong>, <strong>responseHeader</strong>,
<strong>responseBody</strong></p>
</li>
<li>
<p><strong>ruleExec</strong> - Alias for: <strong>phase</strong>, <strong>rule</strong>, <strong>target</strong>, <strong>transformation</strong>,
<strong>operator</strong>, <strong>action</strong>, <strong>actionableRulesOnly</strong></p>
</li>
<li>
<p><strong>none</strong> - Alias for no data options</p>
</li>
<li>
<p><strong>all</strong> - Alias for all data options</p>
</li>
<li>
<p><strong>default</strong> - Alias for: <strong>none</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following filter options are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>actionableRulesOnly</strong> - Filter option indicating that only rules that
were actionable (actions executed) are logged - any rule specific
logging are delayed/suppressed until at least one action is executed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ruleengineloglevel">RuleEngineLogLevel</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the logging level which the rule engine willwrite logs.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleEngineLogLevel</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>info</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_ruleext">RuleExt</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a rule implemented externally, either by loadingthe rule directly from a file, or referencing a rule that was previously
declared by a module.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleExt</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site, Location</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>To load a Lua rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>RuleExt lua:/path/to/rule.lua phase:REQUEST</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rulemarker">RuleMarker</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a rule marker (placeholder) which will not beexecuted, but instead should be overridden. The idea is that rule sets can include placeholders for optional custom rules which can be overridden, but still allow the rule set writer to maintain execution order.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleMarker id:phase:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>To mark and later replace a rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule ARGS @rx foo id:1 rev:1 phase:REQUEST

# Allow the administrator to set MY_VALUE in another context
RuleMarker id:2 phase:REQUEST

Rule MY_VALUE @gt 0 id:3 rev:1 phase:REQUEST setRequestHeader:X-Foo:%{MY_VALUE}

&lt;Site test&gt;
    Hostname *

    Rule &amp;ARGS @gt 5 id:2 phase:REQUEST setvar:MY_VALUE=5
    RuleEnable all
&lt;/Site&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, rule id:2 in the main context would be replaced by
the rule id:2 in the site context, then the rules would execute id:1,
id:2 and id:3. If Rule id:2 was not replaced in the site context, then
rules would execute id:1 then id:3 as id:2 is only a marker
(placeholder).</p>
</div>
</div>
<div class="sect2">
<h3 id="_sensorid">SensorId</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique sensor identifier.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SensorId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>TODO: Can we make this directive so that, if not defined, we attempt to
detect server hostname and use that as ID?</p>
</div>
</div>
<div class="sect2">
<h3 id="_service">Service</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps IP and Port to a site.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Service &lt;ip&gt;:&lt;port&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*:*</code> (any)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>Service</code> directive establishes a mapping between a Site and one or
IP/Port pairs. To map hostnames to a Site, see the <code>Hostname</code> directive.</p>
</div>
<div class="paragraph">
<p>In the simplest case, a site will occupy a single IP/Port pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Service 192.168.32.5:80</pre>
</div>
</div>
<div class="paragraph">
<p>More often than not, however, several mappings will be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Service 192.168.32.5:80
Service 192.168.32.6:443</pre>
</div>
</div>
<div class="paragraph">
<p>Wildcards are permitted for both IP and Port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Service *:80
Service 192.168.32.5:*</pre>
</div>
</div>
<div class="paragraph">
<p>To match any IP address on any Port (which you will need to do in
default sites), use wildcards for both IP and Port, which is the default
if no <code>Service</code> directive is specified for a site:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Service *:*</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_site">Site</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A site is one of the main concepts in the configurationin IronBee. The idea is to have an element to correspond to real-life web sites. With most web sites there is an one-to-one mapping to domain names, but our mapping mechanism is quite flexible: you can have one site per domain name, many domain names for a single site, or even have one domain name shared among several sites.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;Site name&gt;...&lt;/Site&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>At the highest level, a configuration will contain one or more sites.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Site site1&gt;
    Service *:80
    Hostname site1.example.com
    Hostname site1-alternate.example.com
&lt;/Site&gt;

&lt;Site site2&gt;
    Service *:80
    Service 10.0.1.2:443
    Hostname site2.example.com
&lt;/Site&gt;

&lt;Site default&gt;
    Service *:*
    Hostname *
&lt;/Site&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Before it can process a transaction, IronBee will examine the current
configuration looking for a site to assign the transaction. Sites are
processed in the configured order where the first matching site is
chosen. A default site can be specified as the last site using wildcards
when all previous sites fail to match. The <code>Site</code> directive only
establishes configuration boundaries and assigns a unique handle to each
site; the <code>Service</code> and <code>Hostname</code> directives are responsible for the
mapping.</p>
</div>
</div>
<div class="sect2">
<h3 id="_siteid">SiteId</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique site identifier.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SiteId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>TODO: Can we make this directive so that, if not defined, we attempt to
detect site hostname and use that as ID?</p>
</div>
</div>
<div class="sect2">
<h3 id="_streaminspect">StreamInspect</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a streaming inspection rule, which inspects dataas it becomes available, outside rule phases.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StreamInspect TARGET @op &lt;param&gt; ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site, Location</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Normally, rules run in one of the available phases, which happen at
strategic points in transaction lifecycle. Phase rules are convenient to
write, because all the relevant data is available for inspection.
However, there are situations when it is not possible to have access to
all of the data in a phase. This is the case, for example, when a
request body is very large, or when buffering is not allowed.</p>
</div>
<div class="paragraph">
<p>Streaming rules are designed to operate in these circumstances. They are
able to inspect data as it becomes available, be it a dozen of bytes, or
a single byte.</p>
</div>
<div class="paragraph">
<p>The syntax of the <code>Inspect</code> directive is similar to that of <code>Rule</code>, but
there are several restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only one input can be used. This is because streaming rules attach to
a single data source.</p>
</li>
<li>
<p>The <code>phase</code> modifier cannot be used, as streaming rules operate
outside of phases.</p>
</li>
<li>
<p>Only <code>REQUEST_BODY_STREAM</code> and <code>RESPONSE_BODY_STREAM</code> can be used as
inputs.</p>
</li>
<li>
<p>Only the <code>pm</code>, and <code>dfa</code> operators can be used.</p>
</li>
<li>
<p>Transformation functions are not yet supported.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trustedproxyusexffheader">TrustedProxyUseXFFHeader</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the use of X-Forwarded-For header.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TrustedProxyUseXFFHeader On|Off</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>On</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>If enabled the last address listed in the X-Forwarded-For header as the
remote address. See <em>TrustedProxyIPs</em> to configure the list of trusted
proxies. The default behaviour is to trust no proxies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_trustedproxyips">TrustedProxyIPs</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a list of networks or IP address to trust forX-Forwarded-For handlingEnable the use of X-Forwarded-For header.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TrustedProxyIPs &lt;cidr&gt; ...</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This is a list of IP addresses or CIDR blocks that should be trusted or
not trusted when handling the X-Forwarded-For header.</p>
</div>
<div class="paragraph">
<p>Networks/IPs may be prefixed with "<code>" indicate it is trusted or "-"
indicate in are untrusted. If the first entry in the list does not have
a "</code>" or "-" the trusted/untrusted list is cleared and the entry is
treated as trusted.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="paragraph">
<p>Trust only 192.168.1.0/24:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TrustedProxyIPs 192.168.1.0/24</pre>
</div>
</div>
<div class="paragraph">
<p>Trust all but 10.10.10.10:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TrustedProxyIPs -10.10.10.10</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_txdump">TxDump</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diagnostics directive to dump (log) transaction data fordebugging purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TxDump</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">devel</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The event field allows indicating <em>when</em> you want the data to be written
and is one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TxStarted</code> - Transaction started.</p>
</li>
<li>
<p><code>TxProcess</code> - Transaction processing (between request and response).</p>
</li>
<li>
<p><code>TxContext</code> - Transaction configuration context chosen.</p>
</li>
<li>
<p><code>RequestStart</code> - Request started.</p>
</li>
<li>
<p><code>RequestHeader</code> - Request headers have been processed.</p>
</li>
<li>
<p><code>Request</code> - Full request has been processed.</p>
</li>
<li>
<p><code>ResponseStart</code> - Response started.</p>
</li>
<li>
<p><code>ResponseHeader</code> - Response headers have been processed.</p>
</li>
<li>
<p><code>Response</code> - Full response has been processed.</p>
</li>
<li>
<p><code>TxFinished</code> - Transaction is finished.</p>
</li>
<li>
<p><code>Logging</code> - Logging phase.</p>
</li>
<li>
<p><code>PostProcess</code> - Post-processing phase.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The destination field allows specifying <em>where</em> you want to write the
data and is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>stderr</code> - Write to standard error.</p>
</li>
<li>
<p><code>stdout</code> - Write to standard output.</p>
</li>
<li>
<p><code>ib</code> - Write to the IronBee log file.</p>
</li>
<li>
<p><code>file://</code> - Write to an arbitrary file, optionally appending to the
file if the last character is a <code>+</code> character.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data field is optional and allows specifying <em>what</em> is to be
written. This can be prefixed with a <code>+</code> or a <code>-</code> character to enable or
disable the data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Basic</code> - Basic TX data.</p>
</li>
<li>
<p><code>Context</code> - Configuration context data.</p>
</li>
<li>
<p><code>Connection</code> - Connection data.</p>
</li>
<li>
<p><code>ReqLine</code> - HTTP request line.</p>
</li>
<li>
<p><code>ReqHdr</code> - HTTP request header.</p>
</li>
<li>
<p><code>RspLine</code> - HTTP response line.</p>
</li>
<li>
<p><code>RspHdr</code> - HTTP response header.</p>
</li>
<li>
<p><code>Flags</code> - Transaction flags.</p>
</li>
<li>
<p><code>Args</code> - Request arguments.</p>
</li>
<li>
<p><code>Data</code> - Transaction data.</p>
</li>
<li>
<p><code>Default</code> - Default is "Basic ReqLine RspLine".</p>
</li>
<li>
<p><code>Headers</code> - All HTTP headers.</p>
</li>
<li>
<p><code>All</code> - All data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TxDump TxContext ib Basic +Context
TxDump PostProcess file:///tmp/tx.txt All
TxDump Logging file:///var/log/ib/all.txt+ All
TxDump PostProcess StdOut All</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_xrulegeo">XRuleGeo</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an extended geo rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRuleGeo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xrules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XRules, or extended rules, are rules that implement common operations,
such as Access Control Lists (ACLs). These extended rules hide much of
the complexities of normal rules so that these common operations are
easier to use. The priority allows conflicts to be resolved - higher
priority (lower numerical value) rules will override lower priority
rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An XRuleGeo is used to setup Geo (country) based rules.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XRuleGeo US scaleThreat=0.8 priority=1</pre>
</div>
</div>
<div class="paragraph">
<p>For available actions, see <code>XRuleIpv4</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_xruleipv4">XRuleIpv4</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an extended IPv4 rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRuleIpv4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xrules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XRules, or extended rules, are rules that implement common operations,
such as Access Control Lists (ACLs). These extended rules hide much of
the complexities of normal rules so that these common operations are
easier to use. The priority allows conflicts to be resolved - higher
priority (lower numerical value) rules will override lower priority
rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An XRuleIpv4 is used to setup IPv4 based rules.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XRuleIpv4 192.168.0.0/16 block priority=1</pre>
</div>
</div>
<div class="paragraph">
<p>Available Actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>priority=N</strong> - Set rule priority.</p>
</li>
<li>
<p><strong>block</strong> - Block the transaction.</p>
</li>
<li>
<p><strong>allow</strong> - Allow the transaction.</p>
</li>
<li>
<p><strong>enableBlockingMode</strong> - Enable blocking mode for this transaction.</p>
</li>
<li>
<p><strong>disableBlockingMode</strong> - Disable blocking mode for this transaction</p>
</li>
<li>
<p><strong>scaleThreat=X</strong> - Scale threat calculation (update
<strong>XRULES:SCALE_THREAT</strong>) by floating point multiplier, X, for this
transaction.</p>
</li>
<li>
<p><strong>enableRequestHeaderInspection</strong> - Enable request header inspection for
this transaction.</p>
</li>
<li>
<p><strong>disableRequestHeaderInspection</strong> - Disable request header inspection
for this transaction.</p>
</li>
<li>
<p><strong>enableRequestURIInspection</strong> - Enable request URI inspection for this
transaction.</p>
</li>
<li>
<p><strong>disableRequestURIInspection</strong> - Disable request URI inspection for
this transaction.</p>
</li>
<li>
<p><strong>enableRequestParamInspection</strong> - Enable request parameter inspection
for this transaction.</p>
</li>
<li>
<p><strong>disableRequestParamInspection</strong> - Disable request parameter inspection
for this transaction.</p>
</li>
<li>
<p><strong>enableRequestBodyInspection</strong> - Enable request body inspection for
this transaction.</p>
</li>
<li>
<p><strong>disableRequestBodyInspection</strong> - Disable request body inspection for
this transaction.</p>
</li>
<li>
<p><strong>enableResponseHeaderInspection</strong> - Enable response header inspection
for this transaction.</p>
</li>
<li>
<p><strong>disableResponseHeaderInspection</strong> - Disable response header inspection
for this transaction.</p>
</li>
<li>
<p><strong>enableResponseBodyInspection</strong> - Enable response body inspection for
this transaction.</p>
</li>
<li>
<p><strong>disableResponseBodyInspection</strong> - Disable response body inspection for
this transaction.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_xruleipv6">XRuleIpv6</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an extended IPv6 rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRuleIpv6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xrules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XRules, or extended rules, are rules that implement common operations,
such as Access Control Lists (ACLs). These extended rules hide much of
the complexities of normal rules so that these common operations are
easier to use. The priority allows conflicts to be resolved - higher
priority (lower numerical value) rules will override lower priority
rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An XRuleIpv6 is used to setup IPv6 based rules.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XRuleIpv6 ::1/128 block priority=1</pre>
</div>
</div>
<div class="paragraph">
<p>For available actions, see <code>XRuleIpv4</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_xrulepath">XRulePath</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an extended path rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRulePath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xrules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XRules, or extended rules, are rules that implement common operations,
such as Access Control Lists (ACLs). These extended rules hide much of
the complexities of normal rules so that these common operations are
easier to use. The priority allows conflicts to be resolved - higher
priority (lower numerical value) rules will override lower priority
rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An XRulePath is used to setup URI path based rules.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XRulePath /admin scaleThreat=1.5 enableBlockingMode priority=1</pre>
</div>
</div>
<div class="paragraph">
<p>For available actions, see <code>XRuleIpv4</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_xrulerequestcontenttype">XRuleRequestContentType</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an extended request content type rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRuleRequestContentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xrules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XRules, or extended rules, are rules that implement common operations,
such as Access Control Lists (ACLs). These extended rules hide much of
the complexities of normal rules so that these common operations are
easier to use. The priority allows conflicts to be resolved - higher
priority (lower numerical value) rules will override lower priority
rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An XRuleRequestContentType is used to setup request contetnt type based
rules.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XRuleRequestContentType application/x-www-form-urlencoded enableRequestBodyInspection</pre>
</div>
</div>
<div class="paragraph">
<p>For available actions, see <code>XRuleIpv4</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_xruleresponsecontenttype">XRuleResponseContentType</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an extended IPv6 rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRuleResponseContentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xrules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XRules, or extended rules, are rules that implement common operations,
such as Access Control Lists (ACLs). These extended rules hide much of
the complexities of normal rules so that these common operations are
easier to use. The priority allows conflicts to be resolved - higher
priority (lower numerical value) rules will override lower priority
rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An XRuleResponseContentType is used to setup response content type based
rules.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XRuleResponseContentType image/png disableResponseBodyInspection</pre>
</div>
</div>
<div class="paragraph">
<p>For available actions, see <code>XRuleIpv4</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_xruletime">XRuleTime</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an extended time rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XRuleTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xrules</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XRules, or extended rules, are rules that implement common operations,
such as Access Control Lists (ACLs). These extended rules hide much of
the complexities of normal rules so that these common operations are
easier to use. The priority allows conflicts to be resolved - higher
priority (lower numerical value) rules will override lower priority
rules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An XRuleTime is used to setup date/time based rules.</p>
</div>
<div class="paragraph">
<p>The time-spec is in the format: <code>[!]DOW(,DOW)*@HH:MM-HH:MM[-|+]ZZZZ</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>!</strong> - Invert rule.</p>
</li>
<li>
<p><strong>DOW</strong> - Day of Week (0=Sunday - 6=Saturday).</p>
</li>
<li>
<p><strong>HH</strong> - Two digit hour (24-hr format).</p>
</li>
<li>
<p><strong>MM</strong> - Two digit minute.</p>
</li>
<li>
<p><strong>[-|+]ZZZZ</strong> - Timezone offset from GMT</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XRuleTime !1,2,3,4,5@08:00-17:00-0500 scaleThreat=1.5 enableBlockingMode</pre>
</div>
</div>
<div class="paragraph">
<p>For available actions, see <code>XRuleIpv4</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ironbee_diagnostics_and_developer_tools">IronBee Diagnostics and Developer Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IronBee comes with a number of tools for diagnostics and development of
both modules and rules.</p>
</div>
<div class="sect2">
<h3 id="_rule_engine_logging_and_diagnostics">Rule Engine Logging and Diagnostics</h3>
<div class="paragraph">
<p>IronBee has a separate logging facility for rule engine which is meant
to make rule diagnostics easier. Rule engine logging is controlled
through two directives. There is also a variable that can be set to
enable internal tracing of the rule execution engine, which is generally
only useful for developers.</p>
</div>
<div class="paragraph">
<p>Typically rule execution logging is enabled as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>### Rule Engine Logging
# Control what data is logged
RuleEngineLogData default
# Control at which log level data is logged
RuleEngineLogLevel info</pre>
</div>
</div>
<div class="paragraph">
<p>Full logging, which will generate a lot of data, can be enabled by
setting <code>RuleEngineLogData</code> to <code>all</code>, however there is quite a bit of
control over what is logged. See the <code>RuleEngineLogData</code> in the ?
documentation for details. An example of full rule engine logging is
below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>### Rule Engine Logging
RuleEngineLogData all
RuleEngineLogLevel info

### Match "dirty" or "attack" in the request
Rule REQUEST_URI REQUET_HEADERS ARGS @rx "dirty|attack" \
    id:test/1 phase:REQUEST \
    severity:60 confidence:50 \
    "msg:Matched %{CAPTURE:0}" \
    capture \
    event block

### Perform an actual block action at the end of the phase
### if marked to block
Rule FLAGS:block.count() @gt 0 \
    id:block/1 phase:REQUEST \
    "msg:Blocking request" \
    status:403 \
    block:phase</pre>
</div>
</div>
<div class="paragraph">
<p>The above will produce rule engine logging similar to below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[] PHASE REQUEST_HEADER_STREAM
[] TX_START 1.2.3.4:52980 waf-test.example.com
[] REQ_LINE GET /?a=1&amp;b=dirty&amp;c=attack&amp;d=4 HTTP/1.1
[] REQ_HEADER Host: waf-test.example.com
[] REQ_HEADER User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:18.0) Gecko/20100101 Firefox/18.0
[] REQ_HEADER Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
[] REQ_HEADER Accept-Language: en-US,en;q=0.5
[] REQ_HEADER Connection: keep-alive
[] PHASE REQUEST_HEADER
[] PHASE REQUEST
[rule:"site/.../test/1" rev:1] RULE_START PHASE
[rule:"site/.../test/1" rev:1] TARGET "REQUEST_URI" BYTESTR "request_uri" "\/?a=1&amp;b=dirty&amp;c=attack&amp;d=4"[rule:"site/.../test/1" rev:1] OP rx("dirty|attack") TRUE
[rule:"site/.../test/1" rev:1] ACTION event("")
[rule:"site/.../test/1" rev:1] ACTION block("")
[rule:"site/.../test/1" rev:1] EVENT site/.../test/1 Observation Block [50/60] [] "Matched dirty"
[rule:"site/.../test/1" rev:1] TARGET REQUET_HEADERS NOT_FOUND[rule:"site/.../test/1" rev:1] TARGET "ARGS" BYTESTR "ARGS:a" "1"
[rule:"site/.../test/1" rev:1] OP rx("dirty|attack") FALSE
[rule:"site/.../test/1" rev:1] TARGET "ARGS" BYTESTR "ARGS:b" "dirty"
[rule:"site/.../test/1" rev:1] OP rx("dirty|attack") TRUE
[rule:"site/.../test/1" rev:1] ACTION event("")
[rule:"site/.../test/1" rev:1] ACTION block("")
[rule:"site/.../test/1" rev:1] EVENT site/.../test/1 Observation Block [50/60] [] "Matched dirty"
[rule:"site/.../test/1" rev:1] TARGET "ARGS" BYTESTR "ARGS:c" "attack"
[rule:"site/.../test/1" rev:1] OP rx("dirty|attack") TRUE[rule:"site/.../test/1" rev:1] ACTION event("")
[rule:"site/.../test/1" rev:1] ACTION block("")
[rule:"site/.../test/1" rev:1] EVENT site/.../test/1 Observation Block [50/60] [] "Matched attack"
[rule:"site/.../test/1" rev:1] TARGET "ARGS" BYTESTR "ARGS:d" "4"
[rule:"site/.../test/1" rev:1] OP rx("dirty|attack") FALSE
[rule:"site/.../test/1" rev:1] RULE_END[rule:"site/.../block/1" rev:1] RULE_START PHASE
[rule:"site/.../block/1" rev:1] TFN count() LIST "FLAGS" 1
[rule:"site/.../block/1" rev:1] TARGET "FLAGS:block.count()" NUM "FLAGS:FLAGS" 1
[rule:"site/.../block/1" rev:1] OP gt(0) TRUE
[rule:"site/.../block/1" rev:1] ACTION status(403)
[rule:"site/.../block/1" rev:1] ACTION block("phase")
[rule:"site/.../block/1" rev:1] RULE_END
[] PHASE RESPONSE_HEADER_STREAM
[] RES_LINE HTTP/1.1 403 Forbidden
[] RES_HEADER Date: Fri, 22 Mar 2013 15:36:27 GMT
[] RES_HEADER Connection: close
[] RES_HEADER Server: ATS/3.2.2
[] PHASE RESPONSE_HEADER
[] PHASE RESPONSE_BODY_STREAM
[] PHASE POST_PROCESS
[] PHASE LOGGING
[] AUDIT /var/log/ironbee/events/118d9ea6-933d-400e-b980-cdad773dceee_9e8d34a4-1431-4a90-a79a-de9fe88fb111.log
[] TX_END</pre>
</div>
</div>
<div class="paragraph">
<p>For a production system, something like this may be suitable, which will
only log events that are generated and audit log files that are written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>### Log only events and audit log information
RuleEngineLogData event audit
RuleEngineLogLevel notice</pre>
</div>
</div>
<div class="paragraph">
<p>If you need further tracing through rule execution, then you can set the
rule engine debug log level. This will potentially log a lot of data,
but will allow for debugging issues that may not be exposed by the
normal rule engine logging facility. The following will enable full
trace mode in the rule engine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Set RuleEngineDebugLogLevel trace</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_tool_clipp">Command Line Tool (clipp)</h3>
<div class="paragraph">
<p>IronBee includes a full featured command line tool named <code>clipp</code>
(pronounced clippy) that can be used to run transactions through IronBee
from various data sources such as its own native protobuf format, raw
HTTP files, pcap network captures, audit logs and others. Clipp can also
translate between the various formats. The interface to clipp was
inspired by the brilliant socat utility
(<a href="http://www.dest-unreach.org/socat/">http://www.dest-unreach.org/socat/</a>). Clipp is best explained through
examples, but in general, clipp take one or more inputs, optional
modifiers and a single consumer. The input data passes through modifiers
into the consumer.</p>
</div>
<div class="paragraph">
<p>The following will take <code>raw</code> HTTP input files (<code>request.http</code> and
<code>response.http</code>), instantiate an <code>ironbee</code> consumer with the specified
configuration (<code>ironbee.conf</code>) and then push the data through the
IronBee engine in the same way IronBee embedded in a webserver or proxy.
Using clipp, you can test IronBee configuration files prior to moving
them to a webserver or proxy. With clipp, if you specified a LogFile in
the configuration, then the logs will go there, otherwise it will go to
stderr.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ clipp raw:request.http,response.http ironbee:ironbee.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Multiple transactions are also supported, including in multiple formats:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ clipp \
raw:request1.http,response1.http \
raw:request2.http,response2.http \
ironbee:ironbee.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Modifiers are also supported, such as changing the IP/port used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ clipp \
raw:request1.http,response1.http \
@set_local_ip:1.2.3.4 \
@set_local_port:8080 \
raw:request2.http,response2.http \
@set_local_ip:5.6.7.8 \
@set_local_port:80 \
ironbee:ironbee.conf</pre>
</div>
</div>
<div class="paragraph">
<p>With many parameters, the command line can get tedious, so clipp also
supports a configuration file format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>### clipp.conf

# Transaction 1
raw:request1.http,response1.http
  @set_local_ip:1.2.3.4
  @set_local_port:8080

# Transaction 2
raw:request2.http,response2.http
  @set_local_ip:5.6.7.8
  @set_local_port:80

# IronBee Consumer
ironbee:ironbee.conf</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ clipp -c clipp.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Clipp&#8217;s native protobuf format can encapsulate all input, including
modifiers, into a single compact format. This format is produced by
using the writepb consumer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ clipp \
raw:request1.http,response1.http \
raw:request2.http,response2.http \
writepb:input.pb</pre>
</div>
</div>
<div class="paragraph">
<p>Full documentation on clipp is in Markdown format in the source tree:
<a href="https://github.com/ironbee/ironbee/blob/master/clipp/clipp.md">https://github.com/ironbee/ironbee/blob/master/clipp/clipp.md</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_developer_module">Developer Module</h3>
<div class="paragraph">
<p>IronBee includes a developer module that contains some diagnostic
features. One that can aide in diagnosing inspection issues is the
<code>TxDump</code> directive. This directive allows for dumping some internal
IronBee state to a log file. To use <code>TxDump</code>, you need to load the
<code>devel</code> module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LoadModule "ibmod_devel.so"</pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done, you can use the <code>TxDump</code> directive to log data to a
file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TxDump TxFinished file:///tmp/ironbee_diag.log All</pre>
</div>
</div>
<div class="paragraph">
<p>And you will get something like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[TX 6bcb584c-7f84-461a-93b4-d576e7fd72a7 @ tx_finished_event]
  Started = 2013-04-25T17:34:00.2508-0700
  Hostname = waf-test.example.com
  Effective IP = 5.6.7.8
  Path = /
  Context
    Name = any:location:/
    Site name = any
    Site ID = 0CA1665C-F27F-4763-A3E0-A31A00477497
    Location path = /
  Connection
    Created = 2013-04-25T17:34:00.2508-0700
    Remote = 5.6.7.8:80
    Local = 1.2.3.4:1234
    Context
      Name = main:site:any
      Site name = any
      Site ID = 0CA1665C-F27F-4763-A3E0-A31A00477497
  Request line:
    Raw = "GET /path/test?foo=bar HTTP/1.1"
    Method = "GET"
    URI = "/path/test?foo=bar"
    Protocol = "HTTP/1.1"
  Request Header
    Host = "waf-test.example.com"
    User-Agent = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:18.0) Gecko/..."
    Accept = "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
    Accept-Language = "en-US,en;q=0.5"
    Connection = "keep-alive"
  Response line:
    Raw = "HTTP/1.1 301 Moved Permanently"
    Protocol = "HTTP/1.1"
    Status = "301"
    Message = "Moved Permanently"
  Response Header
    Location = "http://www.example.com/"
    Content-Type = "text/html; charset=UTF-8"
    Date = "Wed, 26 Oct 2012 02:36:41 GMT"
    Expires = "Fri, 25 Nov 2012 02:36:41 GMT"
    Cache-Control = "public, max-age=2592000"
    Server = "Apache"
    Content-Length = "219"
    X-XSS-Protection = "1; mode=block"
    X-Frame-Options = "SAMEORIGIN"
  Flags = 0380beb8
    00000001 "Error" = Off
    00000002 "HTTP/0.9" = Off
    00000004 "Pipelined" = Off
    00000008 "Request Started" = On
    00000020 "Seen Request Header" = On
    00000040 "No Request Body" = Off
    00000080 "Seen Request Body" = On
    00000100 "Seen Request Trailer" = Off
    00000200 "Request Finished" = On
    00000400 "Response Started" = On
    00001000 "Seen Response Header" = On
    00002000 "Seen Response Body" = On
    00004000 "Seen Response Trailer" = Off
    00008000 "Response Finished" = On
    00010000 "Suspicious" = Off
    00020000 "Block: Advisory" = Off
    00040000 "Block: Phase" = Off
    00080000 "Block: Immediate" = Off
    00100000 "Allow: Phase" = Off
    00200000 "Allow: Request" = Off
    00400000 "Allow: All" = Off
    00800000 "Post-Process" = On
    02000000 "Inspect Request Header" = On
    04000000 "Inspect Request Body" = Off
    08000000 "Inspect Response Header" = Off
    10000000 "Inspect Response Body" = Off
  ARGS:
    ARGS = [1]
    ARGS:foo = "bar"
  Data:
    response_line = "HTTP/1.1 301 Moved Permanently"
    request_uri = "/path/test?foo=bar"
    request_protocol = "HTTP/1.1"
    request_uri_params = [1]
      request_uri_params:foo = "bar"
    FIELD_NAME = ""
    request_content_type = ""
    request_uri_path = "/path/test"
    remote_addr = "5.6.7.8"
    request_host = ""
    request_filename = ""
    response_headers = [9]
      response_headers:Location = "http://www.example.com/"
      response_headers:Content-Type = "text/html; charset=UTF-8"
      response_headers:Date = "Wed, 26 Oct 2012 02:36:41 GMT"
      response_headers:Expires = "Fri, 25 Nov 2012 02:36:41 GMT"
      response_headers:Cache-Control = "public, max-age=2592000"
      response_headers:Server = "Apache"
      response_headers:Content-Length = "219"
      response_headers:X-XSS-Protection = "1; mode=block"
      response_headers:X-Frame-Options = "SAMEORIGIN"
    request_uri_password = ""
    request_uri_scheme = ""
    request_uri_query = "foo=bar"
    remote_port = 80
    request_line = "GET /path/test?foo=bar HTTP/1.1"
    server_addr = "1.2.3.4"
    response_status = "301"
    response_message = "Moved Permanently"
    CAPTURE = [0]
    FIELD_NAME_FULL = ""
    request_uri_username = ""
    request_body_params = [0]
    server_port = 1234
    response_cookies = [0]
    request_uri_port = ""
    response_protocol = "HTTP/1.1"
    conn_tx_count = 1
    request_uri_raw = "/path/test?foo=bar"
    CA = [0]
    auth_password = ""
    request_headers = [5]
      request_headers:Host = "waf-test.example.com"
      request_headers:User-Agent = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:18.0) Gecko/20100101 Firefox/18.0"
      request_headers:Accept = "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
      request_headers:Accept-Language = "en-US,en;q=0.5"
      request_headers:Connection = "keep-alive"
    request_method = "GET"
    response_content_type = ""
    request_uri_fragment = ""
    request_uri_path_raw = "/path/test"
    ARGS = [1]
      ARGS:foo = "bar"
    FLAGS = [5]
      FLAGS:suspicious = 0
      FLAGS:inspectRequestHeader = 1
      FLAGS:inspectRequestBody = 0
      FLAGS:inspectResponseHeader = 0
      FLAGS:inspectResponseBody = 0
    auth_username = ""
    auth_type = ""
    request_uri_host = ""
    request_cookies = [0]</pre>
</div>
</div>
<div class="paragraph">
<p>What data you log can be tailored. See the documentation for the
<code>TxDump</code> directive for the full syntax.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inspection">Inspection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The point of IronBee is to allow for inspecting data. This chapter
covers the basics of doing just that. Inspecting data is performed
through rules and modules. Rules are encapsulated logic executed at well
define points in the transaction lifecycle. Modules, in general, extend
IronBee functionality and can provide extensive logic, however modules
can also be used for inspection when you need more control and
flexibility.</p>
</div>
<div class="sect2">
<h3 id="_data">Data</h3>
<div class="paragraph">
<p>IronBee exposes data in two forms. Data can be in defined as a field or
as a stream. In addition to inspection, fields are the primary means of
exposing and exchanging data between rules and modules. A full list of
the defined data fields are discussed in ?, however IronBee allows for
the creation and modification of arbitrary fields. New variable fields
can be defined, initialized in various ways within the IronBee
configuration as well as in rules and modules. This section discusses
defining and initializing rules via the configuration, leaving further
discussion for the Rules section.</p>
</div>
<div class="paragraph">
<p>Variable fields, or just variables for short, are defined and
initialized in the the configuration through two primary directives. The
scope of these variables is defined through the context. Variables can
be defined in the main (global) scope, within a site scope or within a
location scope based on where the directives are used in the
configuration.</p>
</div>
<div class="sect3">
<h4 id="_defining_and_initializing_scalar_variables_with_code_initvar_code">Defining and Initializing Scalar Variables with <code>InitVar</code></h4>
<div class="paragraph">
<p>A simple scalar variable is both defined and initialized with the
<code>InitVar</code> directive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitVar MY_VAR "my value"</pre>
</div>
</div>
<div class="paragraph">
<p>In addition to simple scalar variables, you can also use <code>InitVar</code> to
define scalar variables within a collection. If the collection does not
previously exist, then it is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitVar MY_COLLECTION:MY_VAR "my value"</pre>
</div>
</div>
<div class="paragraph">
<p>The variable will then be available as a normal field to all rules and
modules active in the same configuration context (scope). See the full
documentation for the <code>InitVar</code> directive for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_defining_and_initializing_collections_with_code_initcollection_code">Defining and Initializing Collections with <code>InitCollection</code></h4>
<div class="paragraph">
<p>Similar to the <code>InitVar</code> directive, you can also define and initialize
collections with the <code>InitCollection</code> directive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection MY_COLLECTION</pre>
</div>
</div>
<div class="paragraph">
<p>The above will define the <code>MY_COLLECTION</code> collection, however, it will
be empty. To both define and initialize a collection, you can utilize a
number of additional <code>InitCollection</code> features. The most basic form
allows specifying key/value pairs with the collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection MY_COLLECTION vars: \
    key1=value1 \
    key2=value2 \
    key3=value3</pre>
</div>
</div>
<div class="paragraph">
<p>In addition to initializing the key values within the configuration
file, you may also initialize the collection via an external JSON
formatted file, allowing for controlling the data withing the collection
outside of IronBee.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection MY_COLLECTION json-file:///path/to/persisted/data/mycollection.json</pre>
</div>
</div>
<div class="paragraph">
<p>The JSON is formatted as simple name/value pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "key1": "value1",
    "key2": "value2",
    "key3": "value3"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_persisting_data_with_code_initcollection_code">Persisting Data with <code>InitCollection</code></h4>
<div class="paragraph">
<p>In addition to defining and initializing collections with static data,
IronBee also allows for persisting collections which have been
manipulated in IronBee. This is accomplished in a few different ways,
depending on your needs. If you need to persist a single instance of a
collection, then you can just add the persist option to the
InitCollection directive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection MY_COLLECTION json-file:///path/to/persisted/data/mycollection.json persist</pre>
</div>
</div>
<div class="paragraph">
<p>With the addition of the persist option, any data within the collection
will be written out to the JSON file at the end of the transaction. The
next transaction will then be initialized with the manipulated data.
Often, though, you do not want to share the same collection for all
transactions. Instead you need to be able to save different instances of
the collection based on some other field or set of fields as a key. To
do this, you need to load the persist module to gain some additional
functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LoadModule ibmod_persist.so</pre>
</div>
</div>
<div class="paragraph">
<p>The persist module allows you to store different instances of a
collection based on a key. For example, you may want to store an
instance of the collection based on the IP address or session ID. This
is not any more difficult, just a slightly different syntax. The key can
be specified using any string, which may include field expansion, such
as the IP address or session ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection IP_DATA persist-fs:///path/to/persisted/data key=%{REMOTE_ADDR}
InitCollection SESS_DATA persist-fs:///path/to/persisted/data key=%{REQUEST_COOKIES:jsessionid}</pre>
</div>
</div>
<div class="paragraph">
<p>Any data contained in these collections will be read from a file based
on the key and stored in the named collection. At the end of the
transaction, the data is written out to the same file. Since this data
may accumulated, you will probably want to specify an expiration time.
This is done by using the expire option, which takes an expiration time
in seconds. If more than the number of seconds elapses between the
collection being written out and read back in, the data is purged and
the collection will be empty.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>InitCollection IP_DATA persist-fs:///path/to/persisted/data key=%{REMOTE_ADDR} expire=300</pre>
</div>
</div>
<div class="paragraph">
<p>Since the data is only purged when it is attempted to be read back in
after expiring, the data may still accumulate on the filesystem. It may
be required to run a periodic cleanup process to purge any expired
files. In the future IronBee will provide a utility for this, but for
now the expiration date is encoded in the filename.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Format: uuid/expiration-tempname
0de114da-8ada-55ad-a6de-e68a1263412a/001364624257-0004d91e578bc99f.json.dXFR9d</pre>
</div>
</div>
<div class="paragraph">
<p>Periodic purging could be accomplished with a cron job to check that the
current epoch based date is greater than that encoded in the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh

# Specify the persist-fs: base directory
PERSIST_FS_BASEDIR="/tmp/ironbee/persist/fs"

# Current epoch based date
DSTAMP=`date "+%s"`

# Iterate through files
for file in `find $PERSIST_FS_BASEDIR -type f -name '*.json.*'`; do
    # Extract the epoch based expiration from the filename
    expires=`echo $file | sed 's%.*/0*\([0-9]*\)-.*%\1%'`

    # Check if the expires was extracted and the current date
    # is greater than the expiration, removing the file.
    if [ -n "$expires" -a "$DSTAMP" -gt "$expires" ]; then
        echo "PURGE: $file expired=`date -j -r $expires`"
        rm $file
    fi
done</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inspection_rules">Inspection Rules</h3>
<div class="paragraph">
<p>Rules are the primary form of inspection in IronBee. IronBee rule
execution is decoupled from any rule language. Because of this, IronBee
can provide multiple rule languages. Each language has a different use
case. Currently the following rule languages are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IronBee Rule Language, which is part of the IronBee Configuration
Language.</p>
</li>
<li>
<p>Lua rule definitions, available in Lua modules and Lua configuration
files.</p>
</li>
<li>
<p>Extended Rules (XRules), which is part of the IronBee Configuration
Language and implements common logic such as Access Control Lists
(ACLs).</p>
</li>
<li>
<p>External Lua rule scripts.</p>
</li>
<li>
<p>Alternative rule execution via rule injection modules.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ironbee_rule_language">IronBee Rule Language</h4>
<div class="paragraph">
<p>The IronBee rule language is relatively simplistic. The language is
designed to create signature based rules with minimal logic. If you need
more logic, then you should consider other options.</p>
</div>
<div class="paragraph">
<p>The rule language allows for inspecting fields and performing actions.
There are three forms of rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Field based inspection rules which execute actions based on inspecting
a set of fields.</p>
</li>
<li>
<p>Stream based inspection rules which execute actions based on
inspecting a stream of data.</p>
</li>
<li>
<p>Actions based rules, which just execute actions and allow for some
basic logic and setup.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_inspecting_fields_with_the_code_rule_code">Inspecting Fields with the <code>Rule</code></h5>
<div class="paragraph">
<p>The Rule directive allows inspecting a set of fields and optionally
executing an action. For example, you can specify a list of request
methods that you wish to block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule REQUEST_METHOD @imatch "TRACE TRACK" \
    id:test/methods/1 \
    phase:REQUEST_HEADER \
    "msg:Invalid method: %{REQUEST_METHOD}" \
    event:alert \
    block:phase</pre>
</div>
</div>
<div class="paragraph">
<p>The example above inspects the <code>REQUEST_METHOD</code> field using the
<code>@imatch</code> operator. The <code>@imatch</code> operator matches case insensitively
against a list of values. In this case the match is a success if the
<code>REQUEST_METHOD</code> completely matches any of the specified methods. If the
match is a success, then the event and block actions will be executed,
logging an alert with the given message and blocking the request at the
end of the phase. There are a few additional modifiers. The id and phase
modifiers are required. The id modifier must be a unique string and the
phase modifier specifies when the rule will execute. In this case the
rule will execute just after the HTTP request headers are available.</p>
</div>
<div class="paragraph">
<p>As an alternate to the above, you could instead whitelist what methods
you wish to allow with a similar rule. In this case you would just
negate the operator and specify a list of methods that are allowed. If
the method is not on the list, then the actions will execute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule REQUEST_METHOD  \
    id:test/methods/1 \
    phase:REQUEST_HEADER \
    "msg:Invalid method: %{REQUEST_METHOD}" \
    event:alert \
    block:phase</pre>
</div>
</div>
<div class="paragraph">
<p>More than one field can be specified. If so, then each value will be run
through the operator, triggering actions for each match. In addition,
the field values can be transformed, such as trimming off any
whitespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule REQUEST_METHOD !@imatch "GET HEAD POST" \
    id:test/methods/1 \
    phase:REQUEST_HEADER \
    "msg:Invalid method: %{REQUEST_METHOD}" \
    event:alert \
    block:phase</pre>
</div>
</div>
<div class="paragraph">
<p>Transformations can be specified per-field, or to all fields, using, for
example, the <code>t:trim</code> rule modifier. Multiple transformations can be
chained together.</p>
</div>
<div class="paragraph">
<p>See the <code>Rule</code> directive documentation for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_inspecting_streams_with_code_streaminspect_code">Inspecting Streams with <code>StreamInspect</code></h5>
<div class="paragraph">
<p>Potentially large fields, such as the request and response body, pose
problems when they need to be inspected as a whole. To alleviate
problems with requiring large amounts of memory for inspection, the
request and response bodies are only available as streams. The
<code>StreamInspect</code> directive is used to write stream based data. This
directive differs slightly from the Rule directive.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>StreamInspect</code> rules run as data is received, which is before phase
rules execute on the request/response bodies. Any setup with phase based
rules should be done in the associated header phase to ensure they are
executed before stream based rules. Depending on the size of the data
and the server&#8217;s buffer size, the data may come in chunks. Because of
this, a <code>StreamInspect</code> rule may execute multiple times - once per chunk
of data received.</p>
</li>
<li>
<p><code>StreamInspect</code> rules have a limited set of operators that support
streaming inspection. Currently this is limited to the <code>dfa</code> operator,
but may expand in the future. The <code>dfa</code> operator uses the PCRE syntax
similar to <code>rx</code>, but does not allow backtracking. Additionally, the
<code>dfa</code> operator can capture ALL matches, instead of just the first as
<code>rx</code> does. This allows capturing all matching patterns from the stream.
Note that the <code>dfa</code> operator is fully streaming aware and will match
across chunk boundaries.</p>
</li>
<li>
<p><code>StreamInspect</code> rules allow only a single stream as input, however you
can use multiple rules.</p>
</li>
<li>
<p><code>StreamInspect</code> rules currently do not support transformations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <code>StreamInspect</code> documentation for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_executing_actions_with_code_action_code">Executing actions with <code>Action</code></h5>
<div class="paragraph">
<p>Rule actions may need to be triggered unconditionally. While not often
required, this is possible with the <code>Action</code> directive. Typically this
is used to execute <code>setvar</code>, <code>setflag</code> or similar actions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Action id:init/1 phase:REQUEST_HEADER setvar:MY_VAR=1234</pre>
</div>
</div>
<div class="paragraph">
<p>See the <code>Action</code> documentation for more details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lua_signature_definitions">Lua Signature Definitions</h4>
<div class="paragraph">
<p>Often you may need more functionality in configuring rules than is
offered by the configuration language. This is possible by using Lua to
provide signature definitions. Using the <code>LuaInclude</code> directive, you can
include a lua script into the configuration. The Lua script can define
rules as an alternate signature definition language. Note that Lua is
only being used as the configuration language. This means that Lua is
only executed at configuration time and not required to execute the
rules. The rules defined in the lua script are identical to those added
via the Rule directive, but just use an alternative configuration
language. This really shows off IronBee&#8217;s separation of the rules from
the language in which they are defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Load the Lua module to add Lua functionality into IronBee.
LoadModule ibmod_lua.so

# Include rules via a lua script and commit.
LuaInclude rules.lua</pre>
</div>
</div>
<div class="paragraph">
<p>Including a lua script at configuration using <code>LuaInclude</code> allows the
full power of Lua to configure the rules. The included Lua script is
executed at config time, providing a vast amount of power over rule
configuration. Within Lua, you can use the <code>Sig(id,rev)</code> function to
define signature rules. The <code>Sig()</code> function returns a signature object,
which allows you to then specify attributes, such as fields, an
operator, actions, etc. The following is a simple rule using the <code>Rule</code>
directive, which will serve as an example to be converted using the Lua
configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule ARGS REQUEST_HEADERS \
     @rx "some-attack-regex" \
     id:test/lua/1 rev:1 \
     severity:50 confidence:75 \
     event:alert block:phase \
     "msg:Some message text."</pre>
</div>
</div>
<div class="paragraph">
<p>This is converted into Lua&#8217;s <code>Sig()</code> function below. Note that this is
an extremely verbose version for clarity. Later, this will be shortened
to a much more manageable form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-- Create a signature with: id="test/lua/1" rev=1
local sig = Sig("test/lua/1", 1)

-- Specify what fields to inspect.
sig:fields("ARGS", "REQUEST_HEADERS")

-- Specify the phase.
sig:phase("REQUEST")

-- Specify the operator
sig:op("rx", [[some-attack-regex]])

-- Specify other meta-data.
sig:action("severity:50")
sig:action("confidence:75")

-- Specify the actions.
sig:action("event:alert")
sig:action("block:phase")
sig:message("Some message text.")</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Sig()</code> function returns a signature object as do all the attribute
functions. This allows us to chain attributes via the colon operator
resulting in something much more compact and "rule-like".</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sig("test/lua/1", 1):
  fields("ARGS", "REQUEST_HEADERS"):
  phase("REQUEST"):
  op("rx", [[some-attack-regex]]):
  action("severity:50"):
  action("confidence:75"):
  action("event:alert"):
  action("block:phase"):
  message("Some message text.")</pre>
</div>
</div>
<div class="paragraph">
<p>Even this, however, is a bit more verbose than desired. In practice many
rules will follow the same form and it will quickly become tedious to
write signatures in such a verbose format. To reduce this verbosity, the
power of Lua is utilized, which allows customizing how rules are written
by defining wrapper functions around the default <code>Sig()</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--[[ ----------------------------------------------------
---- Define a function to reduce verbosity:
---- RequestRegex(id, regex [,severity [,confidence]])
--]] ----------------------------------------------------
local RequestRegex = function(id,regex,severity,confidence)
  if severity == nil then
    severity = 50
  end
  if confidence == nil then
    confidence = 75
  end
  return Sig("test/lua/" .. id,1):
           op("rx", regex):
           phase("REQUEST"):
           action("severity:" .. severity):
           action("confidence:" .. confidence):
           action("event:alert"):
           action("block:phase")
end

--[[ ----------------------------------------------------
---- Define a list of common attack fields
--]] ----------------------------------------------------
local ATTACK_FIELDS = { "ARGS", "REQUEST_HEADERS" }

-- Rules using the above wrappers
RequestRegex(1,[[some-attack-regex]]):
  fields(ATTACK_FIELDS):
  message("Some message text.")</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this can substantially reduce the verbosity of the
rules, however, it does require writing some wrapper functions. As
IronBee matures, it will expose some builtin wrappers in a separate
library. Separating the wrappers into a library would then reduce this
into a file that load the library alongside the rules themselves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-- Load the Wrappers
require rule-wrappers

-- Rules
RequestRegex(1,[[some-attack-regex]]):
  fields(ATTACK_FIELDS):
  message("Some message text.")
RequestRegex(2,[[some-other-attack-regex]]):
  fields(ATTACK_FIELDS):
  message("Some other message text.")</pre>
</div>
</div>
<div class="paragraph">
<p>Rule execution order is different when specified in Lua. In Lua, no
order is guaranteed unless specified. Order is specified in a number of
ways. The first method is via the <code>before()</code> or <code>after()</code> attributes,
which control rule execution order. Note that <code>before()</code> and <code>after()</code>
are not rule chaining and do not require the previous rule to match.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sig("lua/1",1):
  before("lua/2")
Sig("lua/2",1):
Sig("lua/3",1):
  after("lua/2")</pre>
</div>
</div>
<div class="paragraph">
<p>While this is powerful, it is tedious to maintain. As most cases where
you need rule order are in grouping rules to form a sort of recipe,
there is a <code>Recipe(tag)</code> function defined which does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adds the supplied recipe tag to all rules within the recipe.</p>
</li>
<li>
<p>Forces rule execution order within the recipe.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Recipe "recipe/1" {
  Sig("lua/1",1),
  Sig("lua/2",1),
  Sig("lua/3",1)
}</pre>
</div>
</div>
<div class="paragraph">
<p>Each rule in the recipe will contain the recipe tag and therefore the
entire recipe can be enabled via the <code>RuleEnable</code> directive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>RuleEnable tag:recipe/1</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Rule</code> directive supports chaining rules via the <code>chain</code> rule
modifier. Chaining allows rules to be logically ANDed together so that
later rules only execute if previous rules match. Chained rules are
slightly different when specified in Lua. Lua uses the <code>follows()</code>
attribute to specify a rule ID to follow in execution IF that rule
matches. This is essentially reversed from the <code>Rule</code> directive which
specifies the <code>chain</code> modifier on the previous rule verses specifying
the <code>follows()</code> attribute on the later rule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Define a "lua/1" rule
Sig("lua/1",1)

# Define a "lua/2" rule that will run only if "lua/1" matches
Sig("lua/2",1):follows("lua/1")

# Define a "lua/3" rule that will run only if "lua/2" matches
Sig("lua/3",1):follows("lua/2")</pre>
</div>
</div>
<div class="paragraph">
<p>The following is defined for use in defining rules within Lua.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sig(id,rev): Create a new signature based rule.</p>
<div class="ulist">
<ul>
<li>
<p>field(name): Specify a single field name added to the list of fields
to inspect.</p>
</li>
<li>
<p>fields(list): Specify a list of field names to be added to the list
of fields to inspect.</p>
</li>
<li>
<p>op(name,value): Specify an operator to use for the rule.</p>
</li>
<li>
<p>phase(name): Specify the phase name to execute within.</p>
</li>
<li>
<p>message(text): Specify a message for the rule.</p>
</li>
<li>
<p>tag(name): Specify a tag name to add to the list of tags.</p>
</li>
<li>
<p>tags(list): Specify a list of tag names to be added to the list of
tags.</p>
</li>
<li>
<p>comment(text): Arbitrary comment text to associate with the rule.</p>
</li>
<li>
<p>action(text): Specify any additional rule action or modifier in
"name:parameter" format.</p>
</li>
<li>
<p>before(rule-id): Specify the rule ID which this should execute
before.</p>
</li>
<li>
<p>after(rule-id): Specify the rule ID which this should execute after.</p>
</li>
<li>
<p>follows(rule-id): Specify the rule ID that this should follow IF that
rule matched.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Action(id,rev): Similar to the Action directive, this is the same as
Sig(), but disallows field()/fields()/op() attributes.</p>
</li>
<li>
<p>ExtSig(id,rev): Similar to the RuleExt directive, this is the same as
Sig(), but allows specifying a script to execute as the rule logic.</p>
<div class="ulist">
<ul>
<li>
<p>script(name): Name of script to execute.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Recipe(tag, rule-list): Group a list of rules, adding tag to all rules
and maintaining rule execution order.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_extended_rules_xrules">Extended Rules (XRules)</h4>
<div class="paragraph">
<p>XRules are useful for Access Control Lists and exceptions. XRules
compliment other rule forms. See the XRule directives for
moreinformation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_lua_rule_scripts">External Lua Rule Scripts</h4>
<div class="paragraph">
<p>While Lua signature definitions are very powerful, they are still
limited to signature like operations. To allow for complex logic you can
use Lua at rule execution time yielding the full power of Lua as an
inspection language. This is accomplished by using either the <code>RuleExt</code>
directive within a configuration file or <code>ExtSig()</code> within a Lua
configuration file.</p>
</div>
<div class="paragraph">
<p>See the documentation for the <code>RuleExt</code> directive for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_rule_execution_via_rule_injection_modules">Alternative Rule Execution via Rule Injection Modules</h4>
<div class="paragraph">
<p>Modules may define additional rule execution systems via the rule
injection mechanism. Rule injection works in two stages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the end of configuration, every rule injection system is given a
chance to claim each rule. Rule injection systems usually claim a rule
if it contains a certain action. Only one rule injection system may
claim each rule; it is an error for more than one to claim it. If no
rule injection system claims a rule, it is added to the default rule
engine.</p>
</li>
<li>
<p>At each phase during inspection, every rule injection system is given
a chance to inject one or more rules. The rule injection system may use
whatever method it desires to choose which rules to inject. Injected
rules are then executed as usual.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rule injection mechanism is designed to allow for specialized rule
systems that, for a certain class of rules, are more expressive, more
performant or both. For example, the Fast rule injection systems
associates a substring pattern with a rule and uses an Aho-Corasick
variant to determine which rules to inject. The benefit over the
traditional rule system is that rules that do not fire have minimal
performance cost. However, Fast is only suitable for a subset of rules:
those that require certain fixed width patterns to appear in the input.</p>
</div>
<div class="paragraph">
<p>The default rule engine claims all rules not otherwise claimed. It
evaluates each rule for the appropriate phase and context in order. This
approach is slow but also simple and predictable.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modules">Modules</h3>
<div class="paragraph">
<p>When full control is required, then an IronBee module may be required.
Modules provide the ability to hook directly into the IronBee state
machine for fine grained control over execution, Currently modules can
be written in three languages. Each has a different use case which is
described below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lua is the simplest language to develop modules as it hides many of
the details. While Lua allows for rapid development, it does not perform
as well as other languages for many tasks. Lua is the recommended
language for prototyping and most higher level module needs - where Lua
rules are not adequate. Lua modules also have the added benefit of being
able to be distributed as rules, since they are not in a binary form.</p>
</li>
<li>
<p>C<code> allows near full control over IronBee via the C</code> wrappers. C<code>
provides much higher level access to IronBee in a fairly strict
environment. However, the C</code> wrappers do not cover all functionality of
IronBee and you may need to fall back to the C API. Because of the added
strictness in C++ and near equal performance to the native C API, it is
the recommended language if Lua will not satisfy performance or
functionality requirements.</p>
</li>
<li>
<p>C is the lowest level language for writing modules. While C provides
full functionality, it does not provide as much protection as C++ or
Lua.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See ? for more information on writing IronBee modules.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rule_reference">Rule Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rules are an encapsulated form of logic used in inspect data. They are comprised
of metadata, such as an ID and revision, take input, execute an operation and
optionally perform actions.  Input can be manipulated via transformations before
the operation is executed and actions can be modified through rule modifiers (such
as specifying a status code or message. The following is a reference to the rule
components. For a better understanding of how to write rules, see the chapter
on <a href="#_inspection">Inspection</a>.</p>
</div>
<div class="sect2">
<h3 id="_rule_metadata">Rule Metadata</h3>
<div class="paragraph">
<p>TODO: General description.</p>
</div>
<div class="sect3">
<h4 id="_logdata">logdata</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add data to be logged with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logdata:&lt;value&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Log a data fragment as part of the error message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule ARGS @rx pattern \
        "msg:Test matched" logdata:%{MATCHED_VAR}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Up to 128 bytes of data will be recorded.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_confidence">confidence</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric value indicating the confidence of the rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>confidence:&lt;0-100&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Higher confidence rules should have a lower False Positive rate.</p>
</div>
</div>
<div class="sect3">
<h4 id="_id">id</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier for a rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id:&lt;value&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Specifies a unique identifier for a rule. If a later rule re-uses the
same identifier, then it will overwrite the previous rule.</p>
</div>
<div class="paragraph">
<p>TODO: Explain what the full unique id is (taking context and chains into
account)</p>
</div>
</div>
<div class="sect3">
<h4 id="_msg">msg</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message associated with the rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msg:&lt;text&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This message is used by the <code>event</code> action when logging the event.</p>
</div>
</div>
<div class="sect3">
<h4 id="_phase">phase</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The runtime phase at which the rule should execute.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>phase:&lt;phase-name&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Rule phase determines when a rule runs. IronBee understands the
following phases:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">REQUEST_HEADER</dt>
<dd>
<p>Invoked after the entire HTTP request headers has been read, but
before reading the HTTP request body (if any). Most rules should not
use this phase, opting for the REQUEST phase instead.</p>
</dd>
<dt class="hdlist1">REQUEST_HEADER_PROCESS</dt>
<dd>
<p>Invoked after the REQUEST_HEADER phase to allow for processing the phase,
such as invoking blocking rules.</p>
</dd>
<dt class="hdlist1">REQUEST</dt>
<dd>
<p>Invoked after receiving the entire HTTP request, which may involve
request body and request trailers, but it will run even when neither
is present.</p>
</dd>
<dt class="hdlist1">REQUEST_PROCESS</dt>
<dd>
<p>Invoked after the REQUEST phase to allow for processing the phase,
such as invoking blocking rules.</p>
</dd>
<dt class="hdlist1">RESPONSE_HEADER</dt>
<dd>
<p>Invoked after receiving the HTTP entire response header.</p>
</dd>
<dt class="hdlist1">RESPONSE_HEADER_PROCESS</dt>
<dd>
<p>Invoked after the RESPONSE_HEADER phase to allow for processing the phase,
such as invoking blocking rules.</p>
</dd>
<dt class="hdlist1">RESPONSE</dt>
<dd>
<p>Invoked after receiving the HTTP response body (if any) and response
trailers (if any).</p>
</dd>
<dt class="hdlist1">RESPONSE_PROCESS</dt>
<dd>
<p>Invoked after the RESPONSE phase to allow for processing the phase,
such as invoking blocking rules.</p>
</dd>
<dt class="hdlist1">POSTPROCESS</dt>
<dd>
<p>Invoked after the entire transaction has been processed. This phase is
for logging and tracking data between transactions, such as storing
state. Actions cannot affect the transaction in this phase.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rev">rev</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer rule revision.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rev:n</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>TODO: Explain how this is used in RuleEnable and when overriding Rules
in sub contexts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_severity">severity</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric value indicating the severity of the issue thisrule is trying to protect against.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>severity:&lt;0-100&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The severity indicates how much impact a successful attack may be, but
does not indicate the quality of protection this rule may provide. The
severity is meant to be used as part of a "threat level" indicator. The
"threat level" is essentially severity x confidence, which balances how
severe the threat may be with how well this rule might be protecting
against it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tag">tag</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply an arbitrary tag name to a rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag:&lt;value&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>TODO: Describe where this is used, notably <code>RuleEnable</code>/<code>RuleDisable</code>
and logged with events.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_fields">Data Fields</h3>
<div class="paragraph">
<p>TODO: General description.</p>
</div>
<div class="sect3">
<h4 id="_args">ARGS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All request parameters combined and normalized.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction (<code>REQUEST_HEADERS</code>, <code>REQUEST_BODY</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>ARGS</code> collection is currently the same as specifying
<code>REQUEST_URL_PARAMS REQUEST_BODY_PARAMS</code>, but this will change in later
releases to include normalization based on parser personalities. If you
do not want normalization, then use <code>REQUEST_URL_PARAMS REQUEST_BODY_PARAMS</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_auth_password">AUTH_PASSWORD</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic authentication password.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_auth_type">AUTH_TYPE</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicator of the authentication method used.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field contains the first token extracted from the <code>Authorization</code>
request header. Typical values are: <code>Basic</code>, <code>Digest</code>, and <code>NTLM</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_auth_username">AUTH_USERNAME</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic or Digest authentication username.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_capture">CAPTURE</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction collection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This collection contains information for the transaction. Currently
captured data from operators is stored here in keys "0"-"9".</p>
</div>
</div>
<div class="sect3">
<h4 id="_field">FIELD</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias to the current field being inspected.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable (same type as the aliased field)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rule</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field is useful only in field expansions within actions when you
must have the original value of the field being inspected. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Log the field value with an event
Rule ARGS @contains attack_string id:123 phase:REQUEST logdata:%{FIELD} event

# Create a collection matching a pattern for later use
Rule REQUEST_HEADERS @rx pattern1 id:124 phase:REQUEST_HEADER setvar:NEW_COL:%{FIELD_NAME}=%{FIELD}
Rule ARGS @rx pattern2 id:125 phase:REQUEST setvar:NEW_COL:%{FIELD_NAME}=%{FIELD}
...
# Then perform further matches on the new collection in another phase, which
# is not possible via chaining.
Rule NEW_COL @rx some_other_patt id:126 phase:REQUEST "msg:Some msg" event block</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_field_name">FIELD_NAME</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias to the current field name being inspected, notincluding the collection name if it is a sub-field in a collection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable (same type as the aliased field)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rule</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field is useful only in field expansions within actions when you
must have the name of the field being inspected. The collection name is
not prepended, so if <code>ARGS:foo</code> is being inspected, the value will be
<code>foo</code>, not <code>ARGS:foo</code>. If you want the full name with the collection
prepended, then use <code>FIELD_NAME_FULL</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_field_name_full">FIELD_NAME_FULL</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias to the current field name being inspected,including the collection name if it is a sub-field in a collection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable (same type as the aliased field)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rule</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field is useful only in field expansions within actions when you
must have the full name of the field being inspected. See <code>FIELD_NAME</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_geoip">GEOIP</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the <em>geoip</em> module is loaded, then a lookup will beperformed on the remote (client) address and the results placed in this collection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">geoip</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The address used during lookup is the same as that stored in the
<code>REMOTE_ADDR</code> field, which may be modified from the actual connection
(TCP) level address by the <code>trusted_proxy</code> module.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sub-Fields (not all are available prior to GeoIP v1.4.6):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>latitude:</strong> Numeric latitude rounded to nearest integral value (no
floats yet).</p>
</li>
<li>
<p><strong>longitude:</strong> Numeric longitude rounded to nearest integral value (no
floats yet).</p>
</li>
<li>
<p><strong>area_code:</strong> Numeric area code (US only).</p>
</li>
<li>
<p><strong>charset:</strong> Numeric character set code.</p>
</li>
<li>
<p><strong>country_code:</strong> Two character country code.</p>
</li>
<li>
<p><strong>country_code3:</strong> Three character country code.</p>
</li>
<li>
<p><strong>country_name:</strong> String country name.</p>
</li>
<li>
<p><strong>region:</strong> String region name.</p>
</li>
<li>
<p><strong>city:</strong> String city name.</p>
</li>
<li>
<p><strong>postal_code:</strong> String postal code.</p>
</li>
<li>
<p><strong>continent_code:</strong> String continent code.</p>
</li>
<li>
<p><strong>accuracy_radius:</strong> Numeric accuracy radius (v1.4.6+).</p>
</li>
<li>
<p><strong>metro_code:</strong> Numeric metro code (v1.4.6+).</p>
</li>
<li>
<p><strong>country_conf:</strong> String country confidence (v1.4.6+).</p>
</li>
<li>
<p><strong>region_conf:</strong> String region confidence (v1.4.6+).</p>
</li>
<li>
<p><strong>city_conf:</strong> String city confidence (v1.4.6+).</p>
</li>
<li>
<p><strong>postal_conf:</strong> String postal code confidence (v1.4.6+).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_htp_request_flags">HTP_REQUEST_FLAGS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of LibHTP request parsing flags.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">htp</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The LibHTP parser will set various flags while parsing. This is a
collection of those flags for request parsing. The following flags may
be set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>FIELD_UNPARSEABLE</strong> An unparseable field was given.</p>
</li>
<li>
<p><strong>FIELD_INVALID</strong> An invalid field was sent.</p>
</li>
<li>
<p><strong>FIELD_FOLDED</strong> Folding detected in a field.</p>
</li>
<li>
<p><strong>FIELD_REPEATED</strong> A field was repeated.</p>
</li>
<li>
<p><strong>FIELD_LONG</strong> A field length was longer than allowed.</p>
</li>
<li>
<p><strong>FIELD_RAW_NUL</strong> A field contained an unencoded NUL (zero) byte.</p>
</li>
<li>
<p><strong>HOST_AMBIGUOUS</strong> The host was specified in both the URI and in the
Host header, but they do not match.</p>
</li>
<li>
<p><strong>HOST_MISSING</strong> The host was missing from a request in which it is
normally sent.</p>
</li>
<li>
<p><strong>HOSTH_INVALID</strong> Invalid host detected in header.</p>
</li>
<li>
<p><strong>HOSTU_INVALID</strong> Invalid host detected in URL.</p>
</li>
<li>
<p><strong>INVALID_FOLDING</strong> Invalid header folding detected.</p>
</li>
<li>
<p><strong>INVALID_CHUNKING</strong> Invalid chunking detected.</p>
</li>
<li>
<p><strong>MULTI_PACKET_HEAD</strong> The header was sent in more than one packet
(buffer).</p>
</li>
<li>
<p><strong>PATH_ENCODED_NUL</strong> A NUL (zero) byte was sent, encoded, in the path.</p>
</li>
<li>
<p><strong>PATH_ENCODED_SEPARATOR</strong> An encoded path separator was sent in the
path.</p>
</li>
<li>
<p><strong>PATH_HALF_FULL_RANGE</strong> An invalid full width character was used in the
path.</p>
</li>
<li>
<p><strong>PATH_INVALID</strong> An invalid path detected.</p>
</li>
<li>
<p><strong>PATH_INVALID_ENCODING</strong> Invalid encoding was used in the path.</p>
</li>
<li>
<p><strong>PATH_OVERLONG_U</strong> An overlong Unicode encoding was used in the path.</p>
</li>
<li>
<p><strong>PATH_UTF8_VALID</strong> A UTF-8 character was used in the path.</p>
</li>
<li>
<p><strong>PATH_UTF8_INVALID</strong> An invalid UTF-8 encoding was used in the path.</p>
</li>
<li>
<p><strong>PATH_UTF8_OVERLONG</strong> An overlong UTF-8 encoding was used in the path.</p>
</li>
<li>
<p><strong>REQUEST_SMUGGLING</strong> A HTTP smuggling attack was detected.</p>
</li>
<li>
<p><strong>URLEN_ENCODED_NUL</strong> An encoded NUL (zero) byte detected in URL.</p>
</li>
<li>
<p><strong>URLEN_HALF_FULL_RANGE</strong> An invalid full width character detected in
URL.</p>
</li>
<li>
<p><strong>URLEN_INVALID_ENCODING</strong> An invalid encoding detected in URL.</p>
</li>
<li>
<p><strong>URLEN_OVERLONG_U</strong> An overlong unicode character detected in URL.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_htp_response_flags">HTP_RESPONSE_FLAGS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of LibHTP response parsing flags.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">htp</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The LibHTP parser will set various flags while parsing. This is a
collection of those flags for response parsing. The following flags may
be set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>FIELD_UNPARSEABLE</strong> An unparseable field was given.</p>
</li>
<li>
<p><strong>FIELD_INVALID</strong> An invalid field was sent.</p>
</li>
<li>
<p><strong>FIELD_FOLDED</strong> Folding detected in a field.</p>
</li>
<li>
<p><strong>FIELD_REPEATED</strong> A field was repeated.</p>
</li>
<li>
<p><strong>FIELD_LONG</strong> A field length was longer than allowed.</p>
</li>
<li>
<p><strong>FIELD_RAW_NUL</strong> A field contained an unencoded NUL (zero) byte.</p>
</li>
<li>
<p><strong>INVALID_CHUNKING:</strong> Invalid chunking was used.</p>
</li>
<li>
<p><strong>INVALID_FOLDING:</strong> Invalid header folding was used.</p>
</li>
<li>
<p><strong>MULTI_PACKET_HEAD:</strong> The header was sent in more than one packet
(buffer).</p>
</li>
<li>
<p><strong>STATUS_LINE_INVALID:</strong> An invalid HTTP status code was sent.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_remote_addr">REMOTE_ADDR</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote (client) IP address, extracted from the TCPconnection. Can be in IPv4 or IPv6 format.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the <code>trusted_proxy</code> module is also loaded, then the client address may
be corrected using any available proxy headers (currently <code>X-Forwarded-For</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_remote_port">REMOTE_PORT</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote (client) port, extracted from the TCP connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_body_params">REQUEST_BODY_PARAMS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request parameters transported in request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_cookies">REQUEST_COOKIES</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of request cookies (name/value pairs).</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction (<code>REQUEST_HEADERS</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_headers">REQUEST_HEADERS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of request headers (name/value pairs).</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction (<code>REQUEST_HEADERS</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_host">REQUEST_HOST</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request hostname information, extracted from the requestand normalized.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction (<code>REQUEST_HEADERS</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The following rules apply:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the hostname information if provided on the request line</p>
</li>
<li>
<p>Alternatively, look up the HTTP <code>Host</code> request header</p>
</li>
<li>
<p>If the hostname information is provided in both locations, the
information in the HTTP <code>Host</code> request header is ignored</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Normalization [TODO What RFC should we refer to?]:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lowercase</p>
</li>
<li>
<p>Remove trailing dot [TODO What dot?]</p>
</li>
<li>
<p>[TODO Remove port?]</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_request_line">REQUEST_LINE</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full, raw, request line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET /path/to/page?a=5&amp;q=This+is+a+test. HTTP/1.1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_request_method">REQUEST_METHOD</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request method.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field contains the HTTP method used for the request.</p>
</div>
<div class="paragraph">
<p>Example: <code>GET</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_request_protocol">REQUEST_PROTOCOL</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request protocol name and version.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field contains the HTTP protocol name and version, as specified on
the request line. Transactions that do not specify the protocol (e.g.,
HTTP prior to 1.0) will have an empty string value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_request_uri">REQUEST_URI</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request URI, extracted from request and normalizedaccording to the current personality (see <code>REQUEST_FILENAME</code> for more details).</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Default normalization:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>RFC normalization</p>
</li>
<li>
<p>Convert to lowercase</p>
</li>
<li>
<p>Reduce consecutive forward slashes to a single character</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All normalization options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RFC normalization</p>
</li>
<li>
<p>Convert to lowercase</p>
</li>
<li>
<p>Convert \ characters to /</p>
</li>
<li>
<p>Reduce consecutive forward slashes to a single character</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_request_uri_fragment">REQUEST_URI_FRAGMENT</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed fragment portion of the URI within the requestline.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_host">REQUEST_URI_HOST</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed host portion of the URI within the request line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This is the hostname specified in the URI. Note that this may be
different from the normalized host, which is in <code>REQUEST_HOST</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_request_uri_params">REQUEST_URI_PARAMS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request parameters transported in query string.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction (<code>REQUEST_HEADERS</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_password">REQUEST_URI_PASSWORD</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed password portion of the URI within the requestline.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_path">REQUEST_URI_PATH</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed and normalized path portion of the URI within therequest line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_path_raw">REQUEST_URI_PATH_RAW</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed (raw) path portion of the URI within the requestline.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As no URL decoding is performed (this is a raw value), you probably want
<code>REQUEST_URI_PATH_RAW.urlDecode()</code> in most cases.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_request_uri_port">REQUEST_URI_PORT</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed port portion of the URI within the request line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_raw">REQUEST_URI_RAW</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw, unnormalized, request URI from the request line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_scheme">REQUEST_URI_SCHEME</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed scheme portion of the URI within the request line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_query">REQUEST_URI_QUERY</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed query portion of the URI within the request line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_request_uri_username">REQUEST_URI_USERNAME</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed username portion of the URI within the requestline.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_response_headers">RESPONSE_HEADERS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of response headers (name/value pairs).</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_response_line">RESPONSE_LINE</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full response line.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Transactions that do not specify a response line (e.g., HTTP prior to
1.0) will have an empty string value.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP/1.1 200 OK</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_response_message">RESPONSE_MESSAGE</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response status message.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field contains the status message (text following the status code),
as specified on the response line. Transactions that do not specify a
response line (e.g., HTTP prior to 1.0) will have an empty string value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_response_protocol">RESPONSE_PROTOCOL</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response protocol name and version.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field contains the protocol name and version, as specified on the
response line. Transactions that do not specify a response line (e.g.,
HTTP prior to 1.0) will have an empty string value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_response_status">RESPONSE_STATUS</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response status code.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This field contains the status code, as specified on the response line.
Transactions that do not specify a response line (e.g., HTTP prior to
1.0) will have an empty string value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_server_addr">SERVER_ADDR</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server IP address, extracted from the TCP connection. Canbe in IPv4 or IPv6 format.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_server_port">SERVER_PORT</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server port, extracted from the TCP connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_tx">TX</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction collection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This collection contains arbitrary information for the transaction. It
is a generic place for rules to store transaction data in which other
rules can monitor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ua">UA</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User agent information extracted from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_agent</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
While the <code>User-Agent</code> HTTP request header may be used in generating
these fields, the term "user agent" here refers to the client as a
whole.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sub-Fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>agent:</strong> String name of the user agent.</p>
</li>
<li>
<p><strong>product:</strong> String product deduced from the user agent data.</p>
</li>
<li>
<p><strong>os:</strong> String operating system deduced from user agent data.</p>
</li>
<li>
<p><strong>extra:</strong> Any extra string available after parsing the <code>User-Agent</code>
HTTP request header.</p>
</li>
<li>
<p><strong>category:</strong> String category deduced from user agent data.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transformation_functions">Transformation Functions</h3>
<div class="paragraph">
<p>TODO: General description.</p>
</div>
<div class="sect3">
<h4 id="_ceil">ceil</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the integral value greater than or equal to thenumeric value of the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>DEPRECATED: Use <code>iceil</code> instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_compresswhitespace">compressWhitespace</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaces one or more consecutive whitespace characterswith a single space.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Replaces various whitespace characters with spaces. In addition,
consecutive whitespace characters will be reduced down to a single
space. Whitespace characters are: <code>0x20</code>, <code>\f</code>, <code>\t</code>, <code>\n</code>, <code>\r</code>, <code>\v</code>,
<code>0xa0</code> (non-breaking whitespace).</p>
</div>
</div>
<div class="sect3">
<h4 id="_count">count</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Given a collection, it returns the number if items in thecollection. Given a scalar, returns 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_floor">floor</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the integral value less than or equal to thenumeric value of the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>DEPRECATED: Use <code>ifloor</code> instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_htmlentitydecode">htmlEntityDecode</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decodes HTML entities in the data.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The following forms are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>&amp;#DDDD;</strong> - Numeric code point, where DDDD represents a decimal number
with any number of digits.</p>
</li>
<li>
<p><strong>&#xHHHH;</strong> - Numeric code point, where HHHH represents a hexadecimal
number with any number of digits.</p>
</li>
<li>
<p><strong>&name;</strong> - Predefined XML named entities (currently: quot, amp, apos,
lt, gt).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See
<a href="https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references">https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_iceil">iceil</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the integral value greater than or equal to the numeric value of the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_ifloor">ifloor</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the integral value less than or equal to the numeric value of the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_iround">iround</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the integral value closest to the numeric value of the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_length">length</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the byte length of the value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_lowercase">lowercase</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the input as all lower case characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_max">max</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Given a collection of numeric data, returns the maximumvalue.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_min">min</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Given a collection of numeric data, returns the minimumvalue.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_name">name</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the name of the field as the value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_names">names</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a collection of names from a collection ofname/value pairs.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_normalizepath">normalizePath</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize a filesystem path, removing back and selfreferences.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_normalizepathwin">normalizePathWin</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize a Windows filesystem path, removing back andself references.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_normalizesqli">normalizeSqli</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize potential SQL injection via libinjection.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">libinjection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The libinjection ironbee module utilizes Nick Galbreath&#8217;s libinjection
to implement SQLi detection. This transformation is based on an example
in libinjection. The libinjection library is available via:
<a href="http://www.client9.com/projects/libinjection/">http://www.client9.com/projects/libinjection/</a></p>
</div>
<div class="paragraph">
<p>Example Input/Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Input: foo' /* x */   or 1/* y -- */=/* z */1 union select id,passwd from users --</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Output: foo' or 1=1 union select id,passwd from users --</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_normalizesqlpg">normalizeSqlPg</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize postgres SQL.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sqltfn</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Normalize Postgres SQL.</p>
</div>
<div class="paragraph">
<p>Example Input/Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Input: foo' /* x */   or 1/* y -- */=/* z */1 union select id,passwd from users --</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Output: foo' or 1 = 1 union select id,passwd from users</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removewhitespace">removeWhitespace</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes one or more consecutive whitespace characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Similar to <code>compressWhitespace</code>, except removes the characters instead
of replacing them with a single space.</p>
</div>
</div>
<div class="sect3">
<h4 id="_round">round</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the integral value closest to the numeric value ofthe input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>DEPRECATED: Use <code>iround</code> instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_trim">trim</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes consecutive whitespace from the beginning and endof the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_trimleft">trimLeft</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes consecutive whitespace from the beginning of theinput.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_trimright">trimRight</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes consecutive whitespace from the end of the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_tofloat">toFloat</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert input to a numeric floating point type.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_tointeger">toInteger</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert input to a numeric integral type.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_tostring">toString</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert input to a string type.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_urldecode">urlDecode</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decodes URL encoded values in the input.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Implements decoding the encoding used in
application/x-www-form-urlencoded values (percent encoding with
additions).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>%HH;</strong> - Numeric code point, where HH represents a two digit
hexadecimal number.</p>
</li>
<li>
<p><strong>+</strong> - Represents an ASCII space character (equiv to <code>%20</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fields which are parsed from the URI and form parameters are already URL
Decoded and you should not apply this transformation to these fields
unless you are trying to inspect multiple levels of encoding.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operators">Operators</h3>
<div class="paragraph">
<p>TODO: General description.</p>
</div>
<div class="sect3">
<h4 id="_contains">contains</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target contains the given sub-string.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contains</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_dfa">dfa</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deterministic finite atomation matching algorithm (PCRE&#8217;salternative matching algorithm).</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dfa</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pcre</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>dfa</code> operator implements the alternative matching algorithm in the
<a href="http://www.pcre.org/">PCRE</a> regular expressions library. The parameter of
the operator is a regular expression pattern that is passed to the PCRE
library without modification. This alternative matching algorithm uses a
similar syntax to PCRE regular expressions, except that backtracking is
not available. The primary use of <code>dfa</code> is to allow a subset of regular
expression matching in a streaming manner (see <code>StreamInspect</code>). In
addition to streaming support, dfa will also find all matches to the
pattern when the capture modifier is used. TODO: Describe limits on
regex syntax.</p>
</div>
<div class="paragraph">
<p>Example of capturing multiple matches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Capture each item in a '&amp;' separated list
Rule REQUEST_URI_QUERY @dfa "[^&amp;]*" id:1 rev:1 phase:REQUEST_HEADER capture
# Inspect each element in the CAPTURE, blocking if the format does not match
Rule CAPTURE !@rx ".=." id:2 rev:1 phase:REQUEST_HEADER "msg:Name and value required" event block</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ee_match_any">ee_match_any</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target matches any value in the namedeudoxus automata.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ee_match_any</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ee</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The named eudoxus automata must first be loaded with the <code>LoadEudoxus</code>
directive</p>
</div>
</div>
<div class="sect3">
<h4 id="_eq">eq</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target is numerically equal to thegiven value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eq</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_ge">ge</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target is numerically greater than orequal to the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ge</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_gt">gt</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target is numerically greater thanthe given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gt</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_imatch">imatch</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As <code>match</code>, but case insensitive.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imatch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_ipmatch">ipmatch</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if a target IPv4 address matches any givenwhitespace separated address in CIDR format.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ipmatch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_ipmatch6">ipmatch6</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if a target IPv6 address matches any givenwhitespace separated address in CIDR format.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ipmatch6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_is_sqli">is_sqli</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the data is determined to be SQLinjection via the libinjection library.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is_sqli</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">libinjection</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The libinjection ironbee module utilizes Nick Galbreath&#8217;s libinjection
to implement SQLi detection. This operator is similar to libinjection&#8217;s
is_sqli() function. The libinjection library is available via:
<a href="http://www.client9.com/projects/libinjection/">http://www.client9.com/projects/libinjection/</a></p>
</div>
<div class="paragraph">
<p>Currently the data-source must be set to "default" as loading external
databases is not yet implemented.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule ARGS @is_sqli default id:test/sqli/1 phase:REQUEST "msg:Detected SQLi" logdata:%{FIELD} event block:phase</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_le">le</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target is numerically less than orequal to the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>le</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_lt">lt</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target is numerically less than thegiven value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lt</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_match">match</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target is any of the given whitespaceseparated words.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>match</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_ne">ne</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the target is not numerically equal tothe given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ne</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_pm">pm</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel matching using the <code>Aho-Corasick</code> algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ac</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Implements a set-based (or parallel) matching function using the
Aho-Corasick algorithm. The parameter of the operator contains one or
more matching patterns, separated with whitespace. Set-based matching is
capable of matching many patterns at the same time, making it efficient
for cases when the number of patterns is very large (in hundreds and
thousands).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule REQUEST_HEADERS:User-Agent @pm "one two three"</pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>capture</code> modifier is specified on a <code>@pm</code> rule, the <code>CAPTURE:0</code>
variable will contain the matched data fragment. Do note that, because
the <code>pm</code> operator can easily match many times per rule, the <code>CAPTURE:0</code>
value is valid only when used in the same rule. In the following rules,
<code>CAPTURE:0</code> will contain the data fragment of the last <code>@pm</code> match.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
DEPRECATED: The "ac" module is deprecated. Use <code>rx</code>, <code>dfa</code>, <code>match</code>,
<code>imatch</code> or <code>ee_match_any</code> instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_pmf">pmf</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel matching with patterns from file.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ac</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Same as <code>pm</code>, but instead of accepting parameters directly, it loads
them from the file whose filename was supplied. The file is expected to
contain one pattern per line. To convert a line into a pattern,
whitespace from the beginning and the end is removed. Empty lines are
ignored, as are comments, which are lines that begin with <code>#</code>. Relative
filenames are resolved from same directory as the configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule REQUEST_HEADERS:User-Agent @pmf bad_user_agents.dat</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
DEPRECATED: The "ac" module is deprecated. Use <code>rx</code>, <code>dfa</code>, <code>match</code>,
<code>imatch</code> or <code>ee_match_any</code> instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rx">rx</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular expression (perl compatible regular expression)matching.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pcre</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>rx</code> operator implements <a href="http://www.pcre.org/">PCRE</a> regular
expressions. The parameter of the operator is a regular expression
pattern that is passed to the PCRE library without modification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule ARGS:userId !@rx "^[0-9]+$"</pre>
</div>
</div>
<div class="paragraph">
<p>Patterns are compiled with the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Entire input is treated as a single buffer against which matching is
done.</p>
</li>
<li>
<p>Patterns are case-sensitive by default.</p>
</li>
<li>
<p>Patterns are compiled with <code>PCRE_DOTALL</code> and <code>PCRE_DOLLAR_ENDONLY</code>
set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using captured substrings to create variables</p>
</div>
<div class="paragraph">
<p>Regular expressions can be used to capture substrings. In IronBee, the
captured substrings can be used to create new variables in the <code>CAPTURE</code>
collection. To use this feature, specify the <code>capture</code> modifier in the
rule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rule ARGS @rx "test(\d{13,16})" capture</pre>
</div>
</div>
<div class="paragraph">
<p>When capture is enabled, IronBee will always create a variable
<code>CAPTURE:0</code>, which will contain the entire matching area of the pattern.
Anonymous capture groups will create up to 9 variables, from <code>CAPTURE:1</code>
to <code>CAPTURE:9</code>. These special <code>CAPTURE</code> variables will remain available
until the next capture rule is run, when they will all be deleted.</p>
</div>
</div>
<div class="sect3">
<h4 id="_streq">streq</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if target exactly matches the given string.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>streq</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_istreq">istreq</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As <code>streq</code>, but case insensitive.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>istreq</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sect2">
<h3 id="_modifiers_and_actions">Modifiers and Actions</h3>
<div class="paragraph">
<p>TODO: General description.</p>
</div>
<div class="sect3">
<h4 id="_allow">allow</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a transaction as allowed to proceed to a giveninspection point.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allow[":phase" | ":request"]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>By default this allows the transaction to proceed without inspection
until the post-processing phase. This can be changed depending on the
modifier used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>phase</strong> - Proceed to the end of the current phase without further rule
execution.</p>
</li>
<li>
<p><strong>request</strong> - Proceed to the end of the request processing phases
without further rule execution.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_event">event</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cause the rule to generate a log event.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event[":observation" | ":alert"]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>By default this generates a log event of type "observation", but this
can be changed to type "alert". Having at least one active alert type
event will cause an audit log to be generated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>observation</strong> - Default event type denoting a rule made an
observation, which could contribute to further inspection.</p>
</li>
<li>
<p><strong>alert</strong> - Alert event type denoting a transaction should be logged.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_block">block</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a transaction to be blocked.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>block[:advisory | :phase | :immediate]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>By default this marks the transaction with an advisory blocking flag.
This can be changed depending on the modifier used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>advisory</strong> - Mark the transaction with an advisory blocking flag which
further rules may take into account.</p>
</li>
<li>
<p><strong>phase</strong> - Block the transaction at the end of the current phase.</p>
</li>
<li>
<p><strong>immediate</strong> - Block the transaction immediately after rule execution.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_capture_2">capture</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable capturing the matching data.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifier</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>capture</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Enabling capturing will populate the <code>CAPTURE</code> collection with data from
the most recent matching operator. For most operators the <code>CAPTURE:0</code>
field will be set to the last matching value. Operators that support
capturing multiple values may set other items in the <code>CAPTURE</code>
collection. For example, the <code>rx</code> operator supports setting the
additional <code>CAPTURE:1</code> - <code>CAPTURE:9</code> via capturing parens in the regular
expression and the <code>dfa</code> operator supports capturing <em>all matches</em>, each
being available as <code>CAPTURE:0</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_chain">chain</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chains the next rule, so that the next rule will executeonly if the current operator evaluates true.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifier</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>chain</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Rule chains are essentially rules that are bound together by a logical
AND with short circuiting. In a rule chain, each rule in the chain is
executed in turn as long as the operators are evaluating true. If an
operator evaluates to false, then no further rules in the chain will
execute. This allows a rule to execute multiple operators.</p>
</div>
<div class="paragraph">
<p>All rules in the chain will still execute their actions before the next
rule in the chain executes. If you want a rule that only executes an
action if all operators evaluate true, then the action should be given
on the final rule in the chain.</p>
</div>
<div class="paragraph">
<p>Requirements for chained rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only the first rule in the chain may have an id or phase, which will
be used for all rule chains.</p>
</li>
<li>
<p>A numeric chain ID will be assigned and appended to the rule ID,
prefixed with a dash, to uniquely identify the rule.</p>
</li>
<li>
<p>Different metadata attributes (except id/phase) may be given for each
chain, but the first rule&#8217;s metasta will be the default.</p>
</li>
<li>
<p>Specifying one or more tag modifiers is allowed in any chain, but the
tags will be bound to the entire rule chain so that RuleEnable and
similar will act on the entire rule chain, not just an individual rule
in the chain.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Start a rule chain, which matches only POST requests. The implicit ID here
# will be set to "id:1-1".
Rule REQUEST_METHOD "@rx ^(?i:post)$" id:1 phase:REQUEST chain

# Only if the above rule's operator evaluates true, will the next rule in the
# chain execute. This rule checks to see if there are any URI based parameters
# which typically should not be there for POST requests. If the operator evaluates
# true, then the setvar action will execute, marking the transaction and an
# event will be generated with the given msg text. This rule will have the
# implicit ID set to "id:1-2".
Rule &amp;REQUEST_URI_PARAMS @gt 0 "msg:POST with URI parameters." setvar:TX:uri_params_in_post=1 event chain

# Only if the above two rules' operators return true will the next rule in the
# chain execute.  This rule checks that certain parameters are not used in
# on the URI and if so, generates an event and blocks the transaction with the
# default status code at the end of the phase. This rule will have the implicit
# ID set to "id:1-3".
Rule &amp;REQUEST_URI_PARAMS:/^(id|sess)$/ @gt 0 "msg:Sensitive parameters in URI." event block:phase</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delrequestheader">delRequestHeader</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete an HTTP header from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delRequestHeader:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_delresponseheader">delResponseHeader</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete an HTTP header from the response.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delResponseHeader:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_setflag">setflag</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set, or unset, boolean transaction attributes (flags).</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setflag:[!]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Allow setting or unsetting transaction flags. Prefixing with a <code>!</code>
unsets the flag.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently the <code>inspectRequestHeader</code> flag is always set as this is
required for the site selection process. Additionally, the
<code>RequestBuffering</code> and <code>ResponseBuffering</code> directives must be enabled to
buffer the request or response.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>block</strong> - Set if transaction was marked for block.</p>
</li>
<li>
<p><strong>suspicious</strong> - Set if transaction was marked as suspicious and care
should be taken in processing.</p>
</li>
<li>
<p><strong>inspectRequestHeader</strong> - Set if the engine should inspect the HTTP
request header (default: set).</p>
</li>
<li>
<p><strong>inspectRequestBody</strong> - Set if the engine should inspect the HTTP
request body (default: unset).</p>
</li>
<li>
<p><strong>inspectResponseHeader</strong> - Set if the engine should inspect the HTTP
response header (default: unset).</p>
</li>
<li>
<p><strong>inspectResponseBody</strong> - Set if the engine should inspect the HTTP
response body (default: unset).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_setrequestheader">setRequestHeader</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the value of a HTTP request header.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setRequestHeader:=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_setresponseheader">setResponseHeader</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the value of an HTTP response header.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setResponseHeader:=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_setvar">setvar</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set a variable data field.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setvar:[!][+|-]=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>setvar</code> modifier is used for data field manipulation. To create a
variable data field or change its value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setvar:tx:score=1</pre>
</div>
</div>
<div class="paragraph">
<p>To remove all instances of a named variable data field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setvar:!tx:score</pre>
</div>
</div>
<div class="paragraph">
<p>To increment or decrement a variable data field value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setvar:tx:score+=5
    setvar:tx:score-=5</pre>
</div>
</div>
<div class="paragraph">
<p>An attempt to modify a value of a non-numerical variable will assume the
old value was zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Probably should just fail, logging an attempt was made to modify a non-numerical value.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_status">status</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTP status code to use for a blocking action.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifier</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect3">
<h4 id="_t">t</h4>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:10%;">
<col style="width:90%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply one or more named transformations to each of thetargets in a rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifier</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Cardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..n</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock header">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extending_ironbee">Extending IronBee</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#8230;</p>
</div>
<div class="sect2">
<h3 id="_overview">Overview</h3>
<div class="paragraph">
<p>&#8230;</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Warning</strong></p>
</div>
<div class="paragraph">
<p>This documentation is currently out of date.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_execution_flow">Execution Flow</h3>
<div class="sect3">
<h4 id="_definitions">Definitions</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Engine</dt>
<dd>
<p>The framework that controls data flow, state and code execution.</p>
</dd>
<dt class="hdlist1">Server Plugin</dt>
<dd>
<p>Server native code for embedding the engine into another software base
(e.g. the Apache httpd server). The plugin is responsible for
instantiating the engine, initiating the initial configuration
process, feeding the engine with data and optionally implementing
methods of blocking.</p>
</dd>
<dt class="hdlist1">Hook</dt>
<dd>
<p>A hook is an execution point within the engine that allows external
code to be registered and executed as if it were part of the engine.
There are many builtin hooks in the IronBee engine and custom hooks
can also be added. Hooks are typically leveraged by modules.</p>
</dd>
<dt class="hdlist1">Module</dt>
<dd>
<p>Engine code that is not essential to the core engine, but rather
extends what the engine can accomplish by hooking into it. Modules in
IronBee are dynamically loadable files which can extend and alter how
the engine executes. There are a number of different types of modules
which will be explained in detail. Some examples of modules are HTTP
parsers, matching algorithms, logging methods, rule
languages/executors and specialized detection techniques. All IronBee
features are essentially modules, which allows nearly every aspect of
the engine to be extended.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_flow">Flow</h4>
<div class="paragraph">
<p>There are four main stages of execution detailed below.</p>
</div>
<div class="sect4">
<h5 id="_startup_stage">Startup Stage</h5>
<div class="paragraph">
<p>During startup, the plugin is instantiated by whatever server has loaded
it, for example when the Apache httpd server loads/configures the
plugin. During this stage, the plugin instantiates the engine and
initiates the configuration stage.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Server starts and instantiates/starts the plugin.</p>
</li>
<li>
<p>Server Plugin is configured with native plugin configuration, which
includes the location of the engine configuration.</p>
</li>
<li>
<p>Engine is instantiated.</p>
</li>
<li>
<p>An engine configuration context is created.</p>
</li>
<li>
<p>Static core module is loaded.</p>
</li>
<li>
<p>Server Plugin registers a native logging provider.</p>
</li>
<li>
<p>Engine configuration stage is initiated based on initial plugin
configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_stage">Configuration Stage</h5>
<div class="paragraph">
<p>During configuration, the configuration files/scripts are read/executed,
engine modules are loaded/initialized and contexts are
created/configured in preparation for the runtime stage. The following
is an outline of what will happen during this stage.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration is read/executed.</p>
</li>
<li>
<p>The main configuration context is created.</p>
</li>
<li>
<p>Modules are loaded.</p>
</li>
<li>
<p>Module global configuration data is copied to the global context as
a base configuration.</p>
</li>
<li>
<p>Module "init" function is called just after it is loaded to
initialize any module configuration.</p>
</li>
<li>
<p>Modules may hook into the engine by registering to be called when
certain events occur.</p>
</li>
<li>
<p>If successfully initialized, a module is registered with the engine.</p>
</li>
<li>
<p>Configuration contexts are created and registered.</p>
</li>
<li>
<p>Modules register themselves with a configuration context if they are
to be used in that context.</p>
</li>
<li>
<p>Module "context init" function is called to initialize any context
configuration.</p>
</li>
<li>
<p>Modules may hook into the engine for the given context by
registering to be called when certain events occur.</p>
</li>
<li>
<p>The runtime stage is initiated.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Runtime Stage</p>
</div>
<div class="paragraph">
<p>During runtime all of the configuration has been finalized and the
engine will now handle data passed to it by the plugin. Data is handled
by the state machine which essentially follows a five step process.
First, a configuration context is chosen. Second, the request is
handled. Third the response is handled. Forth, any post processing is
performed. And finally, logging is performed. Below is an outline of the
flow.</p>
</div>
<div class="paragraph">
<p>TODO: Below is no longer true. Rewrite based on removal of unparsed data
interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Raw connection HTTP data is received by the server plugin and passed
to the engine.</p>
</li>
<li>
<p>[Need to add connection context here. Events could be: conn open,
conn data (inbound/outbound), conn close. Configuration options include
which protocol parser to use, default parser configuration, whether to
decrypt SSL, private keys for decryption, etc.]</p>
</li>
<li>
<p>If the connection is encrypted, SSL decryption takes place. This
step is optional and will largely depend on how the plugin is designed.
For example, the Apache plugin will always send decrypted data.</p>
</li>
<li>
<p>The engine parses the data as a stream, buffering if configured to
do so.</p>
</li>
<li>
<p>The parser notifies the engine of various events (request headers
available, request body, etc.)</p>
</li>
<li>
<p>Any hooks associated with events are executed.</p>
</li>
<li>
<p>Once enough data is available, the configuration context selection
process is started configuration context function until one returns that
it wants to be enabled.</p>
</li>
<li>
<p>At this point all modules registered in the chosen context will have
their "context activated" functions executed, allowing them to be
prepared for executing in the context.</p>
</li>
<li>
<p>Further events occur and associated hooks are executed, but now with
the chosen configuration context instead of the global context.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hooks">Hooks</h3>
<div class="paragraph">
<p>TODO: Add description of each hook</p>
</div>
</div>
<div class="sect2">
<h3 id="_modules_2">Modules</h3>
<div class="paragraph">
<p>Modules make up the majority of executed code in IronBee. Most features
are built using modules. There are three primary reasons for this.
First, it makes the code more readable and each feature more self
contained. Second, it allows only features in use to be loaded into the
executable. And last, since modules are shared libraries, it makes for
easier upgrades as the engine only needs to unload the old code and
reload the new.</p>
</div>
<div class="paragraph">
<p>Modules have three essential duties. A module must export a known symbol
so that it can be loaded. A set of configuration parameters may be set.
And common module functions must be registered which will be called at
various initialization and cleanup points. With Lua, however, this is
much more simplified than in C.</p>
</div>
<div class="paragraph">
<p>Exporting a symbol is quite language specific and will not be discussed
here.</p>
</div>
<div class="paragraph">
<p>Any number of configuration parameters are registered with the engine
and their storage locations are then mapped by the engine both globally
to the module as well as into each configuration context. As of this
writing, there are two types of configuration parameters, numeric and
string. Along with configuration parameter definitions can be defined
default values.</p>
</div>
<div class="paragraph">
<p>The eventual goal of a module is to register functions to be called by
the engine. This is done by registering callback functions to be called
with hooks. Hooks allow executing at defined points in the
connection/transaction lifecycle, which is documented with the state
machine in the API documentation.</p>
</div>
<div class="paragraph">
<p>TODO: Need more on what a basic module will look like without going into
language details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_writing_modules_in_c">Writing Modules in C</h3>
<div class="paragraph">
<p>TODO: Some general description on why one would want to do this.</p>
</div>
<div class="sect3">
<h4 id="_anatomy_of_a_c_module">Anatomy of a C Module</h4>
<div class="paragraph">
<p>A C module is built into a shared library. The shared library exposes a
known structure (see ?) that IronBee uses to load the module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct ib_module_t {
    /* Header */
    uint32_t                   vernum;            /* Engine version number */
    uint32_t                   abinum;            /* Engine ABI Number */
    const char                *version;           /* Engine version string */
    const char                *filename;          /* Module code filename */
    void                      *data;              /* Module data */
    ib_engine_t               *ib;                /* Engine */
    ib_rule_t                 *rule;              /* Module Rule. */
    size_t                     idx;               /* Module index */

    /* Module Config */
    const char                *name;              /* Module name */
    const void                *gcdata;            /* Global config data */
    size_t                     gclen;             /* Global config data length */
    ib_module_fn_cfg_copy_t    fn_cfg_copy;       /* Config copy handler */
    void                      *cbdata_cfg_copy;   /* Config copy data */
    const ib_cfgmap_init_t    *cm_init;           /* Module config mapping */
    const ib_dirmap_init_t    *dm_init;           /* Module directive mapping */

    /* Functions */
    ib_module_fn_init_t        fn_init;           /* Module init */
    void                      *cbdata_init;       /*  fn_init callback data */
    ib_module_fn_fini_t        fn_fini;           /* Module finish */
    void                      *cbdata_fini;       /*  fn_fini callback data */

    /* DEPRECATED: Will move to hooks */
    ib_module_fn_ctx_open_t    fn_ctx_open;       /* Context open */
    void                      *cbdata_ctx_open;   /*  fn_ctx_open callback data */
    ib_module_fn_ctx_close_t   fn_ctx_close;      /* Context close */
    void                      *cbdata_ctx_close;  /*  fn_ctx_close callback data */
    ib_module_fn_ctx_destroy_t fn_ctx_destroy;    /* Context destroy */
    void                      *cbdata_ctx_destroy;/*  fn_ctx_destroy callback data */
};</pre>
</div>
</div>
<div class="paragraph">
<p>A module must define and initialize this structure to be loadable in
IronBee. This is done by defining a few functions and making a few macro
calls. A minimal module example is given in ?.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#include &lt;ironbee/cfgmap.h&gt;
#include &lt;ironbee/engine.h&gt;
#include &lt;ironbee/module.h&gt;


/* Declare the public module symbol. */
IB_MODULE_DECLARE();

/* Called when module is loaded. */
static ib_status_t exmin_init(ib_engine_t *ib, ib_module_t *m, void *cbdata)
{
    ib_log_debug(ib, 4, "Example minimal module loaded.");
    return IB_OK;
}

/* Called when module is unloaded. */
static ib_status_t exmin_fini(ib_engine_t *ib, ib_module_t *m, void *cbdata)
{
    ib_log_debug(ib, 4, "Example minimal module unloaded.");
    return IB_OK;
}

/* Initialize the module structure. */
IB_MODULE_INIT(
    IB_MODULE_HEADER_DEFAULTS,      /* Default metadata */
    "exmin",                        /* Module name */
    IB_MODULE_CONFIG_NULL,          /* Global config data */
    NULL,                           /* Configuration field map */
    NULL,                           /* Config directive map */
    exmin_init,                          /**&lt; Initialize function */
    NULL,                                /**&lt; Callback data */
    exmin_fini,                          /**&lt; Finish function */
    NULL,                                /**&lt; Callback data */
    NULL,                                /**&lt; Context open function */
    NULL,                                /**&lt; Callback data */
    NULL,                                /**&lt; Context close function */
    NULL,                                /**&lt; Callback data */
    NULL,                                /**&lt; Context destroy function */
    NULL                                 /**&lt; Callback data */
);</pre>
</div>
</div>
<div class="paragraph">
<p>? shows a very minimalistic module that does nothing but log when the
module loads and unloads. The module includes some standard IronBee
headers, declares itself a module and defines two functions. The module
structure is then initialized with these functions assigned to the
<code>fn_init</code> and <code>fn_fini</code> fields. This results in the <code>exmin_init</code> and
<code>exmin_fini</code> functions being called when the module is loaded and
unloaded, respectfully. Of course much more can be done with a module.</p>
</div>
<div class="paragraph">
<p>TODO: Describe what other things a module can do.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_simple_c_module_example">A Simple C Module Example</h4>
<div class="paragraph">
<p>TODO: This example is outdated and needs to be updated/replaced.</p>
</div>
<div class="paragraph">
<p>To better illustrate writing a C module we need a simple task to
accomplish. Here we will define a minimalistic signature language. To
keep things simple, the module will stick to IronBee built-in features
and ignore any performance concerns. The module will simply allow a user
to add signature to IronBee. In this case a signature is defined as
performing a PCRE based regular expression on a given data field and
triggering an event if there is a match.</p>
</div>
<div class="paragraph">
<p>To accomplish this task, we need to write a module that does the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allow writing a signature within the configuration file that allows
specifying when it should execute, what field it should match against, a
regular expression and an event message that should be triggered on
match.</p>
</li>
<li>
<p>Parse the signature into its various components.</p>
</li>
<li>
<p>Compile the PCRE and store the signature for later execution.</p>
</li>
<li>
<p>At runtime, execute the signatures at the specified time.</p>
</li>
<li>
<p>If a signature matches, generate an event.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The module begins the same as in ?, but with some additional type
definitions which we will use to store our signatures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#include &lt;strings.h&gt;

#include &lt;ironbee/engine.h&gt;
#include &lt;ironbee/debug.h&gt;
#include &lt;ironbee/mpool.h&gt;
#include &lt;ironbee/cfgmap.h&gt;
#include &lt;ironbee/module.h&gt;
#include &lt;ironbee/provider.h&gt;

/* Define the module name as well as a string version of it. */
#define MODULE_NAME               pocsig
#define MODULE_NAME_STR           IB_XSTRINGIFY(MODULE_NAME)

/* Declare the public module symbol. */
IB_MODULE_DECLARE();

typedef struct pocsig_cfg_t pocsig_cfg_t;
typedef struct pocsig_sig_t pocsig_sig_t;

/* Signature Phases */
typedef enum {
    POCSIG_PRE,                   /* Pre transaction phase */
    POCSIG_REQHEAD,               /* Request headers phase */
    POCSIG_REQ,                   /* Request phase */
    POCSIG_RESHEAD,               /* Response headers phase */
    POCSIG_RES,                   /* Response phase */
    POCSIG_POST,                  /* Post transaction phase */

    /* Keep track of the number of defined phases. */
    POCSIG_PHASE_NUM
} pocsig_phase_t;

/* Signature Structure */
struct pocsig_sig_t {
    const char         *target;   /* Target name */
    const char         *patt;     /* Pattern to match in target */
    void               *cpatt;    /* Compiled PCRE regex */
    const char         *emsg;     /* Event message */
};</pre>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_2">Configuration</h5>
<div class="paragraph">
<p>Modules control their own configuration structure. Normally a module
will use a simple C structure which it can reference directly. However,
a module may also expose some or all of its configuration. Any exposed
parameters can then be accessed by other modules and/or through the
configuration language. In addition to exposing configuration parameters
a module can register and expose new configuration directives for use in
the configuration language.</p>
</div>
<div class="paragraph">
<p>In this example we will need to track multiple lists of signatures (one
for each point of execution) and a handle to the PCRE pattern matcher.
While these will not be exposed, we will expose a numeric parameter to
toggle tracing signature execution. The configuration is defined and
instantiated in a C structure shown in ?.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/* Module Configuration Structure */
struct pocsig_cfg_t {
    /* Exposed as configuration parameters. */
    ib_num_t            trace;                   /* Log signature tracing */

    /* Private. */
    ib_list_t          *phase[POCSIG_PHASE_NUM]; /* Phase signature lists */
    ib_matcher_t       *pcre;                    /* PCRE matcher */
};

/* Instantiate a module global configuration. */
static pocsig_cfg_t pocsig_global_cfg;</pre>
</div>
</div>
<div class="paragraph">
<p>We will then define a configuration directive to control tracing as well
as signature directives for each phase of execution. Note that multiple
signature directives are only used to simplify the example so that we do
not have to write rule parsing code. The functions defined in ? are used
to handle the configuration directives, which we will define later on.</p>
</div>
<div class="paragraph">
<p>The <code>pocsig_dir_trace</code> function is a simple single parameter directive
handler which parses the parameter for a "On" or "Off" value and sets a
numeric parameter value in the configuration context. We will see how
this parameter is exposed later on. The <code>pocsig_dir_signature</code> function
is a directive handler that can handle an arbitrary number of
parameters. Note that much of this function is described later on with
pattern matchers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/* Handle PocSigTrace directive. */
static ib_status_t pocsig_dir_trace(ib_cfgparser_t *cp,
                                    const char *name,
                                    const char *p1,
                                    void *cbdata)
{
    ib_engine_t *ib = cp-&gt;ib;
    ib_context_t *ctx = cp-&gt;cur_ctx ? cp-&gt;cur_ctx : ib_context_main(ib);
    ib_status_t rc;

    ib_log_debug(ib, 7, "%s: \"%s\" ctx=%p", name, p1, ctx);
    if (strcasecmp("On", p1) == 0) {
        rc = ib_context_set_num(ctx, MODULE_NAME_STR ".trace", 1);
        return rc;
    }
    else if (strcasecmp("Off", p1) == 0) {
        rc = ib_context_set_num(ctx, MODULE_NAME_STR ".trace", 0);
        return rc;
    }

    ib_log_error(ib, 1, "Failed to parse directive: %s \"%s\"", name, p1);
    return IB_EINVAL;
}

/* Handle all PocSig* signature directives. */
static ib_status_t pocsig_dir_signature(ib_cfgparser_t *cp,
                                        const char *name,
                                        ib_list_t *args,
                                        void *cbdata)
{
    ib_engine_t *ib = cp-&gt;ib;
    ib_context_t *ctx = cp-&gt;cur_ctx ? cp-&gt;cur_ctx : ib_context_main(ib);
    const char *target;
    const char *op;
    const char *action;
    pocsig_cfg_t *cfg;
    pocsig_phase_t phase;
    pocsig_sig_t *sig;
    const char *errptr;
    int erroff;
    ib_status_t rc;

    /* Get the pocsig configuration for this context. */
    rc = ib_context_module_config(ctx, IB_MODULE_STRUCT_PTR, (void *)&amp;cfg);
    if (rc != IB_OK) {
        ib_log_error(ib, 1, "Failed to fetch %s config: %d",
                     MODULE_NAME_STR, rc);
    }

    /* Setup the PCRE matcher. */
    if (cfg-&gt;pcre == NULL) {
        rc = ib_matcher_create(ib, ib_engine_pool_config_get(ib),
                               "pcre", &amp;cfg-&gt;pcre);
        if (rc != IB_OK) {
            ib_log_error(ib, 2, "Could not create a PCRE matcher: %d", rc);
            return rc;
        }
    }

    /* Determine phase and initialize the phase list if required. */
    if (strcasecmp("PocSigPreTx", name) == 0) {
        phase = POCSIG_PRE;
        if (cfg-&gt;phase[phase] == NULL) {
            rc = ib_list_create(cfg-&gt;phase + POCSIG_PRE,
                                ib_engine_pool_config_get(ib));
            if (rc != IB_OK) {
                return rc;
            }
        }
    }
    /* ... PocSigReqHead removed for brevity ... */
    /* ... PocSigReq removed for brevity ... */
    /* ... PocSigResHead removed for brevity ... */
    /* ... PocSigRes removed for brevity ... */
    /* ... PocSigPostTx removed for brevity ... */
    else {
        ib_log_error(ib, 2, "Invalid signature: %s", name);
        return IB_EINVAL;
    }

    /* Target */
    rc = ib_list_shift(args, &amp;target);
    if (rc != IB_OK) {
        ib_log_error(ib, 1, "No PocSig target");
        return IB_EINVAL;
    }

    /* Operator */
    rc = ib_list_shift(args, &amp;op);
    if (rc != IB_OK) {
        ib_log_error(ib, 1, "No PocSig operator");
        return IB_EINVAL;
    }

    /* Action */
    rc = ib_list_shift(args, &amp;action);
    if (rc != IB_OK) {
        ib_log_debug(ib, 4, "No PocSig action");
        action = "";
    }

    /* Signature */
    sig = (pocsig_sig_t *)ib_mpool_alloc(ib_engine_pool_config_get(ib),
                                         sizeof(*sig));
    if (sig == NULL) {
        return IB_EALLOC;
    }

    sig-&gt;target = ib_mpool_memdup(ib_engine_pool_config_get(ib),
                                  target, strlen(target));
    sig-&gt;patt = ib_mpool_memdup(ib_engine_pool_config_get(ib),
                                op, strlen(op));
    sig-&gt;emsg = ib_mpool_memdup(ib_engine_pool_config_get(ib),
                                action, strlen(action));

    /* Compile the PCRE patt. */
    if (cfg-&gt;pcre == NULL) {
        ib_log_error(ib, 2, "No PCRE matcher available (load the pcre module?)");
        return IB_EINVAL;
    }
    sig-&gt;cpatt = ib_matcher_compile(cfg-&gt;pcre, sig-&gt;patt, &amp;errptr, &amp;erroff);
    if (sig-&gt;cpatt == NULL) {
        ib_log_error(ib, 2, "Error at offset=%d of PCRE patt=\"%s\": %s",
                     erroff, sig-&gt;patt, errptr);
        return IB_EINVAL;
    }

    ib_log_debug(ib, 4, "POCSIG: \"%s\" \"%s\" \"%s\" phase=%d ctx=%p",
                 target, op, action, phase, ctx);

    /* Add the signature to the phase list. */
    rc = ib_list_push(cfg-&gt;phase[phase], sig);
    if (rc != IB_OK) {
        ib_log_error(ib, 1, "Failed to add signature");
        return rc;
    }

    return IB_OK;
}</pre>
</div>
</div>
<div class="paragraph">
<p>Any configuration parameters and directives must be registered with the
engine. This is accomplished through two mapping structures as shown in
?. The exposed configuration parameter is named, typically
modulename.name, and the engine told it type, offset, length and default
value. This is wrapped into a macro to make this much easier. The
configuration directives are registered in a similar fashion and mapped
to handler functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/* Configuration parameter initialization structure. */
static IB_CFGMAP_INIT_STRUCTURE(pocsig_config_map) = {
    /* trace */
    IB_CFGMAP_INIT_ENTRY(
        MODULE_NAME_STR ".trace",
        IB_FTYPE_NUM,
        pocsig_cfg_t,
        trace,
        0
    ),

    /* End */
    IB_CFGMAP_INIT_LAST
};

/* Directive initialization structure. */
static IB_DIRMAP_INIT_STRUCTURE(pocsig_directive_map) = {
    /* PocSigTrace - Enable/Disable tracing */
    IB_DIRMAP_INIT_PARAM1(
        "PocSigTrace",
        pocsig_dir_trace,
        NULL
    ),

    /* PocSig* - Define a signature in various phases */
    IB_DIRMAP_INIT_LIST(
        "PocSigPreTx",
        pocsig_dir_signature,
        NULL
    ),
    IB_DIRMAP_INIT_LIST(
        "PocSigReqHead",
        pocsig_dir_signature,
        NULL
    ),
    IB_DIRMAP_INIT_LIST(
        "PocSigReq",
        pocsig_dir_signature,
        NULL
    ),
    IB_DIRMAP_INIT_LIST(
        "PocSigResHead",
        pocsig_dir_signature,
        NULL
    ),
    IB_DIRMAP_INIT_LIST(
        "PocSigRes",
        pocsig_dir_signature,
        NULL
    ),
    IB_DIRMAP_INIT_LIST(
        "PocSigPostTx",
        pocsig_dir_signature,
        NULL
    ),

    /* End */
    IB_DIRMAP_INIT_LAST
};</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pattern_matchers">Pattern Matchers</h5>
<div class="paragraph">
<p>Pattern matchers are defined through the matcher provider interface.
These matchers are typically loaded via modules. In case of the PCRE
matcher, it is loaded through the pcre module, which must be loaded for
our example module to work. A matcher provider exposes a common
interface for calling any pattern matchers registered with the engine.</p>
</div>
<div class="paragraph">
<p>In ? <code>ib_matcher_create</code> is used to fetch the PCRE pattern matcher. This
matcher is used here to compile the patterns with ib_matcher_compile.
The matcher is stored in the configuration context for later use in
executing the signatures. The compiled pattern is stored in the
signature structure which is added to a list for later execution.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hooks_2">Hooks</h5>
<div class="paragraph">
<p>Up until now, we have been dealing with configuration time processing.
In order to handle processing at runtime, we have to define a handler
and register this handler to be executed at defined points. Since all
signatures are executed in the same fashion, we can define a single
handler and register it to be executed multiple times.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>static ib_status_t pocsig_handle_sigs(ib_engine_t *ib,
                                      ib_state_event_type_t event,
                                      ib_tx_t *tx,
                                      void *cbdata)
{
    pocsig_cfg_t *cfg;
    pocsig_phase_t phase = (pocsig_phase_t)(uintptr_t)cbdata;
    ib_list_t *sigs;
    ib_list_node_t *node;
    int dbglvl;
    ib_status_t rc;

    /* Get the pocsig configuration for this context. */
    rc = ib_context_module_config(tx-&gt;ctx, IB_MODULE_STRUCT_PTR, (void *)&amp;cfg);
    if (rc != IB_OK) {
        ib_log_error(ib, 1, "Failed to fetch %s config: %d",
                     MODULE_NAME_STR, rc);
    }

    /* If tracing is enabled, lower the log level. */
    dbglvl = cfg-&gt;trace ? 4 : 9;

    /* Get the list of sigs for this phase. */
    sigs = cfg-&gt;phase[phase];
    if (sigs == NULL) {
        ib_log_debug(ib, dbglvl, "No signatures for phase=%d ctx=%p",
                     phase, tx-&gt;ctx);
        return IB_OK;
    }

    ib_log_debug(ib, dbglvl, "Executing %d signatures for phase=%d ctx=%p",
                 ib_list_elements(sigs), phase, tx-&gt;ctx);

    /* Run all the sigs for this phase. */
    IB_LIST_LOOP(sigs, node) {
        pocsig_sig_t *s = (pocsig_sig_t *)ib_list_node_data(node);
        ib_field_t *f;

        /* Fetch the field. */
        rc = ib_data_get(tx-&gt;dpi, s-&gt;target, &amp;f);
        if (rc != IB_OK) {
            ib_log_error(ib, 4, "PocSig: No field named \"%s\"", s-&gt;target);
            continue;
        }

        /* Perform the match. */
        ib_log_debug(ib, dbglvl, "PocSig: Matching \"%s\" against field \"%s\"",
                     s-&gt;patt, s-&gt;target);
        rc = ib_matcher_match_field(cfg-&gt;pcre, s-&gt;cpatt, 0, f, NULL);
        if (rc == IB_OK) {
            ib_logevent_t *e;

            ib_log_debug(ib, dbglvl, "PocSig MATCH: %s at %s", s-&gt;patt, s-&gt;target);

            /* Create the event. */
            rc = ib_logevent_create(
                &amp;e,
                tx-&gt;mp,
                "-",
                IB_LEVENT_TYPE_ALERT,
                IB_LEVENT_ACT_UNKNOWN,
                IB_LEVENT_PCLASS_UNKNOWN,
                IB_LEVENT_SCLASS_UNKNOWN,
                IB_LEVENT_SYS_UNKNOWN,
                IB_LEVENT_ACTION_IGNORE,
                IB_LEVENT_ACTION_IGNORE,
                90,
                80,
                s-&gt;emsg
            );
            if (rc != IB_OK) {
                ib_log_error(ib, 3, "PocSig: Error generating event: %d", rc);
                continue;
            }

            /* Log the event. */
            ib_event_add(tx-&gt;epi, e);
        }
        else {
            ib_log_debug(ib, dbglvl, "PocSig NOMATCH");
        }
    }

    return IB_OK;
}</pre>
</div>
</div>
<div class="paragraph">
<p>? defines a handler for executing our signatures at runtime. In order to
use this handler with each phase, we will pass the phase number to the
handler. Other than some casting trickery to pass the phase number, the
function is fairly straight forward. It loops through a phase list,
fetches the data field it will match against, matches the pre-compiled
pattern against the field and then logs an event if there is a match.</p>
</div>
<div class="paragraph">
<p>All that is left in the module is to register the signature handler to
be executed in the various phases. ? shows the finial module functions
and registration required for this. Normally configuration data is
exposed publicly where it is given a default value. Since some of our
configuration is not exposed, we need to initialize the data ourselves.
This is done though the module initialization function, <code>pocsig_init</code>.
The context initialization function, <code>pocsig_context_init</code>, is called
for each configuration context that this module is configured. This is
where we register our handler with the engine hooks and define the phase
numbers that are passed to the handler. Finally, the module structure is
initialized to point to the various configuration mapping structures and
module initialization functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>static ib_status_t pocsig_init(ib_engine_t *ib,
                               ib_module_t *m)
{

    /* Register hooks to handle the phases. */
    ib_hook_tx_register(ib, handle_context_tx_event,
                        pocsig_handle_sigs, (void *)POCSIG_PRE);
    ib_hook_tx_register(ib, handle_request_headers_event,
                        pocsig_handle_sigs, (void *)POCSIG_REQHEAD);
    ib_hook_tx_register(ib, handle_request_event,
                        pocsig_handle_sigs, (void *)POCSIG_REQ);
    ib_hook_tx_register(ib, handle_response_headers_event,
                        pocsig_handle_sigs, (void *)POCSIG_RESHEAD);
    ib_hook_tx_register(ib, handle_response_event,
                        pocsig_handle_sigs, (void *)POCSIG_RES);
    ib_hook_tx_register(ib, handle_postprocess_event,
                        pocsig_handle_sigs, (void *)POCSIG_POST);

    return IB_OK;
}

IB_MODULE_INIT(
    IB_MODULE_HEADER_DEFAULTS,           /* Default metadata */
    MODULE_NAME_STR,                     /* Module name */
    IB_MODULE_CONFIG(&amp;pocsig_global_cfg),/* Global config data */
    pocsig_config_map,                   /* Configuration field map */
    pocsig_directive_map,                /* Config directive map */
    pocsig_init,                         /* Initialize function */
    NULL,                                /* Finish function */
    NULL,                                /* Context init function */
    NULL                                 /* Context fini function */
);</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_events_2">Events</h5>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_modules_in_lua">Writing Modules in Lua</h3>
<div class="paragraph">
<p>Lua modules are designed to be much easier to develop than a C
equivalent. A Lua IronBee module is built like any other Lua module.
Really all you need to do is to implement handlers which are registered
to execute when an event is triggered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-- =========================================================================
-- =========================================================================
-- Licensed to Qualys, Inc. (QUALYS) under one or more
-- contributor license agreements.  See the NOTICE file distributed with
-- this work for additional information regarding copyright ownership.
-- QUALYS licenses this file to You under the Apache License, Version 2.0
-- (the "License"); you may not use this file except in compliance with
-- the License.  You may obtain a copy of the License at
--
--     http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
-- =========================================================================
-- =========================================================================
--
-- This is an example IronBee lua module.  Essentially, this code is
-- executed on load, allowing the developer to register other functions
-- to get called when events fire at runtime.
--
-- This example just registers a logging function for most events as well
-- as a more complex function to execute when the request headers are
-- ready to process.
--
-- Author: Sam Baskinger &lt;sbaskinger@qualys.com&gt;
-- Author: Brian Rectanus &lt;brectanus@qualys.com&gt;
-- =========================================================================

-- ===============================================
-- Get an IronBee module object, which is passed
-- into the loading module as a parameter.  This
-- is used to access the IronBee Lua API.
-- ===============================================
local ibmod = ...

-- ===============================================
-- Register an IronBee configuration file
-- directive that takes a single string parameter:
--
--   LuaExampleDirective &lt;string&gt;
-- ===============================================
ibmod:register_param1_directive(
    "LuaExampleDirective",
    function(ib_module, module_config, name, param1)
        -- Log that we're configuring the module.
        ibmod:logInfo("Got directive %s=%s", name, param1)

        -- Configuration, in this case, is simply storing the string.
        module_config[name] = param1
    end
)

-- ===============================================
-- Generic function to log an info message when
-- an event fires.
-- ===============================================
local log_event = function(ib, event)
    ib:logInfo(
        "Handling event=%s: LuaExampleDirective=%s",
        ib.event_name,
        ib.config["LuaExampleDirective"])
    return 0
end

-- ===============================================
-- This is called when a connection is started.
-- ===============================================
ibmod:conn_started_event(log_event)

-- ===============================================
-- This is called when a connection is opened.
-- ===============================================
ibmod:conn_opened_event(log_event)

-- ===============================================
-- This is called when a connection context was
-- chosen and is ready to be handled.
-- ===============================================
ibmod:handle_context_conn_event(log_event)

-- ===============================================
-- This is called when the connection is ready to
-- be handled.
-- ===============================================
ibmod:handle_connect_event(log_event)

-- ===============================================
-- This is called when the transaction starts.
-- ===============================================
ibmod:tx_started_event(log_event)

-- ===============================================
-- This is called when a request starts.
-- ===============================================
ibmod:request_started_event(log_event)

-- ===============================================
-- This is called when the transaction context
-- is ready to be handled.
-- ===============================================
ibmod:handle_context_tx_event(log_event)

-- ===============================================
-- This is called when there is new request
-- header data.
-- ===============================================
ibmod:request_header_data_event(log_event)

-- ===============================================
-- This is called when the request header data
-- has all been received.
-- ===============================================
ibmod:request_header_finished_event(log_event)

-- ===============================================
-- This is called when the request headers are
-- available to inspect.
-- ===============================================
ibmod:handle_request_header_event(
    function(ib)
        log_event(ib)

        -- You can get named fields.  Scalar fields
        -- will return scalar values.
        local req_line = ib:get("request_line")
        ib:logInfo("REQUEST_LINE: %s=%s", type(req_line), tostring(req_line))

        -- You can fetch collections as a table of name/value pairs:
        local req_headers = ib:get("request_headers")
        if type(req_headers) == 'table' then
            -- Loop over the key/field
            for k,f in pairs(req_headers) do
                if type(f) == 'table' then
                    -- Fields come as (tables), which you can
                    -- unpack into simple name/value pairs.
                    --
                    -- TODO: Need to make this a bit cleaner
                    name, val = unpack(f)
                    ib:logInfo("REQUEST_HEADERS:%s=%s", tostring(name), tostring(val))
                else
                    ib:logInfo("REQUEST_HEADERS:%s=%s", k, f)
                end
            end
        end

        -- You can access individual subfields within collections directly
        -- via "name:subname" syntax, but these will come as a list
        -- of values (as more than one subname is always allowed):
        local http_host_header = ib:getValues("request_headers:host")
        ib:logInfo("First HTTP Host Header: %s", http_host_header[1])

        -- Request cookies are a collection (table of field objects)
        -- similar to headers:
        local req_cookies = ib:get("request_cookies")
        if type(req_cookies) == 'table' then
            -- Loop over the key/field
            for k,f in pairs(req_cookies) do
                if type(f) == 'table' then
                    -- Fields come as (tables), which you can
                    -- unpack into simple name/value pairs.
                    --
                    -- TODO: Need to make this a bit cleaner
                    name, val = unpack(f)
                    ib:logInfo("REQUEST_COOKIES:%s=%s", tostring(name), tostring(val))
                else
                    ib:logInfo("REQUEST_COOKIES:%s=%s", k, f)
                end
            end
        end

        return 0
    end
)

-- ===============================================
-- This is called when the request body is
-- available.
-- ===============================================
ibmod:request_body_data_event(log_event)

-- ===============================================
-- This is called when the complete request is
-- ready to be handled.
-- ===============================================
ibmod:handle_request_event(log_event)

-- ===============================================
-- This is called when the request is finished.
-- ===============================================
ibmod:request_finished_event(log_event)

-- ===============================================
-- This is called when the transaction is ready
-- to be processed.
-- ===============================================
ibmod:tx_process_event(log_event)

-- ===============================================
-- This is called when the response is started.
-- ===============================================
ibmod:response_started_event(log_event)

-- ===============================================
-- This is called when the response headers are
-- available.
-- ===============================================
ibmod:handle_response_header_event(log_event)

-- ===============================================
-- This is called when the response headers are
-- ready to be handled.
-- ===============================================
ibmod:response_header_data_event(log_event)

-- ===============================================
-- This is called when the response header data
-- has all been received.
-- ===============================================
ibmod:response_header_finished_event(log_event)

-- ===============================================
-- This is called when the response body is
-- available.
-- ===============================================
ibmod:response_body_data_event(log_event)

-- ===============================================
-- This is called when the complete response is
-- ready to be handled.
-- ===============================================
ibmod:handle_response_event(log_event)

-- ===============================================
-- This is called when the response is finished.
-- ===============================================
ibmod:response_finished_event(log_event)

-- ===============================================
-- This is called after the transaction is done
-- and any post processing can be done.
-- ===============================================
ibmod:handle_postprocess_event(log_event)

-- ===============================================
-- This is called after postprocess is complete,
-- to allow for any post-transaction logging.
-- ===============================================
ibmod:handle_logging_event(log_event)

-- ===============================================
-- This is called when the transaction is
-- finished.
-- ===============================================
ibmod:tx_finished_event(log_event)

-- ===============================================
-- This is called when a connection is closed.
-- ===============================================
ibmod:conn_closed_event(log_event)

-- ===============================================
-- This is called when the connection disconnect
-- is ready to handle.
-- ===============================================
ibmod:handle_disconnect_event(log_event)

-- ===============================================
-- This is called when the connection is finished.
-- ===============================================
ibmod:conn_finished_event(log_event)

-- ===============================================
-- This is called when a logevent event has
-- occurred.
-- ===============================================
ibmod:handle_logevent_event(log_event)

-- Report success.
ibmod:logInfo("Module loaded!")

-- Return IB_OK.
return 0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_guide">Installation Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#8230;</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note</strong></p>
</div>
<div class="paragraph">
<p>This chapter is very much out-of-date and needs to be updated.</p>
</div>
</blockquote>
</div>
<div class="sect2">
<h3 id="_tested_operating_systems">Tested Operating Systems</h3>
<div class="paragraph">
<p>We have provided a table below of the operating systems that are
officially supported by IronBee. Our definition of a tested operating
system is one that we perform build, functionality, and regression
testing on. This is not to say that IronBee will not work for you if
your OS is not listed on this table, it probably will as long as you can
meet the general dependencies outlined in the section "General
Dependencies".</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 1. Tested Operating Systems</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operating System</th>
<th class="tableblock halign-left valign-top">Version(s)</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Enterprise Linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current and previous version.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.redhat.com/rhel/">http://www.redhat.com/rhel/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fedora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fedoraproject.org/">http://fedoraproject.org/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current stable version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.debian.org/">http://www.debian.org/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu-LTS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current and previous version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://wiki.ubuntu.com/LTS/">https://wiki.ubuntu.com/LTS/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu(non-LTS release)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.ubuntu.com/">http://www.ubuntu.com/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.apple.com/">http://www.apple.com/</a></p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_general_dependencies">General Dependencies</h3>
<div class="paragraph">
<p>&#8230;</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 2. Build Tool Dependencies</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;">
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C compiler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gcc 4.6+ or clang 3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently gcc and clang have been
tested.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gcc.gnu.org/">http://gcc.gnu.org/</a> or <a href="http://clang.llvm.org/">http://clang.llvm.org/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU Build System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoconf 2.9+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Autotools(Automake, Autoconf, Libtool)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.gnu.org/software/hello/manual/autoconf/The-GNU-Build-System.html">http://www.gnu.org/software/hello/manual/autoconf/The-GNU-Build-System.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pkg-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helper tool used when compiling applications and
libraries.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://pkg-config.freedesktop.org/wiki/">http://pkg-config.freedesktop.org/wiki/</a></p></td>
</tr>
</tbody>
</table>

<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 3. Software Version Control</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;">
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git is needed to access the IronBee source repository.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://git-scm.com/">http://git-scm.com/</a></p></td>
</tr>
</tbody>
</table>

<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 4. Libraries for IronBee Engine</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;">
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCRE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.0+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular Expression Library.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.pcre.org/">http://www.pcre.org/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PThread</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POSIX threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ossp-uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.6.2+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSSP UUID library.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.ossp.org/pkg/lib/uuid/">http://www.ossp.org/pkg/lib/uuid/</a></p></td>
</tr>
</tbody>
</table>

<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 5. Libraries for IronBee C++ Wrapper and Utilities</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;">
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C++ Compiler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">g<code> 4.6+ or clang</code> 3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently gcc and clang have
been tested.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gcc.gnu.org/">http://gcc.gnu.org/</a> or <a href="http://clang.llvm.org/">http://clang.llvm.org/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.46+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose C++ library.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.boost.org/">http://www.boost.org/</a></p></td>
</tr>
</tbody>
</table>

<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 6. Libraries for IronBee C++ CLI (clipp)</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;">
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protobuf-cpp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4.1+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic serialization library.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/protocol-buffers/">https://developers.google.com/protocol-buffers/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libpcap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1.1+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packet capture library (optional).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.tcpdump.org/">http://www.tcpdump.org/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libnids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP reassembly library (optional).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://libnids.sourceforge.net/">http://libnids.sourceforge.net/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic networking library (optional).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://libnet.sourceforge.net/">http://libnet.sourceforge.net/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stringencoders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.10+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String encoder library (optional).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://code.google.com/p/stringencoders/">https://code.google.com/p/stringencoders/</a></p></td>
</tr>
</tbody>
</table>

<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 7. Server</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;">
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Traffic Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache foundation&#8217;s Traffic Server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://trafficserver.apache.org/">http://trafficserver.apache.org/</a></p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_building_testing_and_installing_ironbee">Building, Testing and Installing IronBee</h3>
<div class="paragraph">
<p>&#8230;</p>
</div>
<div class="sect3">
<h4 id="_initial_setup">Initial Setup</h4>
<div class="listingblock">
<div class="content">
<pre># Clone the repository
git clone git://github.com/ironbee/ironbee.git
cd ironbee

# Generate the autotools utilities
./autogen.sh</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_and_install_ironbee_manually">Build and Install IronBee Manually</h4>
<div class="paragraph">
<p>IronBee is built using standard autotool conventions. First the source
must be configured for the platform, then built and finally installed.
Typically this is as simple as below, but there are many options to
configure, which you can see by running the <code>./configure --help</code> script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Configure the build for the current platform
./configure

# Build
make

# Install (default is /usr/local/ironbee, but can be set with --prefix= option to configure above)
sudo make install</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_and_install_ironbee_as_an_rpm">Build and Install IronBee as an RPM</h4>
<div class="paragraph">
<p>Alternatively, you can build ironbee as an RPM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Configure the build enough to bootstrap the rpm-package build target
./configure

# Build the RPM
make rpm-package

# Install the RPMs (your architecture may differ)
sudo rpm -iv packaging/rpm/RPMS/x86_64/ironbee*.rpm</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_and_run_unit_tests_optional">Build and Run Unit Tests(Optional)</h4>
<div class="paragraph">
<p>IronBee comes with extensive unit tests. These are built and executed
via the standard "check" make target:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make check</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_doxygen_documents_optional">Build Doxygen Documents(Optional)</h4>
<div class="paragraph">
<p>Developer (API) documentation is built into the IronBee source code.
This can be rendered into HTML or PDF using the "doxygen" utility via
the "doxygen" make target:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make doxygen</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_docbook_manual_optional">Build Docbook Manual(Optional)</h4>
<div class="paragraph">
<p>The user manual is also part of IronBee. This is written in docbook 5
and currently requires a java runtime to build. This is built via the
"manual" make target:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make manual</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_examples">Configuration Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#8230;</p>
</div>
<div class="sect2">
<h3 id="_example_trafficserver_configuration">Example Trafficserver Configuration</h3>
<div class="listingblock">
<div class="content">
<pre># Insert this into trafficserver's plugin.config.
# Adjust paths as appropriate for your installation.

# First we need to load libraries the Ironbee plugin relies on.
/usr/local/ironbee/lib/libloader.so /usr/local/ironbee/lib/libironbee.so

# Now we can load the ironbee plugin.  The argument to this is ironbee's
# configuration file: see ironbee-config.txt
/usr/local/ironbee/lib/ts_ironbee.so /usr/local/trafficserver/etc/ironbee-ts.conf

#We could also use options to the ts_ironbee load line:
#  -l name   to specify a different filename for ironbee log messages.
#  -v n      to set the initial log level for Ironbee messages.
#  -L        to disable the trafficserver logging altogether</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_apache_configuration">Example Apache Configuration</h3>
<div class="listingblock">
<div class="content">
<pre>LoadModule ironbee_module /usr/local/ironbee/lib/mod_ironbee.so</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># IfModule serves for distributions using certain kinds of
# configuration tool.  It's not useful for individual configurations,
# and may make troubleshooting harder.

&lt;IfModule ironbee_module&gt;
    IronbeeConfigFile /usr/local/ironbee/etc/ironbee-httpd.conf

    #Further directives available but having defaults (shown here)
    #likely to work for most users
    IronbeeRawHeaders On
    IronbeeFilterInput On
    IronbeeFilterOutput On
    IronbeeLog On
    IronbeeLogLevel 4
&lt;/IfModule&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_ironbee_configuration">Example IronBee Configuration</h3>
<div class="listingblock">
<div class="content">
<pre>### Logging
# Log level (standard syslog levels with additional debug2 and debug3)
LogLevel info
# The log is really only valid for clipp as the servers
# will utilize their own native logging facilities.
Log debug.log

### Sensor Info
SensorId 80ECD8CF-318C-4915-A8C2-B3AAE315FB0C

### Load Modules
# Standard support modules
LoadModule "ibmod_htp.so"
LoadModule "ibmod_pcre.so"

# ### Lua Modules
# # Lua Support
# LoadModule "ibmod_lua.so"
#
# # Event Processor
# LuaLoadModule "event_processor.lua"
# EventProcessorCategoryFilter FOO 60
# EventProcessorCategoryFilter BAR 50
# EventProcessorCategoryFilter BOO 75
# EventProcessorCategoryFilter EEK 75
#
# # Threat Level
# LuaLoadModule "threat_level.lua"
# ThreatLevelMinConfidence 25

# IronBee Rule Language
LoadModule "ibmod_rules.so"

### Auditing
AuditEngine RelevantOnly
AuditLogIndex None
AuditLogBaseDir /tmp/ironbee
AuditLogSubDirFormat "%Y%m%d-%H%M"
AuditLogDirMode 0755
AuditLogFileMode 0644
AuditLogParts all

### Buffering
RequestBuffering On
ResponseBuffering On

### Rule Diagnostics Logging
RuleEngineLogData all
RuleEngineLogLevel info


# ===============================================================================
# Rules
# ===============================================================================
# ===============================================================================
### Test Rules
# This rule will block if a "blockme" parameter (with any value) is in the request
Rule ARGS:blockme.count() @ne 0 id:test/blockme rev:1 phase:REQUEST "msg:Test blocking" tag:TestRules event block

### Default Blocking Rules
# These rule detect any advisory blocks and perform the
# actual block.
Rule FLAGS:block @ne 0 id:block/request_header rev:1 phase:REQUEST_HEADER "msg:Blocking request header" tag:BlockingMode block:phase
Rule FLAGS:block @ne 0 id:block/request rev:1 phase:REQUEST "msg:Blocking request" tag:BlockingMode block:phase
Rule FLAGS:block @ne 0 id:block/response_header rev:1 phase:RESPONSE_HEADER "msg:Blocking response header" tag:BlockingMode block:phase
# ===============================================================================
# ===============================================================================

### Sites
# Default
&lt;Site default&gt;
    SiteId 0CA1665C-F27F-4763-A3E0-A31A00477497
    Service *:*
    Hostname *

    # Enable rules from the main context
    RuleEnable tag:TestRules
    RuleEnable tag:BlockingMode
&lt;/Site&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ideas_for_future_improvements">Ideas For Future Improvements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document contains the list of things we want to look into.</p>
</div>
<div class="paragraph">
<p><strong>Reminder (to ourselves): We will not add features unless we can
demonstrate clear need.</strong></p>
</div>
<div class="sect2">
<h3 id="_directive_loadmodule">Directive: LoadModule</h3>
<div class="paragraph">
<p>Support many instances of the same module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LoadModule /path/to/module.so moduleName</pre>
</div>
</div>
<div class="paragraph">
<p>Module name is optional. When not provided, the filename with extension
removed is used as the name.</p>
</div>
<div class="paragraph">
<p>Some ideas to support module parameters, should we need to do it later
on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;LoadModule /path/to/module.so&gt;
    Param paramName1 paramValue1
    Param paramName2 paramValue2

    &lt;Param paramName3&gt;
        # value3 here, free-form
    &lt;/Param&gt;

    Param paramName4 @file:/path/to/file/with/paramValue4
&lt;/LoadModule&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Modules should be able to hook into the engine in the correct order
relative to other modules, but should manual tweaking be needed, we
could use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;LoadModule /path/to/module.so&gt;
    HookPriority hookName PRIORITY_FIRST "beforeModule1, beforeModule2" "afterModule1, afterModule2"
&lt;/LoadModule&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_directive_requestparamsextra">Directive: RequestParamsExtra</h3>
<div class="paragraph">
<p>Extract parameters transported in the request URI. The parameter
supplied to this directive should be a regular expression with named
captures. On a match, the named captures will be placed in the
<code>ARGS_EXTRA</code> collection. A new effective path will be constructed (using
back references?).</p>
</div>
</div>
<div class="sect2">
<h3 id="_variable_args_extra">Variable: ARGS_EXTRA</h3>
<div class="paragraph">
<p>Request parameters extracted from RequestParamsExtra.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transformation_sqldecode">transformation: sqlDecode</h3>
<div class="paragraph">
<p>Decodes input in a way similar to how a DBMS would:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decodes hexadecimal literals that use the SQL standard format
<code>x'HEX_ENCODED_VALUE'</code> (case insensitive)</p>
</li>
<li>
<p>Decodes hexadecimal literals that use the ODBC format
<code>0xHEX_ENCODED_VALUE</code> (case insensitive)</p>
</li>
<li>
<p>Decodes backslash-escaped characters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>References:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MySQL Reference: Hexadecimal Literals
<a href="http://dev.mysql.com/doc/refman/5.6/en/hexadecimal-literals.html">http://dev.mysql.com/doc/refman/5.6/en/hexadecimal-literals.html</a></p>
</li>
<li>
<p>String Literals
<a href="http://dev.mysql.com/doc/refman/5.6/en/string-literals.html">http://dev.mysql.com/doc/refman/5.6/en/string-literals.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comparison_with_modsecurity">Comparison with ModSecurity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IronBee was designed and implemented by the team originally responsible
for ModSecurity. Because of this, you will see some similarity in
concepts and terms. However, IronBee is not a fork of ModSecurity, but
rather a completely new design built on the experience from working on
ModSecurity. This section describes both similarities and differences in
design, implementation and configuration. Those moving from ModSecurity
to IronBee should find this a useful guide to quickly get you started
using IronBee.</p>
</div>
<div class="sect2">
<h3 id="_design_and_implementation">Design and Implementation</h3>
<div class="paragraph">
<p>In concept, ModSecurity and IronBee are not that different. Both provide
a means for inspecting HTTP transactions. They do this by exposing
parsed HTTP data which can be inspected by various means. Actions can
then be taken such as logging or interrupting a transaction. In design,
however, ModSecurity and IronBee differ greatly.</p>
</div>
<div class="paragraph">
<p>ModSecurity was designed to be run as an Apache Webserver module and
thus requires the Apache Webserver API to execute. While the project has
since abstracted this Apache Webserver API and used this to port to
other webservers, these ports are still experimental and not full
featured. ModSecurity is limited to being configured by the native
webserver configuration language.</p>
</div>
<div class="paragraph">
<p>IronBee was designed as a highly portable framework which can easily be
extended and embedded. At the core, IronBee is just a shared library
which exposes an API and allows loading external modules to extend
functionality. The framework separates data acquisition and
configuration from its core. What this means, is that IronBee does not
dictate how it acquires HTTP data, nor how you define rules - these are
done outside of IronBee. IronBee is configured in its own configuration
file, not the configuration of the server in which it is embedded. This
has a few benefits: configuration is not limited by the native config
language, configuration is not intertwined (potentially conflicting)
with the webserver, and IronBee is configured the same (can share
configuration) across different server types.</p>
</div>
<div class="paragraph">
<p>Server plugins load the IronBee library and pass it data. IronBee&#8217;s rule
languages are defined by loadable modules. Because of this, IronBee is
capable of being embedded into anything that can pass it data and rules
can be written in various different forms - including programmatically.
Currently IronBee supports being embedded in Apache TrafficServer,
Apache Webserver, Nginx, Taobao Tengine (nginx fork) as well as a
command line tool that accepts various formats as input such as raw
HTTP, pcap files, etc. Porting to other platforms is relatively simple.
IronBee rules can currently be written in a simplistic rule (signature)
language, which is similar to ModSecurity, configured via the Lua
language (though executed in the C engine), or written in pure Lua.
IronBee can be extended with modules written in C, C++ or Lua.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3">Configuration</h3>
<div class="paragraph">
<p>Unlike ModSecurity, which is configured within the webserver
configuration language, IronBee is configured primarily in its own
configuration language, with only a bare minimum configuration done
within the server. While there is a full configuration language
available for IronBee, the configuration is exposed via an API, so the
entire configuration can also be done programatically within a module if
so desired (limited support is already available via lua modules). There
are two primary differences between configuring ModSecurity and IronBee.
IronBee defines sites/locations separate from the webserver, and the
IronBee rule language differs from ModSecurity. The differences in the
Rule language are discussed here.</p>
</div>
<div class="paragraph">
<p>Included in the IronBee distribution is a script to translate
ModSecurity rules to IronBee syntax. While this script cannot translate
some complex logic, it may aide in translation. The script reads stdin
and outputs to stdout, translating rules keeping comments and indention
intact.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./ib_convert_modsec_rules.pl &lt;modsec_rules.conf &gt;ironbee_rules.conf</pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 8. Rule Language Comparison</caption>
<colgroup>
<col style="width:%;">
<col style="width:%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">IronBee</th>
<th class="tableblock halign-left valign-top">ModSecurity</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[multiblock cell omitted]</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_rules_2">Rules</h3>
<div class="ulist">
<ul>
<li>
<p>In chained rules, actions (known as disruptive actions in ModSecurity)
are specified on the last rule in the chain, not on the first; the rule
metadata remains with the first rule in the chain.</p>
</li>
<li>
<p>There are no default transformations, which means that it is no longer
necessary to begin rules with <code>t:none</code>.</p>
</li>
<li>
<p>The <code>SecRuleScript</code> functionality is now handled by <code>RuleExt</code>, which
works as an interface between the rule language and
externally-implemented security logic (for example, Lua rules, rules
implemented natively, etc).</p>
</li>
<li>
<p>Run-time rule manipulation (using <code>ctl:ruleRemoveById</code> or
<code>ctl:ruleUpdateTagetById</code>) is not currently supported. These features
are slow in ModSecurity and we wish to rethink them before and if we
implement them. At the very least we will wish to provide a faster
implementation.</p>
</li>
<li>
<p>Changing rule flow at run-time is not supported at this time. This
means that the functionality of <code>skip</code>, <code>skipAfter</code> is not supported.
This is not a likely feature to be implemented. Instead you are
encouraged to use Lua.</p>
</li>
<li>
<p>IronBee uses a simplified configuration model in which site
configuration always starts from scratch. Inheritance is used when
location contexts are created, but, unlike in ModSecurity, locations
always inherit configuration from their sites.</p>
</li>
<li>
<p>There is no ability to update rule targets and actions at
configure-time, but we will probably implement a similar feature in the
future.</p>
</li>
<li>
<p>All rules that generate events must use the <code>msg</code> modifier to provide
a message. This is because IronBee does not use machine-generated rule
messages. In ModSecurity, machine-generated messages have shown to have
little value, especially as rules increase in complexity. They are often
a source of confusion.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_miscellaneous">Miscellaneous</h3>
<div class="ulist">
<ul>
<li>
<p>The audit log format has been redesigned to support new features.</p>
</li>
<li>
<p>In IronBee, request and response body inspection is not tied to
buffering. Disabling buffering will generally not affect inspection; it
will only affect the ability to block attacks reliably.</p>
</li>
<li>
<p>In IronBee, like in ModSecurity, you can have a transaction blocked if
the buffer limit is encountered, but, you can also choose to continue to
use the buffer in circular fashion. In that case, IronBee will simply
buffer as much data as it can, allowing any overflowing data to pass
through.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_features_not_supported_yet">Features Not Supported (Yet)</h3>
<div class="ulist">
<ul>
<li>
<p>Content injection - will be added in the future</p>
</li>
<li>
<p>Guardian log - will not implement this obsolete feature</p>
</li>
<li>
<p>XML support - will be added in the future</p>
</li>
<li>
<p>Chroot support - will not implement this <code>httpd</code>specific feature</p>
</li>
<li>
<p>File upload inspection and extraction - will be added in the future</p>
</li>
<li>
<p>Anti-DoS features are not supported, and we don&#8217;t expect they will be
in the future</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-02-18 22:25:37 CST
</div>
</div>
</body>
</html>